<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JavaScript中深拷贝和浅拷贝的区别及实现</title>
      <link href="/archives/2d3c4965.html"/>
      <url>/archives/2d3c4965.html</url>
      
        <content type="html"><![CDATA[<h1 id="JavaScript中深拷贝和浅拷贝的区别及实现"><a href="#JavaScript中深拷贝和浅拷贝的区别及实现" class="headerlink" title="JavaScript中深拷贝和浅拷贝的区别及实现"></a>JavaScript中深拷贝和浅拷贝的区别及实现</h1><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><ul><li>浅拷贝：只复制指向某个对象的指针，而不复制对象本身，新旧内存共享一块内存。</li><li>深拷贝：复制并创建一个一模一样的对象，不共享内存，修改新对象，旧对象保持不变。</li></ul><h2 id="浅拷贝的实现"><a href="#浅拷贝的实现" class="headerlink" title="浅拷贝的实现"></a>浅拷贝的实现</h2><p><code>Object.assign(目标文件， 原文件)</code> 浅拷贝的方法</p><ul><li>当对象只有一级属性为深拷贝；</li><li>当对象中有多级属性时，二级属性后就是浅拷贝；</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// 浅拷贝只是拷贝一层, 更深层次对象级别的只拷贝引用(地址)</span></span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: &#123;</span><br><span class="line">          <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;--------------&#x27;</span>);</span><br><span class="line">    <span class="comment">// Object.assign(目标文件， 原文件)  浅拷贝的方法</span></span><br><span class="line">    <span class="built_in">Object</span>.assign(o, obj);</span><br><span class="line">    <span class="built_in">console</span>.log(o);</span><br><span class="line">    o.msg.age = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(obj);</span><br><span class="line">    <span class="comment">// 结果就是 o 和 obj 的 msg.age 都变成了20, 因为 o 和 obj 是共享一块内存的</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="深拷贝的实现"><a href="#深拷贝的实现" class="headerlink" title="深拷贝的实现"></a>深拷贝的实现</h2><h3 id="递归遍历所有层级实现深拷贝"><a href="#递归遍历所有层级实现深拷贝" class="headerlink" title="递归遍历所有层级实现深拷贝"></a>递归遍历所有层级实现深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 深拷贝拷贝多层, 每一级别的数据都会拷贝.</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;andy&#x27;</span>,</span><br><span class="line">    <span class="attr">msg</span>: &#123;</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;red&#x27;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span>(<span class="params">newobj, oldobj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> oldobj) &#123;</span><br><span class="line">        <span class="comment">// 判断我们的属性值属于那种数据类型</span></span><br><span class="line">        <span class="comment">// 1. 获取属性值  oldobj[k]</span></span><br><span class="line">        <span class="keyword">var</span> item = oldobj[k];</span><br><span class="line">        <span class="comment">// 2. 判断这个值是否是数组(首先判断数组是因为数组也属于对象)</span></span><br><span class="line">        <span class="keyword">if</span> (item <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">            newobj[k] = [];</span><br><span class="line">            deepCopy(newobj[k], item);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">            <span class="comment">// 3. 判断这个值是否是对象</span></span><br><span class="line">            newobj[k] = &#123;&#125;;</span><br><span class="line">            deepCopy(newobj[k], item);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 4. 属于简单数据类型</span></span><br><span class="line">            newobj[k] = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">deepCopy(o, obj);</span><br><span class="line">o.msg.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(o);</span><br><span class="line"><span class="built_in">console</span>.log(obj);   <span class="comment">// obj.msg.age 还是等于 18 没有改变</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="built_in">console</span>.log(arr <span class="keyword">instanceof</span> <span class="built_in">Object</span>);  <span class="comment">// true 数组也是对象</span></span><br></pre></td></tr></table></figure><h3 id="利用JSON对象实现深拷贝"><a href="#利用JSON对象实现深拷贝" class="headerlink" title="利用JSON对象实现深拷贝"></a>利用JSON对象实现深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 深拷贝拷贝多层, 每一级别的数据都会拷贝.</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;andy&#x27;</span>,</span><br><span class="line">    <span class="attr">msg</span>: &#123;</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&#x27;pink&#x27;</span>, <span class="string">&#x27;red&#x27;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 利用 JSON 对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepCopy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _obj = <span class="built_in">JSON</span>.stringify(obj);</span><br><span class="line">    <span class="keyword">let</span> newObj = <span class="built_in">JSON</span>.parse(_obj);</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newObj = deepCopy(obj);</span><br><span class="line">newObj.msg.age = <span class="number">22</span>;</span><br><span class="line"><span class="built_in">console</span>.log(newObj);  <span class="comment">//  newObj.msg.age = 22</span></span><br><span class="line"><span class="built_in">console</span>.log(obj);  <span class="comment">// obj.msg.age 还是等于 18 没有改变</span></span><br></pre></td></tr></table></figure><h3 id="lodash函数库实现深拷贝"><a href="#lodash函数库实现深拷贝" class="headerlink" title="lodash函数库实现深拷贝"></a>lodash函数库实现深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//value : 要深拷贝的值。</span></span><br><span class="line"><span class="comment">//返回拷贝后的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vue 中使用 ：</span></span><br><span class="line"><span class="comment">//   a. npm i --save lodash     下载依赖</span></span><br><span class="line"><span class="comment">//   b. import &#123;cloneDeep&#125; from &#x27;lodash&#x27;  在 组件 中引入 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> objects = [&#123; <span class="string">&#x27;a&#x27;</span>: <span class="number">1</span> &#125;, &#123; <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span> &#125;]; </span><br><span class="line"><span class="keyword">var</span> deep = cloneDeep(objects);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深拷贝和浅拷贝 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript中常用的处理数组的方法</title>
      <link href="/archives/19d6c420.html"/>
      <url>/archives/19d6c420.html</url>
      
        <content type="html"><![CDATA[<h1 id="Javascript中常用的处理数组的方法"><a href="#Javascript中常用的处理数组的方法" class="headerlink" title="Javascript中常用的处理数组的方法"></a>Javascript中常用的处理数组的方法</h1><h2 id="Array-prototype-some"><a href="#Array-prototype-some" class="headerlink" title="Array.prototype.some()"></a>Array.prototype.some()</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p><code>some()</code> 为数组中的每一个元素执行一次 <code>callback</code> 函数，直到找到一个使得 callback 返回一个“真值”（即可转换为布尔值 true 的值）。如果找到了这样一个值，<code>some()</code> 将会立即返回 <code>true</code>。否则，<code>some()</code> 返回 <code>false</code>。<code>callback</code> 只会在那些”有值“的索引上被调用，不会在那些被删除或从来未被赋值的索引上调用。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.some(callback(element[, index[, array]])[, thisArg])</span><br></pre></td></tr></table></figure><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul><li><code>callback</code>用来测试每个元素的函数，接受三个参数：</li><li><code>element</code>数组中正在处理的元素。</li><li><code>index</code> 可选数组中正在处理的元素的索引值。</li><li><code>array</code>可选<code>some()</code>被调用的数组。</li><li><code>thisArg</code>可选执行 <code>callback</code> 时使用的 <code>this</code> 值。</li></ul><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>数组中有至少一个元素通过回调函数的测试就会返回**<code>true</code>**；所有元素都没有通过回调函数的测试返回值才会为false。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function isBiggerThan10(element, index, array) &#123;</span><br><span class="line">  return element &gt; 10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[2, 5, 8, 1, 4].some(isBiggerThan10);  // false</span><br><span class="line">[12, 5, 8, 1, 4].some(isBiggerThan10); // true</span><br></pre></td></tr></table></figure><h2 id="Array-splice"><a href="#Array-splice" class="headerlink" title="Array .splice()"></a>Array .splice()</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>splice() 方法向/从数组添加/删除项目，并返回删除的项目。</p><p><strong>注释：</strong>splice() 方法会改变原始数组。</p><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.splice(index, howmany, item1, ....., itemX)</span><br></pre></td></tr></table></figure><h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><em>index</em></td><td>必需。整数，指定在什么位置添加/删除项目，使用负值指定从数组末尾开始的位置。</td></tr><tr><td><em>howmany</em></td><td>可选。要删除的项目数。如果设置为 0，则不会删除任何项目。</td></tr><tr><td><em>item1, …, itemX</em></td><td>可选。要添加到数组中的新项目。</td></tr></tbody></table><h2 id="Array-filter"><a href="#Array-filter" class="headerlink" title="Array.filter()"></a>Array.filter()</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。</p><p><strong>注意：</strong> filter() 不会对空数组进行检测。</p><p><strong>注意：</strong> filter() 不会改变原始数组。</p><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.filter(<span class="function"><span class="keyword">function</span>(<span class="params">currentValue,index,arr</span>), <span class="title">thisValue</span>)</span></span><br></pre></td></tr></table></figure><h3 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h3><table><thead><tr><th align="left">参数</th><th>描述</th></tr></thead><tbody><tr><td align="left"><em>currentValue</em></td><td>必须。当前元素的值</td></tr><tr><td align="left"><em>index</em></td><td>可选。当前元素的索引值</td></tr><tr><td align="left"><em>arr</em></td><td>可选。当前元素属于的数组对象</td></tr><tr><td align="left"><em>thisValue</em></td><td>可选。对象作为该执行回调时使用，传递给函数，用作 “this” 的值。 如果省略了 thisValue ，”this” 的值为 “undefined”</td></tr></tbody></table><h2 id="Array-map"><a href="#Array-map" class="headerlink" title="Array .map()"></a>Array .map()</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>map() 方法返回一个新数组，数组中的元素为原始数组元素调用函数处理后的值。</p><p>map() 方法按照原始数组元素顺序依次处理元素。</p><p><strong>注意：</strong> map() 不会对空数组进行检测。</p><p><strong>注意：</strong> map() 不会改变原始数组。</p><h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.map(function(currentValue,index,arr), thisValue)</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><em>currentValue</em></td><td>必须。当前元素的值</td></tr><tr><td><em>index</em></td><td>可选。当前元素的索引值</td></tr><tr><td><em>arr</em></td><td>可选。当前元素属于的数组对象</td></tr><tr><td><em>thisValue</em></td><td>可选。对象作为该执行回调时使用，传递给函数，用作 “this” 的值。 如果省略了 thisValue，或者传入 null、undefined，那么回调函数的 this 为全局对象。</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Array.prototype </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序中npm的使用</title>
      <link href="/archives/37dd0ac.html"/>
      <url>/archives/37dd0ac.html</url>
      
        <content type="html"><![CDATA[<h1 id="微信小程序中npm的使用"><a href="#微信小程序中npm的使用" class="headerlink" title="微信小程序中npm的使用"></a>微信小程序中npm的使用</h1><h2 id="启用npm"><a href="#启用npm" class="headerlink" title="启用npm"></a>启用npm</h2><p>打开微信开发者工具中的详情，在本地设置中勾选使用npm，最新版的微信开发者工具已经自动配置好了环境，无需勾选。</p><h2 id="初始化npm"><a href="#初始化npm" class="headerlink" title="初始化npm"></a>初始化npm</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init </span><br></pre></td></tr></table></figure><p>对项目进行初始化，使用npm管理整个项目</p><h2 id="npm包的构建"><a href="#npm包的构建" class="headerlink" title="npm包的构建"></a>npm包的构建</h2><p>由于小程序只识别miniprogram_npm文件中的包，所有需要将下载好的npm包转换成小程序能够识别的包，找到工具中的构建npm点击，微信开发者工具会自动将下载到node_modules中的包转移到miniprogram_npm中，并将起转换成小程序能够识别的包。</p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是socket</title>
      <link href="/archives/bceb6aae.html"/>
      <url>/archives/bceb6aae.html</url>
      
        <content type="html"><![CDATA[<h2 id="什么是socket"><a href="#什么是socket" class="headerlink" title="什么是socket"></a>什么是socket</h2><p> Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。</p><p><img src="https://hawkingl.cn/BlogPic/20190718154523875.png" alt="img"></p><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>服务器端先初始化Socket，然后与端口绑定(bind)，对端口进行监听(listen)，调用accept阻塞，等待客户端连接。在这时如果有个客户端初始化一个Socket，然后连接服务器(connect)，如果连接成功，这时客户端与服务器端的连接就建立了。客户端发送数据请求，服务器端接收请求并处理请求，然后把回应数据发送给客户端，客户端读取数据，最后关闭连接，一次交互结束。</p><p><img src="https://hawkingl.cn/BlogPic/20190718154556909.png" alt="img"></p><h2 id="3、socket的基本操作"><a href="#3、socket的基本操作" class="headerlink" title="3、socket的基本操作"></a>3、socket的基本操作</h2><p>既然socket是“open—write/read—close”模式的一种实现，那么socket就提供了这些操作对应的函数接口。下面以TCP为例，介绍几个基本的socket接口函数。</p><h3 id="3-1、socket-函数"><a href="#3-1、socket-函数" class="headerlink" title="3.1、socket()函数"></a>3.1、socket()函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int socket(int domain, int type, int protocol);</span><br></pre></td></tr></table></figure><p>socket函数对应于普通文件的打开操作。普通文件的打开操作返回一个文件描述字，而**socket()**用于创建一个socket描述符（socket descriptor），它唯一标识一个socket。这个socket描述字跟文件描述字一样，后续的操作都有用到它，把它作为参数，通过它来进行一些读写操作。</p><p>正如可以给fopen的传入不同参数值，以打开不同的文件。创建socket的时候，也可以指定不同的参数创建不同的socket描述符，socket函数的三个参数分别为：</p><ul><li>domain：即协议域，又称为协议族（family）。常用的协议族有，AF_INET、AF_INET6、AF_LOCAL（或称AF_UNIX，Unix域socket）、AF_ROUTE等等。协议族决定了socket的地址类型，在通信中必须采用对应的地址，如AF_INET决定了要用ipv4地址（32位的）与端口号（16位的）的组合、AF_UNIX决定了要用一个绝对路径名作为地址。</li><li>type：指定socket类型。常用的socket类型有，SOCK_STREAM、SOCK_DGRAM、SOCK_RAW、SOCK_PACKET、SOCK_SEQPACKET等等（socket的类型有哪些？）。</li><li>protocol：故名思意，就是指定协议。常用的协议有，IPPROTO_TCP、IPPTOTO_UDP、IPPROTO_SCTP、IPPROTO_TIPC等，它们分别对应TCP传输协议、UDP传输协议、STCP传输协议、TIPC传输协议（这个协议我将会单独开篇讨论！）。</li></ul><p>注意：并不是上面的type和protocol可以随意组合的，如SOCK_STREAM不可以跟IPPROTO_UDP组合。当protocol为0时，会自动选择type类型对应的默认协议。</p><p>当我们调用<strong>socket</strong>创建一个socket时，返回的socket描述字它存在于协议族（address family，AF_XXX）空间中，但没有一个具体的地址。如果想要给它赋值一个地址，就必须调用bind()函数，否则就当调用connect()、listen()时系统会自动随机分配一个端口。</p><h3 id="3-2、bind-函数"><a href="#3-2、bind-函数" class="headerlink" title="3.2、bind()函数"></a>3.2、bind()函数</h3><p>正如上面所说bind()函数把一个地址族中的特定地址赋给socket。例如对应AF_INET、AF_INET6就是把一个ipv4或ipv6地址和端口号组合赋给socket。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);</span><br></pre></td></tr></table></figure><p>函数的三个参数分别为：</p><ul><li><p>sockfd：即socket描述字，它是通过socket()函数创建了，唯一标识一个socket。bind()函数就是将给这个描述字绑定一个名字。</p></li><li><p>addr：一个const struct sockaddr *指针，指向要绑定给sockfd的协议地址。这个地址结构根据地址创建socket时的地址协议族的不同而不同，如ipv4对应的是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct sockaddr_in &#123;</span><br><span class="line">    sa_family_t    sin_family; </span><br><span class="line">    in_port_t      sin_port;   </span><br><span class="line">    struct in_addr sin_addr;   </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct in_addr &#123;</span><br><span class="line">    uint32_t       s_addr;     </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ipv6对应的是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct sockaddr_in6 &#123; </span><br><span class="line">    sa_family_t     sin6_family;    </span><br><span class="line">    in_port_t       sin6_port;      </span><br><span class="line">    uint32_t        sin6_flowinfo;  </span><br><span class="line">    struct in6_addr sin6_addr;      </span><br><span class="line">    uint32_t        sin6_scope_id;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct in6_addr &#123; </span><br><span class="line">    unsigned char   s6_addr[16];    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Unix域对应的是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#define UNIX_PATH_MAX    108</span><br><span class="line"></span><br><span class="line">struct sockaddr_un &#123; </span><br><span class="line">    sa_family_t sun_family;                </span><br><span class="line">    char        sun_path[UNIX_PATH_MAX];   </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>addrlen：对应的是地址的长度。</p></li></ul><p>通常服务器在启动的时候都会绑定一个众所周知的地址（如ip地址+端口号），用于提供服务，客户就可以通过它来接连服务器；而客户端就不用指定，有系统自动分配一个端口号和自身的ip地址组合。这就是为什么通常服务器端在listen之前会调用bind()，而客户端就不会调用，而是在connect()时由系统随机生成一个。</p><blockquote><h3 id="网络字节序与主机字节序"><a href="#网络字节序与主机字节序" class="headerlink" title="网络字节序与主机字节序"></a>网络字节序与主机字节序</h3><p><strong>主机字节序</strong>就是我们平常说的大端和小端模式：不同的CPU有不同的字节序类型，这些字节序是指整数在内存中保存的顺序，这个叫做主机序。引用标准的Big-Endian和Little-Endian的定义如下：</p><p>　　a) Little-Endian就是低位字节排放在内存的低地址端，高位字节排放在内存的高地址端。</p><p>　　b) Big-Endian就是高位字节排放在内存的低地址端，低位字节排放在内存的高地址端。</p><p><strong>网络字节序</strong>：4个字节的32 bit值以下面的次序传输：首先是0～7bit，其次8～15bit，然后16～23bit，最后是24~31bit。这种传输次序称作大端字节序。<strong>由于TCP/IP首部中所有的二进制整数在网络中传输时都要求以这种次序，因此它又称作网络字节序。</strong>字节序，顾名思义字节的顺序，就是大于一个字节类型的数据在内存中的存放顺序，一个字节的数据没有顺序的问题了。</p><p>所以： 在将一个地址绑定到socket的时候，请先将主机字节序转换成为网络字节序，而不要假定主机字节序跟网络字节序一样使用的是Big-Endian。由于 这个问题曾引发过血案！公司项目代码中由于存在这个问题，导致了很多莫名其妙的问题，所以请谨记对主机字节序不要做任何假定，务必将其转化为网络字节序再 赋给socket。</p></blockquote><p>3.3、listen()、connect()函数</p><p>如果作为一个服务器，在调用socket()、bind()之后就会调用listen()来监听这个socket，如果客户端这时调用connect()发出连接请求，服务器端就会接收到这个请求。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int listen(int sockfd, int backlog);</span><br><span class="line">int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);</span><br></pre></td></tr></table></figure><p>listen函数的第一个参数即为要监听的socket描述字，第二个参数为相应socket可以排队的最大连接个数。socket()函数创建的socket默认是一个主动类型的，listen函数将socket变为被动类型的，等待客户的连接请求。</p><p>connect函数的第一个参数即为客户端的socket描述字，第二参数为服务器的socket地址，第三个参数为socket地址的长度。客户端通过调用connect函数来建立与TCP服务器的连接。</p><h3 id="3-4、accept-函数"><a href="#3-4、accept-函数" class="headerlink" title="3.4、accept()函数"></a>3.4、accept()函数</h3><p>TCP服务器端依次调用socket()、bind()、listen()之后，就会监听指定的socket地址了。TCP客户端依次调用socket()、connect()之后就想TCP服务器发送了一个连接请求。TCP服务器监听到这个请求之后，就会调用accept()函数取接收请求，这样连接就建立好了。之后就可以开始网络I/O操作了，即类同于普通文件的读写I/O操作。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);</span><br></pre></td></tr></table></figure><p>accept函数的第一个参数为服务器的socket描述字，第二个参数为指向struct sockaddr *的指针，用于返回客户端的协议地址，第三个参数为协议地址的长度。如果accpet成功，那么其返回值是由内核自动生成的一个全新的描述字，代表与返回客户的TCP连接。</p><p>注意：accept的第一个参数为服务器的socket描述字，是服务器开始调用socket()函数生成的，称为监听socket描述字；而accept函数返回的是已连接的socket描述字。一个服务器通常通常仅仅只创建一个监听socket描述字，它在该服务器的生命周期内一直存在。内核为每个由服务器进程接受的客户连接创建了一个已连接socket描述字，当服务器完成了对某个客户的服务，相应的已连接socket描述字就被关闭。</p><h3 id="3-5、read-、write-等函数"><a href="#3-5、read-、write-等函数" class="headerlink" title="3.5、read()、write()等函数"></a>3.5、read()、write()等函数</h3><p>万事具备只欠东风，至此服务器与客户已经建立好连接了。可以调用网络I/O进行读写操作了，即实现了网咯中不同进程之间的通信！网络I/O操作有下面几组：</p><ul><li>read()/write()</li><li>recv()/send()</li><li>readv()/writev()</li><li>recvmsg()/sendmsg()</li><li>recvfrom()/sendto()</li></ul><p>我推荐使用recvmsg()/sendmsg()函数，这两个函数是最通用的I/O函数，实际上可以把上面的其它函数都替换成这两个函数。它们的声明如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include </span><br><span class="line"></span><br><span class="line">ssize_t read(int fd, void *buf, size_t count);</span><br><span class="line">ssize_t write(int fd, const void *buf, size_t count);</span><br><span class="line"></span><br><span class="line">#include </span><br><span class="line">#include </span><br><span class="line"></span><br><span class="line">ssize_t send(int sockfd, const void *buf, size_t len, int flags);</span><br><span class="line">ssize_t recv(int sockfd, void *buf, size_t len, int flags);</span><br><span class="line"></span><br><span class="line">ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,</span><br><span class="line">               const struct sockaddr *dest_addr, socklen_t addrlen);</span><br><span class="line">ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags,</span><br><span class="line">                 struct sockaddr *src_addr, socklen_t *addrlen);</span><br><span class="line"></span><br><span class="line">ssize_t sendmsg(int sockfd, const struct msghdr *msg, int flags);</span><br><span class="line">ssize_t recvmsg(int sockfd, struct msghdr *msg, int flags);</span><br></pre></td></tr></table></figure><p>read函数是负责从fd中读取内容.当读成功时，read返回实际所读的字节数，如果返回的值是0表示已经读到文件的结束了，小于0表示出现了错误。如果错误为EINTR说明读是由中断引起的，如果是ECONNREST表示网络连接出了问题。</p><p>write函数将buf中的nbytes字节内容写入文件描述符fd.成功时返回写的字节 数。失败时返回-1，并设置errno变量。在网络程序中，当我们向套接字文件描述符写时有俩种可能。1)write的返回值大于0，表示写了部分或者是 全部的数据。2)返回的值小于0，此时出现了错误。我们要根据错误类型来处理。如果错误为EINTR表示在写的时候出现了中断错误。如果为EPIPE表示 网络连接出现了问题(对方已经关闭了连接)。</p><p>其它的我就不一一介绍这几对I/O函数了，具体参见man文档或者baidu、Google，下面的例子中将使用到send/recv。</p><h3 id="3-6、close-函数"><a href="#3-6、close-函数" class="headerlink" title="3.6、close()函数"></a>3.6、close()函数</h3><p>在服务器与客户端建立连接之后，会进行一些读写操作，完成了读写操作就要关闭相应的socket描述字，好比操作完打开的文件要调用fclose关闭打开的文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include </span><br><span class="line">int close(int fd);</span><br></pre></td></tr></table></figure><p>close一个TCP socket的缺省行为时把该socket标记为以关闭，然后立即返回到调用进程。该描述字不能再由调用进程使用，也就是说不能再作为read或write的第一个参数。</p><p>注意：close操作只是使相应socket描述字的引用计数-1，只有当引用计数为0的时候，才会触发TCP客户端向服务器发送终止连接请求。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端那些让你欲罢不能的工具</title>
      <link href="/archives/3edd50e0.html"/>
      <url>/archives/3edd50e0.html</url>
      
        <content type="html"><![CDATA[<h2 id="好的工具让你的工作效率成倍的提升"><a href="#好的工具让你的工作效率成倍的提升" class="headerlink" title="好的工具让你的工作效率成倍的提升"></a>好的工具让你的工作效率成倍的提升</h2><p>工欲善其事必先利其器，一个好的工具是一个项目的开始。这些工具绝对让你眼前一亮，原来前端还可以这么玩🧑‍💻，从此告别加班，走向人生的巅峰😏。</p><h2 id="编码工具"><a href="#编码工具" class="headerlink" title="编码工具"></a>编码工具</h2><p>VS code：由Microsoft开发的一款开源的编程工具，其丰富的插件系统，活跃的社区，让你在开发中遇到的问题都可以找到解决方法。高度的自定义化让你的可以随心所欲的修改编辑器。</p><h2 id="mock数据"><a href="#mock数据" class="headerlink" title="mock数据"></a>mock数据</h2><p>Apifox：前后端分离的的趋势下，Apifox可以统一前后端的接口，让前端和后端同时进行开发，前端不再需要等待后端开发好接口之后再进行测试开发，同时apifox还支持强大的自定义mock数据，让你的数据拥有灵魂，在线团队模式让接口的修改和发布能够头同步，还有接口测试功能，为你的接口保驾护航。</p><h2 id="接口测试工具"><a href="#接口测试工具" class="headerlink" title="接口测试工具"></a>接口测试工具</h2><p>insomnia：这是一款强大的轻量级的接口调试工具，可以调试web中的各种api接口</p><h2 id="mackdown笔记"><a href="#mackdown笔记" class="headerlink" title="mackdown笔记"></a>mackdown笔记</h2><p>Typora：全网都在用的一款mackdown笔记，极简的书写格式，让小白也能快速上手</p><h2 id="内网穿透工具"><a href="#内网穿透工具" class="headerlink" title="内网穿透工具"></a>内网穿透工具</h2><p>花生壳：有社区版和企业版，社区版是免费的不过有流量限制，且只有一个域名。</p><h2 id="工具集"><a href="#工具集" class="headerlink" title="工具集"></a>工具集</h2><p>uTools：PC端的快应用，“挥之即来，招之即走”，更快的调度电脑资源，内含丰富的插件和小工具。</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大事件后台API项目文档</title>
      <link href="/archives/21abc880.html"/>
      <url>/archives/21abc880.html</url>
      
        <content type="html"><![CDATA[<h2 id="Headline"><a href="#Headline" class="headerlink" title="Headline"></a>Headline</h2><blockquote><p>大事件后台 API 项目，API 接口文档请参考 <a href="https://www.showdoc.com.cn/hawkingL/8845195311102189">https://www.showdoc.com.cn/hawkingL/8845195311102189</a></p></blockquote><h2 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1. 初始化"></a>1. 初始化</h2><h3 id="1-1-创建项目"><a href="#1-1-创建项目" class="headerlink" title="1.1 创建项目"></a>1.1 创建项目</h3><ol><li>新建 <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装特定版本的 <code>express</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express@4.17.1</span><br></pre></td></tr></table></figure><ol start="3"><li>在项目根目录中新建 <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// write your code here...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">3007</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;api server running at http://127.0.0.1:3007&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-2-配置-cors-跨域"><a href="#1-2-配置-cors-跨域" class="headerlink" title="1.2 配置 cors 跨域"></a>1.2 配置 cors 跨域</h3><ol><li>运行如下的命令，安装 <code>cors</code> 中间件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cors@2.8.5</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并配置 <code>cors</code> 中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 cors 中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"><span class="comment">// 将 cors 注册为全局中间件</span></span><br><span class="line">app.use(cors())</span><br></pre></td></tr></table></figure><h3 id="1-3-配置解析表单数据的中间件"><a href="#1-3-配置解析表单数据的中间件" class="headerlink" title="1.3 配置解析表单数据的中间件"></a>1.3 配置解析表单数据的中间件</h3><ol><li>通过如下的代码，配置解析 <code>application/x-www-form-urlencoded</code> 格式的表单数据的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure><h3 id="1-4-初始化路由相关的文件夹"><a href="#1-4-初始化路由相关的文件夹" class="headerlink" title="1.4 初始化路由相关的文件夹"></a>1.4 初始化路由相关的文件夹</h3><ol><li><p>在项目根目录中，新建 <code>router</code> 文件夹，用来存放所有的<code>路由</code>模块</p><blockquote><p>路由模块中，只存放客户端的请求与处理函数之间的映射关系</p></blockquote></li><li><p>在项目根目录中，新建 <code>router_handler</code> 文件夹，用来存放所有的 <code>路由处理函数模块</code></p><blockquote><p>路由处理函数模块中，专门负责存放每个路由对应的处理函数</p></blockquote></li></ol><h3 id="1-5-初始化用户路由模块"><a href="#1-5-初始化用户路由模块" class="headerlink" title="1.5 初始化用户路由模块"></a>1.5 初始化用户路由模块</h3><ol><li>在 <code>router</code> 文件夹中，新建 <code>user.js</code> 文件，作为用户的路由模块，并初始化代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;reguser OK&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;login OK&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将路由对象共享出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中，导入并使用 <code>用户路由模块</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并注册用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.use(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br></pre></td></tr></table></figure><h3 id="1-6-抽离用户路由模块中的处理函数"><a href="#1-6-抽离用户路由模块中的处理函数" class="headerlink" title="1.6 抽离用户路由模块中的处理函数"></a>1.6 抽离用户路由模块中的处理函数</h3><blockquote><p>目的：为了保证 <code>路由模块</code> 的纯粹性，所有的 <code>路由处理函数</code>，必须抽离到对应的 <code>路由处理函数模块</code> 中</p></blockquote><ol><li>在 <code>/router_handler/user.js</code> 中，使用 <code>exports</code> 对象，分别向外共享如下两个 <code>路由处理函数</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在这里定义和用户相关的路由处理函数，供 /router/user.js 模块进行调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;reguser OK&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.login = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;login OK&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>将 <code>/router/user.js</code> 中的代码修改为如下结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, userHandler.regUser)</span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, userHandler.login)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><h2 id="2-登录注册"><a href="#2-登录注册" class="headerlink" title="2. 登录注册"></a>2. 登录注册</h2><h3 id="2-1-新建-ev-users-表"><a href="#2-1-新建-ev-users-表" class="headerlink" title="2.1 新建 ev_users 表"></a>2.1 新建 ev_users 表</h3><ol><li>在 <code>my_db_01</code> 数据库中，新建 <code>ev_users</code> 表如下：<br><img src="D:\BaiduNetdiskDownload\images\1.jpg" alt="ev_users表结构"></li></ol><h3 id="2-2-安装并配置-mysql-模块"><a href="#2-2-安装并配置-mysql-模块" class="headerlink" title="2.2 安装并配置 mysql 模块"></a>2.2 安装并配置 mysql 模块</h3><blockquote><p>在 API 接口项目中，需要安装并配置 <code>mysql</code> 这个第三方模块，来连接和操作 MySQL 数据库</p></blockquote><ol><li>运行如下命令，安装 <code>mysql</code> 模块：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql@2.18.1</span><br></pre></td></tr></table></figure><ol start="2"><li>在项目根目录中新建 <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 mysql 模块</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建数据库连接对象</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.createPool(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享 db 数据库连接对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = db</span><br></pre></td></tr></table></figure><h3 id="2-3-注册"><a href="#2-3-注册" class="headerlink" title="2.3 注册"></a>2.3 注册</h3><h4 id="2-3-0-实现步骤"><a href="#2-3-0-实现步骤" class="headerlink" title="2.3.0 实现步骤"></a>2.3.0 实现步骤</h4><ol><li>检测表单数据是否合法</li><li>检测用户名是否被占用</li><li>对密码进行加密处理</li><li>插入新用户</li></ol><h4 id="2-3-1-检测表单数据是否合法"><a href="#2-3-1-检测表单数据是否合法" class="headerlink" title="2.3.1 检测表单数据是否合法"></a>2.3.1 检测表单数据是否合法</h4><ol><li>判断用户名和密码是否为空</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收表单数据</span></span><br><span class="line"><span class="keyword">const</span> userinfo = req.body</span><br><span class="line"><span class="comment">// 判断数据是否合法</span></span><br><span class="line"><span class="keyword">if</span> (!userinfo.username || !userinfo.password) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名或密码不能为空！&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-2-检测用户名是否被占用"><a href="#2-3-2-检测用户名是否被占用" class="headerlink" title="2.3.2 检测用户名是否被占用"></a>2.3.2 检测用户名是否被占用</h4><ol><li>导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句并根据结果判断用户名是否被占用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, [userinfo.username], <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 用户名被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名！&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> 用户名可用，继续后续流程...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="2-3-3-对密码进行加密处理"><a href="#2-3-3-对密码进行加密处理" class="headerlink" title="2.3.3 对密码进行加密处理"></a>2.3.3 对密码进行加密处理</h4><blockquote><p>为了保证密码的安全性，不建议在数据库以 <code>明文</code> 的形式保存用户密码，推荐对密码进行 <code>加密存储</code></p></blockquote><hr><p>在当前项目中，使用 <code>bcryptjs</code> 对用户密码进行加密，优点：</p><ul><li>加密之后的密码，<strong>无法被逆向破解</strong></li><li>同一明文密码多次加密，得到的<strong>加密结果各不相同</strong>，保证了安全性</li></ul><hr><ol><li>运行如下命令，安装指定版本的 <code>bcryptjs</code> ：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bcryptjs@2.4.3</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/user.js</code> 中，导入 <code>bcryptjs</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>在注册用户的处理函数中，确认用户名可用之后，调用 <code>bcrypt.hashSync(明文密码, 随机盐的长度)</code> 方法，对用户的密码进行加密处理：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对用户的密码,进行 bcrype 加密，返回值是加密之后的密码字符串</span></span><br><span class="line">userinfo.password = bcrypt.hashSync(userinfo.password, <span class="number">10</span>)</span><br></pre></td></tr></table></figure><h4 id="2-3-4-插入新用户"><a href="#2-3-4-插入新用户" class="headerlink" title="2.3.4 插入新用户"></a>2.3.4 插入新用户</h4><ol><li>定义插入用户的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;insert into ev_users set ?&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，插入新用户：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, &#123; <span class="attr">username</span>: userinfo.username, <span class="attr">password</span>: userinfo.password &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但影响行数不为 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;注册用户失败，请稍后再试！&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 注册成功</span></span><br><span class="line">  res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&#x27;注册成功！&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-4-优化-res-send-代码"><a href="#2-4-优化-res-send-代码" class="headerlink" title="2.4 优化 res.send() 代码"></a>2.4 优化 res.send() 代码</h3><blockquote><p>在处理函数中，需要多次调用 <code>res.send()</code> 向客户端响应 <code>处理失败</code> 的结果，为了简化代码，可以手动封装一个 res.cc() 函数</p></blockquote><ol><li>在 <code>app.js</code> 中，所有路由之前，声明一个全局中间件，为 res 对象挂载一个 <code>res.cc()</code> 函数 ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应数据的中间件</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// status = 0 为成功； status = 1 为失败； 默认将 status 的值设置为 1，方便处理失败的情况</span></span><br><span class="line">  res.cc = <span class="function"><span class="keyword">function</span> (<span class="params">err, status = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">      <span class="comment">// 状态</span></span><br><span class="line">      status,</span><br><span class="line">      <span class="comment">// 状态描述，判断 err 是 错误对象 还是 字符串</span></span><br><span class="line">      <span class="attr">message</span>: err <span class="keyword">instanceof</span> <span class="built_in">Error</span> ? err.message : err,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-5-优化表单数据验证"><a href="#2-5-优化表单数据验证" class="headerlink" title="2.5 优化表单数据验证"></a>2.5 优化表单数据验证</h3><blockquote><p>表单验证的原则：前端验证为辅，后端验证为主，后端<strong>永远不要相信</strong>前端提交过来的<strong>任何内容</strong></p></blockquote><p>在实际开发中，前后端都需要对表单的数据进行合法性的验证，而且，<strong>后端做为数据合法性验证的最后一个关口</strong>，在拦截非法数据方面，起到了至关重要的作用。</p><p>单纯的使用 <code>if...else...</code> 的形式对数据合法性进行验证，效率低下、出错率高、维护性差。因此，推荐使用<strong>第三方数据验证模块</strong>，来降低出错率、提高验证的效率与可维护性，<strong>让后端程序员把更多的精力放在核心业务逻辑的处理上</strong>。</p><ol><li>安装 <code>@hapi/joi</code> 包，为表单中携带的每个数据项，定义验证规则：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @hapi/joi@17.1.0</span><br></pre></td></tr></table></figure><ol start="2"><li>安装 <code>@escook/express-joi</code> 中间件，来实现自动对表单数据进行验证的功能：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @escook/express-joi</span><br></pre></td></tr></table></figure><ol start="3"><li>新建 <code>/schema/user.js</code> 用户信息验证规则模块，并初始化代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * string() 值必须是字符串</span></span><br><span class="line"><span class="comment"> * alphanum() 值只能是包含 a-zA-Z0-9 的字符串</span></span><br><span class="line"><span class="comment"> * min(length) 最小长度</span></span><br><span class="line"><span class="comment"> * max(length) 最大长度</span></span><br><span class="line"><span class="comment"> * required() 值是必填项，不能为 undefined</span></span><br><span class="line"><span class="comment"> * pattern(正则表达式) 值必须符合正则表达式的规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户名的验证规则</span></span><br><span class="line"><span class="keyword">const</span> username = joi.string().alphanum().min(<span class="number">1</span>).max(<span class="number">10</span>).required()</span><br><span class="line"><span class="comment">// 密码的验证规则</span></span><br><span class="line"><span class="keyword">const</span> password = joi</span><br><span class="line">  .string()</span><br><span class="line">  .pattern(<span class="regexp">/^[\S]&#123;6,12&#125;$/</span>)</span><br><span class="line">  .required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册和登录表单的验证规则对象</span></span><br><span class="line"><span class="built_in">exports</span>.reg_login_schema = &#123;</span><br><span class="line">  <span class="comment">// 表示需要对 req.body 中的数据进行验证</span></span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>修改 <code>/router/user.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入验证表单数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; reg_login_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line"><span class="comment">// 3. 在注册新用户的路由中，声明局部中间件，对当前请求中携带的数据进行验证</span></span><br><span class="line"><span class="comment">// 3.1 数据验证通过后，会把这次请求流转给后面的路由处理函数</span></span><br><span class="line"><span class="comment">// 3.2 数据验证失败后，终止后续代码的执行，并抛出一个全局的 Error 错误，进入全局错误级别中间件中进行处理</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, expressJoi(reg_login_schema), userHandler.regUser)</span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, userHandler.login)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><ol start="5"><li>在 <code>app.js</code> 的全局错误级别中间件中，捕获验证失败的错误，并把验证失败的结果响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误中间件</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 数据验证失败</span></span><br><span class="line">  <span class="keyword">if</span> (err <span class="keyword">instanceof</span> joi.ValidationError) <span class="keyword">return</span> res.cc(err)</span><br><span class="line">  <span class="comment">// 未知错误</span></span><br><span class="line">  res.cc(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-6-登录"><a href="#2-6-登录" class="headerlink" title="2.6 登录"></a>2.6 登录</h3><h4 id="2-6-0-实现步骤"><a href="#2-6-0-实现步骤" class="headerlink" title="2.6.0 实现步骤"></a>2.6.0 实现步骤</h4><ol><li>检测表单数据是否合法</li><li>根据用户名查询用户的数据</li><li>判断用户输入的密码是否正确</li><li>生成 JWT 的 Token 字符串</li></ol><h4 id="2-6-1-检测登录表单的数据是否合法"><a href="#2-6-1-检测登录表单的数据是否合法" class="headerlink" title="2.6.1 检测登录表单的数据是否合法"></a>2.6.1 检测登录表单的数据是否合法</h4><ol><li>将 <code>/router/user.js</code> 中 <code>登录</code> 的路由代码修改如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, expressJoi(reg_login_schema), userHandler.login)</span><br></pre></td></tr></table></figure><h4 id="2-6-2-根据用户名查询用户的数据"><a href="#2-6-2-根据用户名查询用户的数据" class="headerlink" title="2.6.2 根据用户名查询用户的数据"></a>2.6.2 根据用户名查询用户的数据</h4><ol><li>接收表单数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userinfo = req.body</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句，查询用户的数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, userinfo.username, <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是查询到数据条数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.length !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;登录失败！&#x27;</span>)</span><br><span class="line">  <span class="comment">// TODO：判断用户输入的登录密码是否和数据库中的密码一致</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="2-6-3-判断用户输入的密码是否正确"><a href="#2-6-3-判断用户输入的密码是否正确" class="headerlink" title="2.6.3 判断用户输入的密码是否正确"></a>2.6.3 判断用户输入的密码是否正确</h4><blockquote><p>核心实现思路：调用 <code>bcrypt.compareSync(用户提交的密码, 数据库中的密码)</code> 方法比较密码是否一致</p></blockquote><blockquote><p>返回值是布尔值（true 一致、false 不一致）</p></blockquote><p>具体的实现代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿着用户输入的密码,和数据库中存储的密码进行对比</span></span><br><span class="line"><span class="keyword">const</span> compareResult = bcrypt.compareSync(userinfo.password, results[<span class="number">0</span>].password)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果对比的结果等于 false, 则证明用户输入的密码错误</span></span><br><span class="line"><span class="keyword">if</span> (!compareResult) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.cc(<span class="string">&#x27;登录失败！&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO：登录成功，生成 Token 字符串</span></span><br></pre></td></tr></table></figure><h4 id="2-6-4-生成-JWT-的-Token-字符串"><a href="#2-6-4-生成-JWT-的-Token-字符串" class="headerlink" title="2.6.4 生成 JWT 的 Token 字符串"></a>2.6.4 生成 JWT 的 Token 字符串</h4><blockquote><p>核心注意点：在生成 Token 字符串的时候，一定要剔除 <strong>密码</strong> 和 <strong>头像</strong> 的值</p></blockquote><ol><li>通过 ES6 的高级语法，快速剔除 <code>密码</code> 和 <code>头像</code> 的值：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 剔除完毕之后，user 中只保留了用户的 id, username, nickname, email 这四个属性的值</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; ...results[<span class="number">0</span>], <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">user_pic</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装生成 Token 字符串的包：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jsonwebtoken@8.5.1</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/user.js</code> 模块的头部区域，导入 <code>jsonwebtoken</code> 包：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用这个包来生成 Token 字符串</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>创建 <code>config.js</code> 文件，并向外共享 <strong>加密</strong> 和 <strong>还原</strong> Token 的 <code>jwtSecretKey</code> 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">jwtSecretKey</span>: <span class="string">&#x27;itheima No1. ^_^&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>将用户信息对象加密成 Token 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成 Token 字符串</span></span><br><span class="line"><span class="keyword">const</span> tokenStr = jwt.sign(user, config.jwtSecretKey, &#123;</span><br><span class="line">  <span class="attr">expiresIn</span>: <span class="string">&#x27;10h&#x27;</span>, <span class="comment">// token 有效期为 10 个小时</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="6"><li>将生成的 Token 字符串响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.send(&#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">  <span class="comment">// 为了方便客户端使用 Token，在服务器端直接拼接上 Bearer 的前缀</span></span><br><span class="line">  <span class="attr">token</span>: <span class="string">&#x27;Bearer &#x27;</span> + tokenStr,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-7-配置解析-Token-的中间件"><a href="#2-7-配置解析-Token-的中间件" class="headerlink" title="2.7 配置解析 Token 的中间件"></a>2.7 配置解析 Token 的中间件</h3><ol><li>运行如下的命令，安装解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-jwt@<span class="number">5.3</span><span class="number">.3</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中注册路由之前，配置解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析 token 的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 .unless(&#123; path: [/^\/api\//] &#125;) 指定哪些接口不需要进行 Token 的身份认证</span></span><br><span class="line">app.use(expressJWT(&#123; <span class="attr">secret</span>: config.jwtSecretKey &#125;).unless(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>app.js</code> 中的 <code>错误级别中间件</code> 里面，捕获并处理 Token 认证失败后的错误：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误中间件</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 省略其它代码...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 捕获身份认证失败的错误</span></span><br><span class="line">  <span class="keyword">if</span> (err.name === <span class="string">&#x27;UnauthorizedError&#x27;</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;身份认证失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未知错误...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="3-个人中心"><a href="#3-个人中心" class="headerlink" title="3. 个人中心"></a>3. 个人中心</h2><h3 id="3-1-获取用户的基本信息"><a href="#3-1-获取用户的基本信息" class="headerlink" title="3.1 获取用户的基本信息"></a>3.1 获取用户的基本信息</h3><h4 id="3-1-0-实现步骤"><a href="#3-1-0-实现步骤" class="headerlink" title="3.1.0 实现步骤"></a>3.1.0 实现步骤</h4><ol><li>初始化 <strong>路由</strong> 模块</li><li>初始化 <strong>路由处理函数</strong> 模块</li><li>获取用户的基本信息</li></ol><h4 id="3-1-1-初始化路由模块"><a href="#3-1-1-初始化路由模块" class="headerlink" title="3.1.1 初始化路由模块"></a>3.1.1 初始化路由模块</h4><ol><li>创建 <code>/router/userinfo.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的基本信息</span></span><br><span class="line">router.get(<span class="string">&#x27;/userinfo&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用个人中心的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用用户信息路由模块</span></span><br><span class="line"><span class="keyword">const</span> userinfoRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/userinfo&#x27;</span>)</span><br><span class="line"><span class="comment">// 注意：以 /my 开头的接口，都是有权限的接口，需要进行 Token 身份认证</span></span><br><span class="line">app.use(<span class="string">&#x27;/my&#x27;</span>, userinfoRouter)</span><br></pre></td></tr></table></figure><h4 id="3-1-2-初始化路由处理函数模块"><a href="#3-1-2-初始化路由处理函数模块" class="headerlink" title="3.1.2 初始化路由处理函数模块"></a>3.1.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/userinfo.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.getUserInfo = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/userinfo.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户信息的处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userinfo_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/userinfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的基本信息</span></span><br><span class="line">router.get(<span class="string">&#x27;/userinfo&#x27;</span>, userinfo_handler.getUserInfo)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><h4 id="3-1-3-获取用户的基本信息"><a href="#3-1-3-获取用户的基本信息" class="headerlink" title="3.1.3 获取用户的基本信息"></a>3.1.3 获取用户的基本信息</h4><ol><li>在 <code>/router_handler/userinfo.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据用户的 id，查询用户的基本信息</span></span><br><span class="line"><span class="comment">// 注意：为了防止用户的密码泄露，需要排除 password 字段</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select id, username, nickname, email, user_pic from ev_users where id=?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：req 对象上的 user 属性，是 Token 解析成功，express-jwt 中间件帮我们挂载上去的</span></span><br><span class="line">db.query(sql, req.user.id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 执行 SQL 语句成功，但是查询到的数据条数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.length !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;获取用户信息失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 将用户信息响应给客户端</span></span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取用户基本信息成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results[<span class="number">0</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-2-更新用户的基本信息"><a href="#3-2-更新用户的基本信息" class="headerlink" title="3.2 更新用户的基本信息"></a>3.2 更新用户的基本信息</h3><h4 id="3-2-0-实现步骤"><a href="#3-2-0-实现步骤" class="headerlink" title="3.2.0 实现步骤"></a>3.2.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户基本信息的功能</li></ol><h4 id="3-2-1-定义路由和处理函数"><a href="#3-2-1-定义路由和处理函数" class="headerlink" title="3.2.1 定义路由和处理函数"></a>3.2.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户基本信息</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户的基本信息</span></span><br><span class="line">router.post(<span class="string">&#x27;/userinfo&#x27;</span>, userinfo_handler.updateUserInfo)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户基本信息</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.updateUserInfo = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-验证表单数据"><a href="#3-2-2-验证表单数据" class="headerlink" title="3.2.2 验证表单数据"></a>3.2.2 验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>id</code>，<code>nickname</code>，<code>email</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 id, nickname, emial 的验证规则</span></span><br><span class="line"><span class="keyword">const</span> id = joi.number().integer().min(<span class="number">1</span>).required()</span><br><span class="line"><span class="keyword">const</span> nickname = joi.string().required()</span><br><span class="line"><span class="keyword">const</span> email = joi.string().email().required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 更新用户基本信息</span></span><br><span class="line"><span class="built_in">exports</span>.update_userinfo_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">    nickname,</span><br><span class="line">    email,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入验证数据合法性的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据合法性的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_userinfo_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户的基本信息</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户的基本信息</span></span><br><span class="line">router.post(<span class="string">&#x27;/userinfo&#x27;</span>, expressJoi(update_userinfo_schema), userinfo_handler.updateUserInfo)</span><br></pre></td></tr></table></figure><h4 id="3-2-3-实现更新用户基本信息的功能"><a href="#3-2-3-实现更新用户基本信息的功能" class="headerlink" title="3.2.3 实现更新用户基本信息的功能"></a>3.2.3 实现更新用户基本信息的功能</h4><ol><li>定义待执行的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_users set ? where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句并传参：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, [req.body, req.body.id], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但影响行数不为 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;修改用户基本信息失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改用户信息成功</span></span><br><span class="line">  <span class="keyword">return</span> res.cc(<span class="string">&#x27;修改用户基本信息成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-3-重置密码"><a href="#3-3-重置密码" class="headerlink" title="3.3 重置密码"></a>3.3 重置密码</h3><h4 id="3-3-0-实现步骤"><a href="#3-3-0-实现步骤" class="headerlink" title="3.3.0 实现步骤"></a>3.3.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现重置密码的功能</li></ol><h4 id="3-3-1-定义路由和处理函数"><a href="#3-3-1-定义路由和处理函数" class="headerlink" title="3.3.1 定义路由和处理函数"></a>3.3.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>重置密码</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/updatepwd&#x27;</span>, userinfo_handler.updatePassword)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>重置密码</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.updatePassword = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-2-验证表单数据"><a href="#3-3-2-验证表单数据" class="headerlink" title="3.3.2 验证表单数据"></a>3.3.2 验证表单数据</h4><blockquote><p>核心验证思路：旧密码与新密码，必须符合密码的验证规则，并且新密码不能与旧密码一致！</p></blockquote><ol><li>在 <code>/schema/user.js</code> 模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 重置密码</span></span><br><span class="line"><span class="built_in">exports</span>.update_password_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="comment">// 使用 password 这个规则，验证 req.body.oldPwd 的值</span></span><br><span class="line">    <span class="attr">oldPwd</span>: password,</span><br><span class="line">    <span class="comment">// 使用 joi.not(joi.ref(&#x27;oldPwd&#x27;)).concat(password) 规则，验证 req.body.newPwd 的值</span></span><br><span class="line">    <span class="comment">// 解读：</span></span><br><span class="line">    <span class="comment">// 1. joi.ref(&#x27;oldPwd&#x27;) 表示 newPwd 的值必须和 oldPwd 的值保持一致</span></span><br><span class="line">    <span class="comment">// 2. joi.not(joi.ref(&#x27;oldPwd&#x27;)) 表示 newPwd 的值不能等于 oldPwd 的值</span></span><br><span class="line">    <span class="comment">// 3. .concat() 用于合并 joi.not(joi.ref(&#x27;oldPwd&#x27;)) 和 password 这两条验证规则</span></span><br><span class="line">    <span class="attr">newPwd</span>: joi.not(joi.ref(<span class="string">&#x27;oldPwd&#x27;</span>)).concat(password),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_userinfo_schema, update_password_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>并在 <code>重置密码的路由</code> 中，使用 <code>update_password_schema</code> 规则验证表单的数据，示例代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/updatepwd&#x27;</span>, expressJoi(update_password_schema), userinfo_handler.updatePassword)</span><br></pre></td></tr></table></figure><h4 id="3-3-3-实现重置密码的功能"><a href="#3-3-3-实现重置密码的功能" class="headerlink" title="3.3.3 实现重置密码的功能"></a>3.3.3 实现重置密码的功能</h4><ol><li>根据 <code>id</code> 查询用户是否存在：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义根据 id 查询用户数据的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where id=?`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句查询用户是否存在</span></span><br><span class="line">db.query(sql, req.user.id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查指定 id 的用户是否存在</span></span><br><span class="line">  <span class="keyword">if</span> (results.length !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;用户不存在！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：判断提交的旧密码是否正确</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>判断提交的 <strong>旧密码</strong> 是否正确：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在头部区域导入 bcryptjs 后，</span></span><br><span class="line"><span class="comment">// 即可使用 bcrypt.compareSync(提交的密码，数据库中的密码) 方法验证密码是否正确</span></span><br><span class="line"><span class="comment">// compareSync() 函数的返回值为布尔值，true 表示密码正确，false 表示密码错误</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断提交的旧密码是否正确</span></span><br><span class="line"><span class="keyword">const</span> compareResult = bcrypt.compareSync(req.body.oldPwd, results[<span class="number">0</span>].password)</span><br><span class="line"><span class="keyword">if</span> (!compareResult) <span class="keyword">return</span> res.cc(<span class="string">&#x27;原密码错误！&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>对新密码进行 <code>bcrypt</code> 加密之后，更新到数据库中：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义更新用户密码的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_users set password=? where id=?`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对新密码进行 bcrypt 加密处理</span></span><br><span class="line"><span class="keyword">const</span> newPwd = bcrypt.hashSync(req.body.newPwd, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句，根据 id 更新用户的密码</span></span><br><span class="line">db.query(sql, [newPwd, req.user.id], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// SQL 语句执行失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;更新密码失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新密码成功</span></span><br><span class="line">  res.cc(<span class="string">&#x27;更新密码成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-4-更新用户头像"><a href="#3-4-更新用户头像" class="headerlink" title="3.4 更新用户头像"></a>3.4 更新用户头像</h3><h4 id="3-4-0-实现步骤"><a href="#3-4-0-实现步骤" class="headerlink" title="3.4.0 实现步骤"></a>3.4.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户头像的功能</li></ol><h4 id="3-4-1-定义路由和处理函数"><a href="#3-4-1-定义路由和处理函数" class="headerlink" title="3.4.1 定义路由和处理函数"></a>3.4.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户头像</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户头像的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/update/avatar&#x27;</span>, userinfo_handler.updateAvatar)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户头像</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户头像的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.updateAvatar = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-4-2-验证表单数据"><a href="#3-4-2-验证表单数据" class="headerlink" title="3.4.2 验证表单数据"></a>3.4.2 验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>avatar</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dataUri() 指的是如下格式的字符串数据：</span></span><br><span class="line"><span class="comment">// data:image/png;base64,VE9PTUFOWVNFQ1JFVFM=</span></span><br><span class="line"><span class="keyword">const</span> avatar = joi.string().dataUri().required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证规则对象 - 更新头像</span></span><br><span class="line"><span class="built_in">exports</span>.update_avatar_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    avatar,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; update_avatar_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户头像</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/update/avatar&#x27;</span>, expressJoi(update_avatar_schema), userinfo_handler.updateAvatar)</span><br></pre></td></tr></table></figure><h4 id="3-4-3-实现更新用户头像的功能"><a href="#3-4-3-实现更新用户头像的功能" class="headerlink" title="3.4.3 实现更新用户头像的功能"></a>3.4.3 实现更新用户头像的功能</h4><ol><li>定义更新用户头像的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;update ev_users set user_pic=? where id=?&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，更新对应用户的头像：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, [req.body.avatar, req.user.id], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;更新头像失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新用户头像成功</span></span><br><span class="line">  <span class="keyword">return</span> res.cc(<span class="string">&#x27;更新头像成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-文章分类管理"><a href="#4-文章分类管理" class="headerlink" title="4. 文章分类管理"></a>4. 文章分类管理</h2><h3 id="4-1-新建-ev-article-cate-表"><a href="#4-1-新建-ev-article-cate-表" class="headerlink" title="4.1 新建 ev_article_cate 表"></a>4.1 新建 ev_article_cate 表</h3><h4 id="4-1-1-创建表结构"><a href="#4-1-1-创建表结构" class="headerlink" title="4.1.1 创建表结构"></a>4.1.1 创建表结构</h4><p><img src="D:\BaiduNetdiskDownload\images\2.jpg" alt="文章分类表结构"></p><h4 id="4-1-2-新增两条初始数据"><a href="#4-1-2-新增两条初始数据" class="headerlink" title="4.1.2 新增两条初始数据"></a>4.1.2 新增两条初始数据</h4><p><img src="D:\BaiduNetdiskDownload\images\3.jpg" alt="文章分类表结构"></p><h3 id="4-2-获取文章分类列表"><a href="#4-2-获取文章分类列表" class="headerlink" title="4.2 获取文章分类列表"></a>4.2 获取文章分类列表</h3><h4 id="4-2-0-实现步骤"><a href="#4-2-0-实现步骤" class="headerlink" title="4.2.0 实现步骤"></a>4.2.0 实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>获取文章分类列表数据</li></ol><h4 id="4-2-1-初始化路由模块"><a href="#4-2-1-初始化路由模块" class="headerlink" title="4.2.1 初始化路由模块"></a>4.2.1 初始化路由模块</h4><ol><li>创建 <code>/router/artcate.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文章分类的列表数据</span></span><br><span class="line">router.get(<span class="string">&#x27;/cates&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章分类的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用文章分类路由模块</span></span><br><span class="line"><span class="keyword">const</span> artCateRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/artcate&#x27;</span>)</span><br><span class="line"><span class="comment">// 为文章分类的路由挂载统一的访问前缀 /my/article</span></span><br><span class="line">app.use(<span class="string">&#x27;/my/article&#x27;</span>, artCateRouter)</span><br></pre></td></tr></table></figure><h4 id="4-2-2-初始化路由处理函数模块"><a href="#4-2-2-初始化路由处理函数模块" class="headerlink" title="4.2.2 初始化路由处理函数模块"></a>4.2.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/artcate.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文章分类列表数据的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.getArticleCates = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/artcate.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文章分类的路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> artcate_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文章分类的列表数据</span></span><br><span class="line">router.get(<span class="string">&#x27;/cates&#x27;</span>, artcate_handler.getArticleCates)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><h4 id="4-2-3-获取文章分类列表数据"><a href="#4-2-3-获取文章分类列表数据" class="headerlink" title="4.2.3 获取文章分类列表数据"></a>4.2.3 获取文章分类列表数据</h4><ol><li>在 <code>/router_handler/artcate.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据分类的状态，获取所有未被删除的分类列表数据</span></span><br><span class="line"><span class="comment">// is_delete 为 0 表示没有被 标记为删除 的数据</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;select * from ev_article_cate where is_delete=0 order by id asc&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 执行 SQL 语句成功</span></span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取文章分类列表成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-3-新增文章分类"><a href="#4-3-新增文章分类" class="headerlink" title="4.3 新增文章分类"></a>4.3 新增文章分类</h3><h4 id="4-3-0-实现步骤"><a href="#4-3-0-实现步骤" class="headerlink" title="4.3.0 实现步骤"></a>4.3.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现新增文章分类的功能</li></ol><h4 id="4-3-1-定义路由和处理函数"><a href="#4-3-1-定义路由和处理函数" class="headerlink" title="4.3.1 定义路由和处理函数"></a>4.3.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>新增文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/addcates&#x27;</span>, artcate_handler.addArticleCates)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>新增文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.addArticleCates = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3-2-验证表单数据"><a href="#4-3-2-验证表单数据" class="headerlink" title="4.3.2 验证表单数据"></a>4.3.2 验证表单数据</h4><ol><li>创建 <code>/schema/artcate.js</code> 文章分类数据验证模块，并定义如下的验证规则：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入定义验证规则的模块</span></span><br><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 分类名称 和 分类别名 的校验规则</span></span><br><span class="line"><span class="keyword">const</span> name = joi.string().required()</span><br><span class="line"><span class="keyword">const</span> alias = joi.string().alphanum().required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验规则对象 - 添加分类</span></span><br><span class="line"><span class="built_in">exports</span>.add_cate_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    name,</span><br><span class="line">    alias,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，使用 <code>add_cate_schema</code> 对数据进行验证：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入文章分类的验证模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; add_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增文章分类的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/addcates&#x27;</span>, expressJoi(add_cate_schema), artcate_handler.addArticleCates)</span><br></pre></td></tr></table></figure><h4 id="4-3-3-查询分类名称与别名是否被占用"><a href="#4-3-3-查询分类名称与别名是否被占用" class="headerlink" title="4.3.3 查询分类名称与别名是否被占用"></a>4.3.3 查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where name=? or alias=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行查重操作</span></span><br><span class="line">db.query(sql, [req.body.name, req.body.alias], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">2</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="comment">// 分别判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].name === req.body.name) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].alias === req.body.alias) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：新增文章分类</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="4-3-4-实现新增文章分类的功能"><a href="#4-3-4-实现新增文章分类的功能" class="headerlink" title="4.3.4 实现新增文章分类的功能"></a>4.3.4 实现新增文章分类的功能</h4><ol><li>定义新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`insert into ev_article_cate set ?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, req.body, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// SQL 语句执行失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;新增文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 新增文章分类成功</span></span><br><span class="line">  res.cc(<span class="string">&#x27;新增文章分类成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-4-根据-Id-删除文章分类"><a href="#4-4-根据-Id-删除文章分类" class="headerlink" title="4.4 根据 Id 删除文章分类"></a>4.4 根据 Id 删除文章分类</h3><h4 id="4-4-0-实现步骤"><a href="#4-4-0-实现步骤" class="headerlink" title="4.4.0 实现步骤"></a>4.4.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现删除文章分类的功能</li></ol><h4 id="4-4-1-定义路由和处理函数"><a href="#4-4-1-定义路由和处理函数" class="headerlink" title="4.4.1 定义路由和处理函数"></a>4.4.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>删除文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&#x27;/deletecate/:id&#x27;</span>, artcate_handler.deleteCateById)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>删除文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.deleteCateById = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-4-2-验证表单数据"><a href="#4-4-2-验证表单数据" class="headerlink" title="4.4.2 验证表单数据"></a>4.4.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，定义 id 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 分类Id 的校验规则</span></span><br><span class="line"><span class="keyword">const</span> id = joi.number().integer().min(<span class="number">1</span>).required()</span><br></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 删除分类</span></span><br><span class="line"><span class="built_in">exports</span>.delete_cate_schema = &#123;</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入删除分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; delete_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&#x27;/deletecate/:id&#x27;</span>, expressJoi(delete_cate_schema), artcate_handler.deleteCateById)</span><br></pre></td></tr></table></figure><h4 id="4-4-3-实现删除文章分类的功能"><a href="#4-4-3-实现删除文章分类的功能" class="headerlink" title="4.4.3 实现删除文章分类的功能"></a>4.4.3 实现删除文章分类的功能</h4><ol><li>定义删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_article_cate set is_delete=1 where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, req.params.id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;删除文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除文章分类成功</span></span><br><span class="line">  res.cc(<span class="string">&#x27;删除文章分类成功！&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-5-根据-Id-获取文章分类数据"><a href="#4-5-根据-Id-获取文章分类数据" class="headerlink" title="4.5 根据 Id 获取文章分类数据"></a>4.5 根据 Id 获取文章分类数据</h3><h4 id="4-5-0-实现步骤"><a href="#4-5-0-实现步骤" class="headerlink" title="4.5.0 实现步骤"></a>4.5.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现获取文章分类的功能</li></ol><h4 id="4-5-1-定义路由和处理函数"><a href="#4-5-1-定义路由和处理函数" class="headerlink" title="4.5.1 定义路由和处理函数"></a>4.5.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>根据 Id 获取文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/cates/:id&#x27;</span>, artcate_handler.getArticleById)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>根据 Id 获取文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 Id 获取文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.getArticleById = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-5-2-验证表单数据"><a href="#4-5-2-验证表单数据" class="headerlink" title="4.5.2 验证表单数据"></a>4.5.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 根据 Id 获取分类</span></span><br><span class="line"><span class="built_in">exports</span>.get_cate_schema = &#123;</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    id,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入根据 Id 获取分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; get_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 Id 获取文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&#x27;/cates/:id&#x27;</span>, expressJoi(get_cate_schema), artcate_handler.getArticleById)</span><br></pre></td></tr></table></figure><h4 id="4-5-3-实现获取文章分类的功能"><a href="#4-5-3-实现获取文章分类的功能" class="headerlink" title="4.5.3 实现获取文章分类的功能"></a>4.5.3 实现获取文章分类的功能</h4><ol><li>定义根据 Id 获取文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, req.params.id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是没有查询到任何数据</span></span><br><span class="line">  <span class="keyword">if</span> (results.length !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;获取文章分类数据失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把数据响应给客户端</span></span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取文章分类数据成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: results[<span class="number">0</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-6-根据-Id-更新文章分类数据"><a href="#4-6-根据-Id-更新文章分类数据" class="headerlink" title="4.6 根据 Id 更新文章分类数据"></a>4.6 根据 Id 更新文章分类数据</h3><h4 id="4-6-0-实现步骤"><a href="#4-6-0-实现步骤" class="headerlink" title="4.6.0 实现步骤"></a>4.6.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现更新文章分类的功能</li></ol><h4 id="4-6-1-定义路由和处理函数"><a href="#4-6-1-定义路由和处理函数" class="headerlink" title="4.6.1 定义路由和处理函数"></a>4.6.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>更新文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新文章分类的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/updatecate&#x27;</span>, artcate_handler.updateCateById)</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>更新文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.updateCateById = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-6-2-验证表单数据"><a href="#4-6-2-验证表单数据" class="headerlink" title="4.6.2 验证表单数据"></a>4.6.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则对象 - 更新分类</span></span><br><span class="line"><span class="built_in">exports</span>.update_cate_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">Id</span>: id,</span><br><span class="line">    name,</span><br><span class="line">    alias,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入更新文章分类的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; update_cate_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/artcate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新文章分类的路由</span></span><br><span class="line">router.post(<span class="string">&#x27;/updatecate&#x27;</span>, expressJoi(update_cate_schema), artcate_handler.updateCateById)</span><br></pre></td></tr></table></figure><h4 id="4-5-4-查询分类名称与别名是否被占用"><a href="#4-5-4-查询分类名称与别名是否被占用" class="headerlink" title="4.5.4 查询分类名称与别名是否被占用"></a>4.5.4 查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_article_cate where Id&lt;&gt;? and (name=? or alias=?)`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行查重操作</span></span><br><span class="line">db.query(sql, [req.body.Id, req.body.name, req.body.alias], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断 分类名称 和 分类别名 是否被占用</span></span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">2</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].name === req.body.name) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (results.length === <span class="number">1</span> &amp;&amp; results[<span class="number">0</span>].alias === req.body.alias) <span class="keyword">return</span> res.cc(<span class="string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：更新文章分类</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="4-5-5-实现更新文章分类的功能"><a href="#4-5-5-实现更新文章分类的功能" class="headerlink" title="4.5.5 实现更新文章分类的功能"></a>4.5.5 实现更新文章分类的功能</h4><ol><li>定义更新文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`update ev_article_cate set ? where Id=?`</span></span><br></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.query(sql, [req.body, req.body.Id], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SQL 语句执行成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;更新文章分类失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新文章分类成功</span></span><br><span class="line">  res.cc(<span class="string">&#x27;更新文章分类成功！&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="5-文章管理"><a href="#5-文章管理" class="headerlink" title="5. 文章管理"></a>5. 文章管理</h2><h3 id="5-1-新建-ev-articles-表"><a href="#5-1-新建-ev-articles-表" class="headerlink" title="5.1 新建 ev_articles 表"></a>5.1 新建 ev_articles 表</h3><p><img src="D:\BaiduNetdiskDownload\images\4.jpg" alt="ev_articles表结构"></p><h3 id="5-2-发布新文章"><a href="#5-2-发布新文章" class="headerlink" title="5.2 发布新文章"></a>5.2 发布新文章</h3><h4 id="5-2-0-实现步骤"><a href="#5-2-0-实现步骤" class="headerlink" title="5.2.0 实现步骤"></a>5.2.0 实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>使用 multer 解析表单数据</li><li>验证表单数据</li><li>实现发布文章的功能</li></ol><h4 id="5-2-1-初始化路由模块"><a href="#5-2-1-初始化路由模块" class="headerlink" title="5.2.1 初始化路由模块"></a>5.2.1 初始化路由模块</h4><ol><li>创建 <code>/router/article.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享路由对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并使用文章路由模块</span></span><br><span class="line"><span class="keyword">const</span> articleRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/article&#x27;</span>)</span><br><span class="line"><span class="comment">// 为文章的路由挂载统一的访问前缀 /my/article</span></span><br><span class="line">app.use(<span class="string">&#x27;/my/article&#x27;</span>, articleRouter)</span><br></pre></td></tr></table></figure><h4 id="5-2-2-初始化路由处理函数模块"><a href="#5-2-2-初始化路由处理函数模块" class="headerlink" title="5.2.2 初始化路由处理函数模块"></a>5.2.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/article.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.addArticle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/artcate.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文章的路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> article_handler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/article&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, article_handler.addArticle)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><h4 id="5-2-3-使用-multer-解析表单数据"><a href="#5-2-3-使用-multer-解析表单数据" class="headerlink" title="5.2.3 使用 multer 解析表单数据"></a>5.2.3 使用 multer 解析表单数据</h4><blockquote><p>注意：使用 <code>express.urlencoded()</code> 中间件无法解析 <code>multipart/form-data</code> 格式的请求体数据。</p></blockquote><blockquote><p>当前项目，推荐使用 multer 来解析 <code>multipart/form-data</code> 格式的表单数据。<a href="https://www.npmjs.com/package/multer">https://www.npmjs.com/package/multer</a></p></blockquote><ol><li>运行如下的终端命令，在项目中安装 <code>multer</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i multer@1.4.2</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/article.js</code> 模块中导入并配置 <code>multer</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入解析 formdata 格式表单数据的包</span></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入处理路径的核心模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 multer 的实例对象，通过 dest 属性指定文件的存放路径</span></span><br><span class="line"><span class="keyword">const</span> upload = multer(&#123; <span class="attr">dest</span>: path.join(__dirname, <span class="string">&#x27;../uploads&#x27;</span>) &#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>修改 <code>发布新文章</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// upload.single() 是一个局部生效的中间件，用来解析 FormData 格式的表单数据</span></span><br><span class="line"><span class="comment">// 将文件类型的数据，解析并挂载到 req.file 属性中</span></span><br><span class="line"><span class="comment">// 将文本类型的数据，解析并挂载到 req.body 属性中</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, upload.single(<span class="string">&#x27;cover_img&#x27;</span>), article_handler.addArticle)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，将 <code>multer</code> 解析出来的数据进行打印：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.addArticle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body) <span class="comment">// 文本类型的数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;--------分割线----------&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(req.file) <span class="comment">// 文件类型的数据</span></span><br><span class="line"></span><br><span class="line">  res.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="5-2-4-验证表单数据"><a href="#5-2-4-验证表单数据" class="headerlink" title="5.2.4 验证表单数据"></a>5.2.4 验证表单数据</h4><blockquote><p>实现思路：通过 express-joi <strong>自动验证</strong> req.body 中的文本数据；通过 if 判断<strong>手动验证</strong> req.file 中的文件数据；</p></blockquote><ol><li>创建 <code>/schema/article.js</code> 验证规则模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入定义验证规则的模块</span></span><br><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 标题、分类Id、内容、发布状态 的验证规则</span></span><br><span class="line"><span class="keyword">const</span> title = joi.string().required()</span><br><span class="line"><span class="keyword">const</span> cate_id = joi.number().integer().min(<span class="number">1</span>).required()</span><br><span class="line"><span class="keyword">const</span> content = joi.string().required().allow(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> state = joi.string().valid(<span class="string">&#x27;已发布&#x27;</span>, <span class="string">&#x27;草稿&#x27;</span>).required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证规则对象 - 发布文章</span></span><br><span class="line"><span class="built_in">exports</span>.add_article_schema = &#123;</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    title,</span><br><span class="line">    cate_id,</span><br><span class="line">    content,</span><br><span class="line">    state,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/article.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 导入文章的验证模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; add_article_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/article&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// 注意：在当前的路由中，先后使用了两个中间件：</span></span><br><span class="line"><span class="comment">//       先使用 multer 解析表单数据</span></span><br><span class="line"><span class="comment">//       再使用 expressJoi 对解析的表单数据进行验证</span></span><br><span class="line">router.post(<span class="string">&#x27;/add&#x27;</span>, upload.single(<span class="string">&#x27;cover_img&#x27;</span>), expressJoi(add_article_schema), article_handler.addArticle)</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，通过 <code>if</code> 判断客户端是否提交了 <code>封面图片</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.addArticle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 手动判断是否上传了文章封面</span></span><br><span class="line">  <span class="keyword">if</span> (!req.file || req.file.fieldname !== <span class="string">&#x27;cover_img&#x27;</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;文章封面是必选参数！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO：表单数据合法，继续后面的处理流程...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="5-2-5-实现发布文章的功能"><a href="#5-2-5-实现发布文章的功能" class="headerlink" title="5.2.5 实现发布文章的功能"></a>5.2.5 实现发布文章的功能</h4><ol><li>整理要插入数据库的文章信息对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入处理路径的 path 核心模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> articleInfo = &#123;</span><br><span class="line">  <span class="comment">// 标题、内容、状态、所属的分类Id</span></span><br><span class="line">  ...req.body,</span><br><span class="line">  <span class="comment">// 文章封面在服务器端的存放路径</span></span><br><span class="line">  <span class="attr">cover_img</span>: path.join(<span class="string">&#x27;/uploads&#x27;</span>, req.file.filename),</span><br><span class="line">  <span class="comment">// 文章发布时间</span></span><br><span class="line">  <span class="attr">pub_date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  <span class="comment">// 文章作者的Id</span></span><br><span class="line">  <span class="attr">author_id</span>: req.user.id,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>定义发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">`insert into ev_articles set ?`</span></span><br></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句</span></span><br><span class="line">db.query(sql, articleInfo, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行 SQL 语句失败</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span></span><br><span class="line">  <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;发布文章失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布文章成功</span></span><br><span class="line">  res.cc(<span class="string">&#x27;发布文章成功&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>在 <code>app.js</code> 中，使用 <code>express.static()</code> 中间件，将 <code>uploads</code> 目录中的图片托管为静态资源：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 托管静态资源文件</span></span><br><span class="line">app.use(<span class="string">&#x27;/uploads&#x27;</span>, express.static(<span class="string">&#x27;./uploads&#x27;</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 项目文档 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在阿里云服务器上使用Nginx从零开始建站</title>
      <link href="/archives/b830f3e.html"/>
      <url>/archives/b830f3e.html</url>
      
        <content type="html"><![CDATA[<h1 id="在阿里云服务器上使用Nginx从零开始建站"><a href="#在阿里云服务器上使用Nginx从零开始建站" class="headerlink" title="在阿里云服务器上使用Nginx从零开始建站"></a>在阿里云服务器上使用Nginx从零开始建站</h1><h2 id="阿里云ECS服务器安装Nginx"><a href="#阿里云ECS服务器安装Nginx" class="headerlink" title="阿里云ECS服务器安装Nginx"></a>阿里云ECS服务器安装Nginx</h2><h3 id="什么是Nginx"><a href="#什么是Nginx" class="headerlink" title="什么是Nginx"></a>什么是Nginx</h3><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，公开版本1.19.6发布于2020年12月15日。<br>其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、简单的配置文件和低系统资源的消耗而闻名。2022年01月25日，nginx 1.21.6发布。<br>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好。</p><h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx  //进入到根目录下的etc下创建nginx目录在目录中下载</span><br></pre></td></tr></table></figure><h3 id="Nginx的启动停止重启命令"><a href="#Nginx的启动停止重启命令" class="headerlink" title="Nginx的启动停止重启命令"></a>Nginx的启动停止重启命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@example ~]# service nginx start </span><br><span class="line"></span><br><span class="line">[root@example ~]# service nginx stop </span><br><span class="line"></span><br><span class="line">[root@example ~]# service nginx reload</span><br></pre></td></tr></table></figure><h3 id="查看nginx运行状态"><a href="#查看nginx运行状态" class="headerlink" title="查看nginx运行状态"></a>查看nginx运行状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure><h2 id="Nginx的基础配置详解"><a href="#Nginx的基础配置详解" class="headerlink" title="Nginx的基础配置详解"></a>Nginx的基础配置详解</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  用户以什么身份进入</span></span><br><span class="line">user root;</span><br><span class="line"><span class="meta">#</span><span class="bash">   工作的子进程个数</span></span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  事件驱动模块</span></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   数据零拷贝：nginx将要发送的文件信息发送到网络接口，使网络接口直接调用文件进行发送。当数据零拷贝关闭时，文件会被复制到nginx应用程序内存中再从程序内存中复制给网络接口进行发送</span></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line"><span class="meta">#</span><span class="bash">   保持链接超时的时间</span></span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   将外部的配置文件引入到当前文件中（mime.type：文件类型与加载方式的映射表，设置在请求头中，用来标注该文件是什么类型的文件，使浏览器正确解析该文件）</span></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line"><span class="meta">#</span><span class="bash">   文件默认的类型：当文件类型在 mime,<span class="built_in">type</span> 中找不到对应的类型时，使用默认的加载方式 （application/octet-stream：告诉浏览器，以文件流的形式加载）</span></span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个 server 相当于一个虚拟主机</span></span><br><span class="line">    server &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash">       当前主机监听的端口号（不能重复）</span></span><br><span class="line">        listen       80;</span><br><span class="line">        listen       [::]:80;</span><br><span class="line"><span class="meta">#</span><span class="bash">       当前主机的主机名（可以配置为域名或主机名）</span></span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       匹配对应的uri路径</span></span><br><span class="line">        location / &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash">           当匹配到 / 时，从那个目录寻找对应的网页</span></span><br><span class="line">            root /root/print;</span><br><span class="line"><span class="meta">#</span><span class="bash">           默认展示的页面</span></span><br><span class="line">            index index.html;</span><br><span class="line">            try_files $uri $uri/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       尚品汇的反向代理路径</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       location /api &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">           proxy_pass http://gmall-h5-api.atguigu.cn;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       &#125;</span> </span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line"><span class="meta">#</span><span class="bash">       错误页面配置：当服务器内部发生500 502 503 504 错误时，跳转到 http://47.114.74.114/50x.html 页面</span></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line"><span class="meta">#</span><span class="bash">       当用户访问 http://47.114.74.114/50x.html 时跳转到用户自定义的页面</span></span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash">       自定义错误页面（root/html目录下寻找）</span></span><br><span class="line"><span class="meta">#</span><span class="bash">            root /root/html</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;               </span><br></pre></td></tr></table></figure><p>注意：</p><ol><li><p>listen和server_name相加必须是唯一的</p></li><li><p>一个server_name可以配置多个主机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_name xxx.hawkingl.cn xxx.hawlingl.cn *.hawkingl.cn;</span><br></pre></td></tr></table></figure></li><li><p>修改完Nginx配置文件后记得重启Nginx</p></li></ol><h2 id="进行域名解析"><a href="#进行域名解析" class="headerlink" title="进行域名解析"></a>进行域名解析</h2><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_16-14-40.jpg"></p><ul><li>TCP/IP：使文件以数据流的形式进行传输</li><li>HTTP：对传输的文件流进行协商传输</li><li>DNS：域名解析服务</li></ul><h3 id="域名，DNS，IP地址之间的关系"><a href="#域名，DNS，IP地址之间的关系" class="headerlink" title="域名，DNS，IP地址之间的关系"></a>域名，DNS，IP地址之间的关系</h3><p><strong>在浏览器器上通过域名访问到DNS服务器，DNS服务器返回域名对应的IP地址，浏览器再通过IP地址访问对应的服务器，其中DNS相当于一个映射表，将域名与IP进行映射。</strong></p><p>一个服务器可以有多个虚拟主机，一个ip地址可以绑定多个域名；实际生产环境中可以将多个域名同时指向一个服务器，服务器通过Nginx给不同的域名返回不同的页面。</p><h3 id="阿里云域名解析"><a href="#阿里云域名解析" class="headerlink" title="阿里云域名解析"></a>阿里云域名解析</h3><p>域名解析相当于在DNS服务器中保存你的域名和IP，可以通过二级域名配置多个映射关系，将所有的域名都指向同一个IP</p><ol><li><p>再域名服务中找到需要解析的域名，点击解析<img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_17-10-15.jpg"></p></li><li><p>添加解析记录<img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_17-16-43.jpg"></p></li><li><p>常用记录类型的说明<img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_17-23-47.jpg"></p></li><li><p>主机记录，即你在浏览器搜索时输入的域名的格式 <img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_17-26-22.jpg"></p></li><li><p>记录值为你指向的IP地址或域名</p></li></ol><h2 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h2><p>如果把局域网外的 <code>Internet </code>想象成一个巨大的资源库，则局域网中的客户端要访问 <code>Internet</code>，则需要通过代理服务器来访问，这种代理服务就称为正向代理，下面是正向代理的原理图。</p><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-25_20-16-27.jpg"></p><p>其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 <code>IP </code>地址。</p><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>所谓负载均衡就是：就是把大量的请求按照我们指定的方式均衡的分配给集群中的每台服务器，从而不会产生集群中大量请求只请求某一台服务器，从而使该服务器宕机的情况。</p><h2 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h2><h3 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h3><p>Referer  是  HTTP  请求header 的一部分，当浏览器（或者模拟浏览器行为）向web 服务器发送请求的时候，头信息里有包含  Referer  。比如我在<a href="http://www.google.com/">www.google.com</a> 里有一个<a href="http://www.baidu.com/">www.baidu.com</a> 链接，那么点击这个<a href="http://www.baidu.com/">www.baidu.com</a> ，向它发送的请求头中就有Referer信息：</p><pre><code>Referer=http://www.google.com</code></pre><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-29_11-14-47.jpg"></p><p>注意：</p><ul><li>Referer在浏览器端是无法修改的，是浏览器自动加在请求头中的</li><li>Referer只有在一个页面中再次访问另一个网址时才会添加，第一次访问时不会添加</li></ul><h3 id="防盗链-1"><a href="#防盗链-1" class="headerlink" title="防盗链"></a>防盗链</h3><p>将这个http请求发给服务器后，如果服务器要求必须是某个地址或者某几个地址才能访问，而你发送的referer不符合他的要求，就会拦截或者跳转到他要求的地址，然后再通过这个地址进行访问。</p><p>nginx中防盗链的基本配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">listen  80;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">rewrite /([0-9]+).html$ /index.jsp?pageNum=$1 break;</span><br><span class="line">proxy_pass http://httpds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在location中配置防盗链</span></span><br><span class="line">location ~*/(js img css)&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash">只有来自 192.168.44.101 这个地址的请求才可以被响应，referer后也可以直接配置域名</span></span><br><span class="line">  valid referers 192.168.44.101;</span><br><span class="line"><span class="meta">#</span><span class="bash">如果是其他地址的请求直接返回 403 错误</span></span><br><span class="line">  if ($invalid_referer)&#123;</span><br><span class="line">    return 403;</span><br><span class="line">  &#125;</span><br><span class="line">root html;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error_page 500 502 503 504 /50x.html;</span><br><span class="line">location =/50x.html &#123;</span><br><span class="line">  root html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网站部署 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssl证书的申请流程</title>
      <link href="/archives/1da797b4.html"/>
      <url>/archives/1da797b4.html</url>
      
        <content type="html"><![CDATA[<h2 id="ssl证书的介绍"><a href="#ssl证书的介绍" class="headerlink" title="ssl证书的介绍"></a>ssl证书的介绍</h2><p>SSL证书是数字证书的一种，类似于驾驶证、护照和营业执照的电子副本。因为配置在服务器上，也称为SSL服务器证书。</p><p>SSL 证书就是遵守 SSL协议，由受信任的数字证书颁发机构CA，在验证服务器身份后颁发，具有服务器身份验证和数据传输加密功能。</p><p>SSL证书通过在客户端浏览器和Web服务器之间建立一条SSL安全通道（Secure socket layer(SSL)安全协议是由Netscape Communication公司设计开发。该安全协议主要用来提供对用户和服务器的认证；对传送的数据进行加密和隐藏；确保数据在传送中不被改变，即数据的完整性，现已成为该领域中全球化的标准。由于SSL技术已建立到所有主要的浏览器和WEB服务器程序中，因此，仅需安装服务器证书就可以激活该功能了），即通过它可以激活SSL协议，实现数据信息在客户端和服务器之间的加密传输，可以防止数据信息的泄露，保证了双方传递信息的安全性，而且用户可以通过服务器证书验证他所访问的网站是否是真实可靠。数字签名又名数字标识、签章 (即 Digital Certificate，Digital ID )，提供了一种在网上进行身份验证的方法，是用来标志和证明网络通信双方身份的数字信息文件，概念类似日常生活中的司机驾照或身份证。 数字签名主要用于发送安全电子邮件、访问安全站点、网上招标与投标、网上签约、网上订购、网上公文安全传送、网上办公、网上缴费、网上缴税以及网上购物等安全的网上电子交易活动。</p><h2 id="ssl证书的申请流程"><a href="#ssl证书的申请流程" class="headerlink" title="ssl证书的申请流程"></a>ssl证书的申请流程</h2><p>打开你的域名控制台，开启ssl证书</p><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-29_22-42-50.jpg"></p><p>点击ssl证书，申请免费证书</p><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-29_22-45-54.jpg"></p><p>填写完认证的相关信息后等待审核，大概几秒钟就好了，多刷新几遍</p><p>审核完后下载证书</p><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-29_22-47-55.jpg"></p><p>将解压后的两个证书文件上传至服务器，可自定义上传路径</p><p>上传后进行证书的安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ss1;</span><br><span class="line">    server_name aa.abc.com;</span><br><span class="line"><span class="meta">#</span><span class="bash">.pem文件所在的目录</span></span><br><span class="line">    ss1_certificate   /data/cert/server.crt;</span><br><span class="line"><span class="meta">#</span><span class="bash">.key所在的目录</span></span><br><span class="line">    ss1_certificate_key  /data/cert/server.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Https </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图解Https的工作原理</title>
      <link href="/archives/7fb369f0.html"/>
      <url>/archives/7fb369f0.html</url>
      
        <content type="html"><![CDATA[<h1 id="图解Https的的工作原理"><a href="#图解Https的的工作原理" class="headerlink" title="图解Https的的工作原理"></a>图解Https的的工作原理</h1><h2 id="Https"><a href="#Https" class="headerlink" title="Https"></a>Https</h2><p>HTTPS （全称：Hyper Text Transfer Protocol over SecureSocket Layer），是以安全为目标的 HTTP 通道，在HTTP的基础上通过传输加密和<a href="https://baike.baidu.com/item/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/5294713">身份认证</a>保证了传输过程的安全性 [1] 。HTTPS 在HTTP 的基础下加入<a href="https://baike.baidu.com/item/SSL/320778">SSL</a>，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL。 HTTPS 存在不同于 HTTP 的默认端口及一个加密/身份验证层（在 HTTP与 <a href="https://baike.baidu.com/item/TCP/33012">TCP</a> 之间）。这个系统提供了身份验证与加密通讯方法</p><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-29_13-26-11.jpg"></p><h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2><h3 id="公钥和密钥"><a href="#公钥和密钥" class="headerlink" title="公钥和密钥"></a>公钥和密钥</h3><p>公钥：密钥对的持有者公布给其他人的，用来加密和解密数据的</p><p>私钥：密钥对的持有者私有的不可以公布的，用来加密和解密数据的</p><h3 id="什么是非对称加密"><a href="#什么是非对称加密" class="headerlink" title="什么是非对称加密"></a>什么是非对称加密</h3><p>非对称加密（asymmetric cryptography），也称为公开密钥加密（Public-key cryptography），是密码学的一种算法，它需要两个密钥，一个是公开密钥，另一个是私有密钥。顾名思义，公钥可以任意对外发布；而私钥必须由用户自行严格秘密保管，绝不透过任何途径向任何人提供，也不会透露给要通信的另一方，即使他被信任。</p><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ol><li>加密的双向性：加密具有双向性，即公钥和私钥中的任一个均可用作加密，此时另一个则用作解密。</li><li>公钥无法推导出私钥</li></ol><h2 id="CA机构"><a href="#CA机构" class="headerlink" title="CA机构"></a>CA机构</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>证书颁发机构（CA, Certificate Authority）即颁发数字证书的机构。是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。<br>CA中心为每个使用公开密钥的用户发放一个数字证书，数字证书的作用是证明证书中列出的用户合法拥有证书中列出的公开密钥。CA机构的数字签名使得攻击者不能伪造和篡改证书。在SET交易中，CA不仅对持卡人、商户发放证书，还要对获款的银行、网关发放证书。<br>CA是证书的签发机构,它是PKI的核心。CA是负责签发证书、认证证书、管理已颁发证书的机关。它要制定政策和具体步骤来验证、识别用户身份，并对用户证书进行签名，以确保证书持有者的身份和公钥的拥有权。<br>CA 也拥有一个证书（内含公钥）和私钥。网上的公众用户通过验证 CA 的签字从而信任 CA ，任何人都可以得到 CA 的证书（含公钥），用以验证它所签发的证书。<br>如果用户想得到一份属于自己的证书，他应先向 CA 提出申请。在 CA 判明申请者的身份后，便为他分配一个公钥，并且 CA 将该公钥与申请者的身份信息绑在一起，并为之签字后，便形成证书发给申请者。<br>如果一个用户想鉴别另一个证书的真伪，他就用 CA 的公钥对那个证书上的签字进行验证，一旦验证通过，该证书就被认为是有效的。<br>为保证用户之间在网上传递信息的安全性、真实性、可靠性、完整性和不可抵赖性，不仅需要对用户的身份真实性进行验证，也需要有一个具有权威性、公正性、唯一性的机构，负责向电子商务的各个主体颁发并管理符合国内、国际安全电子交易协议标准的电子商务安全证，并负责管理所有参与网上交易的个体所需的数字证书，因此是安全电子交易的核心环节。</p><h3 id="客户端中的证书（内嵌在操作系统中，无法修改，在安装操作系统时就已经存在）"><a href="#客户端中的证书（内嵌在操作系统中，无法修改，在安装操作系统时就已经存在）" class="headerlink" title="客户端中的证书（内嵌在操作系统中，无法修改，在安装操作系统时就已经存在）"></a>客户端中的证书（内嵌在操作系统中，无法修改，在安装操作系统时就已经存在）</h3><p><strong>打开cmd —–&gt;  搜索certmgr.msc</strong></p><h2 id="具体流程"><a href="#具体流程" class="headerlink" title="具体流程"></a>具体流程</h2><p><img src="https://hawkingl.cn/BlogPic/Https%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%9B%BE_%E9%AB%98%E6%B8%85.png"></p>]]></content>
      
      
      <categories>
          
          <category> Https </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端常用的正则方法</title>
      <link href="/archives/db495ac4.html"/>
      <url>/archives/db495ac4.html</url>
      
        <content type="html"><![CDATA[<h1 id="前端常用的正则方法"><a href="#前端常用的正则方法" class="headerlink" title="前端常用的正则方法"></a>前端常用的正则方法</h1><h2 id="stringObject-replace-regexp-substr-replacement"><a href="#stringObject-replace-regexp-substr-replacement" class="headerlink" title="stringObject.replace(regexp/substr,replacement)"></a>stringObject.replace(regexp/substr,replacement)</h2><p>定义：replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">regexp/substr</td><td align="left">必需。规定子字符串或要替换的模式的 RegExp 对象。请注意，如果该值是一个字符串，则将它作为要检索的直接量文本模式，而不是首先被转换为 RegExp 对象。</td></tr><tr><td align="left">replacement</td><td align="left">必需。一个字符串值。规定了替换文本或生成替换文本的函数。</td></tr></tbody></table><p>返回值：一个新的字符串，是用 <em>replacement</em> 替换了 regexp 的第一次匹配或所有匹配之后得到的。</p><h2 id="stringObject-search-regexp"><a href="#stringObject-search-regexp" class="headerlink" title="stringObject.search(regexp)"></a>stringObject.search(regexp)</h2><p>定义：search() 方法用于检索字符串中指定的子字符串，或检索与正则表达式相匹配的子字符串。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">regexp</td><td align="left">该参数可以是需要在 stringObject 中检索的子串，也可以是需要检索的 RegExp 对象。注释：要执行忽略大小写的检索，请追加标志 i。</td></tr></tbody></table><p>返回值：stringObject 中第一个与 regexp 相匹配的子串的起始位置。</p><p><strong>注释：</strong>如果没有找到任何匹配的子串，则返回 -1。</p><p><strong>说明</strong>：search() 方法不执行全局匹配，它将忽略标志 g。它同时忽略 regexp 的 lastIndex 属性，并且总是从字符串的开始进行检索，这意味着它总是返回 stringObject 的第一个匹配的位置。</p><h2 id="stringObject-match-regexp-searchvalue"><a href="#stringObject-match-regexp-searchvalue" class="headerlink" title="stringObject.match(regexp/searchvalue)"></a>stringObject.match(regexp/searchvalue)</h2><p>定义：match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">searchvalue</td><td align="left">必需。规定要检索的字符串值。</td></tr><tr><td align="left">regexp</td><td align="left">必需。规定要匹配的模式的 RegExp 对象。如果该参数不是 RegExp 对象，则需要首先把它传递给 RegExp 构造函数，将其转换为 RegExp 对象。</td></tr></tbody></table><p>返回值：存放匹配结果的数组。该数组的内容依赖于 regexp 是否具有全局标志 g。</p><p>说明：match() 方法将检索字符串 stringObject，以找到一个或多个与 regexp 匹配的文本。这个方法的行为在很大程度上有赖于 regexp 是否具有标志 g。</p><h2 id="RegExpObject-test-string"><a href="#RegExpObject-test-string" class="headerlink" title="RegExpObject.test(string)"></a>RegExpObject.test(string)</h2><p>定义：test() 方法用于检测一个字符串是否匹配某个正则表达式.</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">string</td><td align="left">必需。要检测的字符串。</td></tr></tbody></table><p>返回值：如果字符串 string 中含有与 RegExpObject 匹配的文本，则返回 true，否则返回 false。</p><p>说明：调用 RegExp 对象 r 的 test() 方法，并为它传递字符串 s，与这个表示式是等价的：(r.exec(s) != null)。</p>]]></content>
      
      
      <categories>
          
          <category> 正则 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 正则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue源码之数据响应式原理</title>
      <link href="/archives/6a32cfff.html"/>
      <url>/archives/6a32cfff.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue源码之数据响应式原理"><a href="#Vue源码之数据响应式原理" class="headerlink" title="Vue源码之数据响应式原理"></a>Vue源码之数据响应式原理</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>使用一般语法访问或添加对象的属性时，并不能被我们检测到，也就无法在修改数据时使页面中所有引用的数据都发生改变，所以我们必须在对象的每个属性身上绑定getter和setter方法，使我们每次访问和修改对象的任意一个属性时，都会被检测的到。当监听到对象的某个属性被修改时，就可以执行相应的回调函数，生成虚拟DOM进行diff比较，再将修改之后的数据应用到这个页面。</p><h2 id="依赖的安装"><a href="#依赖的安装" class="headerlink" title="依赖的安装"></a>依赖的安装</h2><p>npm i webpack@5 -D</p><p>npm i webpack-cli@4 -D</p><p>npm i webpack-dev-server@4 -D</p><h2 id="环境的配置"><a href="#环境的配置" class="headerlink" title="环境的配置"></a>环境的配置</h2><h3 id="文件夹的建立"><a href="#文件夹的建立" class="headerlink" title="文件夹的建立"></a>文件夹的建立</h3><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-06-21_15-45-51.jpg"></p><h3 id="webpack-config-js的配置"><a href="#webpack-config-js的配置" class="headerlink" title="webpack.config.js的配置"></a>webpack.config.js的配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/xuni/&#x27;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="attr">static</span>: &#123;</span><br><span class="line">      <span class="attr">directory</span>: path.join(__dirname, <span class="string">&#x27;www&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="html页面的配置"><a href="#html页面的配置" class="headerlink" title="html页面的配置"></a>html页面的配置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>数据响应式原理<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./xuni/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="数据响应式原理"><a href="#数据响应式原理" class="headerlink" title="数据响应式原理"></a>数据响应式原理</h2><h3 id="人口文件的配置"><a href="#人口文件的配置" class="headerlink" title="人口文件的配置"></a>人口文件的配置</h3><p>作为入口函数将要做响应式的对象传入observe(obj)函数中，实现数据的响应式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observe &#125; <span class="keyword">from</span> <span class="string">&quot;./observe&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Watcher <span class="keyword">from</span> <span class="string">&quot;./Watcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要做响应式的数据</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">m</span>: &#123;</span><br><span class="line">      <span class="attr">n</span>: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">g</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将传入的对象做响应式处理</span></span><br><span class="line">observe(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造一个监听对象，监听obj对象中的a.m.n属性，一旦读取该值就打印****启动监听***</span></span><br><span class="line"><span class="comment">//回调函数第一个值为修改之前的值，第二个为修改之后的值</span></span><br><span class="line"><span class="keyword">new</span> Watcher(obj, <span class="string">&#x27;a.m.n&#x27;</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;****启动监听***&#x27;</span>, newValue, oldValue);</span><br><span class="line">&#125;)</span><br><span class="line">obj.a.m.n = <span class="number">88</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//obj.g.push(5)</span></span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="observe-js"><a href="#observe-js" class="headerlink" title="observe.js"></a>observe.js</h3><p>observe(value)：函数的作用  </p><ul><li>  判断传入的值是否为一个对象，如果不是对象直接退出函数</li><li>  如果传入的值是一个对象则判断在该对象上是否有__ob__属性</li><li>  如果该对象身上有__ob__属性，就将该属性返回</li><li>  如果该对象身上没有__ob__属性，new一个Observer对象给该属性，即重构该属性</li><li>  在new的时候会给该属性添加一个__ob__属性，并重写数组的方法，追加属性的getter和setter方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Observer <span class="keyword">from</span> <span class="string">&quot;./Observer&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> observe = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//如果value不是对象，直接退出函数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value != <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">//d定义ob</span></span><br><span class="line">  <span class="keyword">var</span> ob;</span><br><span class="line">  <span class="comment">//判断传入的value变量是否有__ob__属性</span></span><br><span class="line">  <span class="comment">//如果有直接赋值给ob</span></span><br><span class="line">  <span class="comment">//如果没有则重新构造__ob__属性及相关属性给ob</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value.__ob__ != <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    ob = value.__ob__;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//重构传入的value属性</span></span><br><span class="line">    <span class="comment">//在new的时候会给该属性添加一个__ob__属性，并重写数组的方法，追加属性的getter和setter方法</span></span><br><span class="line">    ob = <span class="keyword">new</span> Observer(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Observer-js"><a href="#Observer-js" class="headerlink" title="Observer.js"></a>Observer.js</h3><p>Observer类的作用</p><ul><li><p>​    给传入的value属性绑定一个__ob__属性，并定义__ob__属性的控制属性</p></li><li><p>​    判断传入的值是一个数组还是一个对象</p></li><li><p>​    如果是一个数组，重写数组中的方法，遍历数组使数组中的每一个元素调用一次 observe()函数</p></li><li><p>​    如果是一个对象，调用walk函数遍历对象中的每一项，然后给每一项做响应式处理</p></li><li></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arrayMethods <span class="keyword">from</span> <span class="string">&#x27;./array&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> defineReactive <span class="keyword">from</span> <span class="string">&#x27;./defineProperty&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&#x27;./Dep&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observe &#125; <span class="keyword">from</span> <span class="string">&#x27;./observe&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; def &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//每一个Observer的实例身上都有一个dep</span></span><br><span class="line">    <span class="built_in">this</span>.dep = <span class="keyword">new</span> Dep();</span><br><span class="line">    <span class="comment">//给传入的对象绑定__ob__属性并定义__ob__的控制属性，其中__ob__属性的值为实例对象本身</span></span><br><span class="line">    def(value, <span class="string">&#x27;__ob__&#x27;</span>, <span class="built_in">this</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//判断该属性是对象还是数组</span></span><br><span class="line">    <span class="comment">//如果是数组，就重写数组内置的方法，并遍历查找数组中的每一个元素是否有子项</span></span><br><span class="line">    <span class="comment">//如果是对象，就为每一个对象的属性做响应式处理</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      <span class="comment">//修改对象的原型对象，将value数组的原型指向arrayMethods对象，arrayMethods是重写之后的数组方法</span></span><br><span class="line">      <span class="built_in">Object</span>.setPrototypeOf(value, arrayMethods);</span><br><span class="line">      <span class="built_in">this</span>.observeArray(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.walk(value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//遍历value对象的每一个属性，对每一个遍历出来的对象做响应式处理</span></span><br><span class="line">  <span class="function"><span class="title">walk</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">      defineReactive(value, k);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//遍历数组中的每一项，对数组中的子项进行处理</span></span><br><span class="line">  <span class="function"><span class="title">observeArray</span>(<span class="params">arr</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      observe(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="defineProperty-js"><a href="#defineProperty-js" class="headerlink" title="defineProperty.js"></a>defineProperty.js</h3><p>defineReactive()：函数的功能</p><ul><li>​    如果给函数传入的参数只有两个，就将传入对象属性的值赋值给val变量</li><li>​    对val进行递归，处理传入对象的子项</li><li>​    给传入对象的属性绑定getter和setter方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&quot;./Dep&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observe &#125; <span class="keyword">from</span> <span class="string">&quot;./observe&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">obj, key, val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep();</span><br><span class="line">  <span class="comment">//如果只传入需要实现响应式的对象和属性时将属性的值赋值给val变量</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length == <span class="number">2</span>) &#123;</span><br><span class="line">    val = obj[key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//对属性的值实现递归进行递归</span></span><br><span class="line">  <span class="keyword">let</span> childOb = observe(val);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//给传入对象的属性添加getter和setter</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    <span class="comment">//可枚举</span></span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//可被配置</span></span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`访问<span class="subst">$&#123;key&#125;</span>属性`</span>);</span><br><span class="line">      <span class="comment">//如果现在处于依赖的收集阶段</span></span><br><span class="line">      <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">        dep.depend();</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.dep.depend();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">newValue</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span>属性被修改了`</span>);</span><br><span class="line">      <span class="keyword">if</span> (val == newValue) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">//将新传入的属性值赋值给val变量</span></span><br><span class="line">      val = newValue;</span><br><span class="line">      <span class="comment">//对新传入的值进行递归操作</span></span><br><span class="line">      childOb = observe(newValue);</span><br><span class="line">      <span class="comment">//发布订阅模式，通知dep</span></span><br><span class="line">      dep.notify();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="array-js"><a href="#array-js" class="headerlink" title="array.js"></a>array.js</h3><p> 重写数组中内置的方法 </p><ul><li>​    先将数组内置的方法进行备份</li><li>​    然后创建一个对象，该对象以数组内置方法的备份作为原型</li><li>​    最后重写刚刚创建对象原型上的备份方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; def &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//备份数组中内置的方法</span></span><br><span class="line"><span class="keyword">const</span> arrayPrototype = <span class="built_in">Array</span>.prototype;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以arrayPrototype为原型创建arrayMethods对象，Object.create() 方法用于创建一个新对象，使用现有的对象来作为新创建对象的原型（prototype）。</span></span><br><span class="line"><span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create(arrayPrototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">//列出需要进行重写的方法的方法名</span></span><br><span class="line"><span class="keyword">const</span> methodsNeedChange = [</span><br><span class="line">  <span class="comment">//在原数组末尾添加一个元素</span></span><br><span class="line">  <span class="string">&#x27;push&#x27;</span>,</span><br><span class="line">  <span class="comment">//删除数组的最后一个元素</span></span><br><span class="line">  <span class="string">&#x27;pop&#x27;</span>,</span><br><span class="line">  <span class="comment">//删除数组的第一个元素</span></span><br><span class="line">  <span class="string">&#x27;shift&#x27;</span>,</span><br><span class="line">  <span class="comment">//在数组的开头添加一个元素</span></span><br><span class="line">  <span class="string">&#x27;unshift&#x27;</span>,</span><br><span class="line">  <span class="comment">//添加或删除一个或多个元素</span></span><br><span class="line">  <span class="string">&#x27;splice&#x27;</span>,</span><br><span class="line">  <span class="comment">//对数组元素进行排序</span></span><br><span class="line">  <span class="string">&#x27;sort&#x27;</span>,</span><br><span class="line">  <span class="comment">//颠倒数组元素的顺序</span></span><br><span class="line">  <span class="string">&#x27;reverse&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//重写数组指定的方法</span></span><br><span class="line">methodsNeedChange.forEach(<span class="function"><span class="params">methodName</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//备份数组原型上的方法</span></span><br><span class="line">  <span class="keyword">const</span> original = arrayPrototype[methodName];</span><br><span class="line">  <span class="comment">//重写该方法，</span></span><br><span class="line">  def(arrayMethods, methodName, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//apply(original的this要指向的对象, original()函数需要传入的参数,参数为一个数组)</span></span><br><span class="line">    <span class="comment">//这里的this指向调用重写方法的对像，arguments为调用重写方法时传入的参数</span></span><br><span class="line">    <span class="keyword">let</span> result = original.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="comment">//将arguments伪数组变为真数组</span></span><br><span class="line">    <span class="keyword">const</span> args = [...arguments];</span><br><span class="line">    <span class="comment">//获取数组上的__ob__属性</span></span><br><span class="line">    <span class="keyword">const</span> ob = <span class="built_in">this</span>.__ob__;</span><br><span class="line">    <span class="comment">//定义一个数组存放要添加的元素</span></span><br><span class="line">    <span class="keyword">let</span> inserted = [];</span><br><span class="line">    <span class="keyword">switch</span> (methodName) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">        inserted = args;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;shift&#x27;</span>:</span><br><span class="line">        inserted = args;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;unshift&#x27;</span>:</span><br><span class="line">        inserted = args;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;splice&#x27;</span>:</span><br><span class="line">        inserted = args.slice(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果有要添加的元素</span></span><br><span class="line">    <span class="keyword">if</span> (inserted) &#123;</span><br><span class="line">      ob.observeArray(inserted);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ob.dep.notify()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;, <span class="literal">false</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> arrayMethods; </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="utils-js"><a href="#utils-js" class="headerlink" title="utils.js"></a>utils.js</h3><p>def()函数的功能：给传入的对象绑定一个属性并给属性赋值，定义属性的控制属性 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> def = <span class="function"><span class="keyword">function</span> (<span class="params">obj, key, value, enumerable</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    value,</span><br><span class="line">    <span class="comment">//是否可以被枚举</span></span><br><span class="line">    enumerable,</span><br><span class="line">    <span class="comment">//当且仅当该属性的 writable 键值为 true 时，属性的值，也就是上面的 value，才能被赋值运算符 (en-US)改变。</span></span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//当且仅当该属性的 configurable 键值为 true 时，该属性的描述符才能够被改变，同时该属性也能从对应的对象上被删除。</span></span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dep-js"><a href="#Dep-js" class="headerlink" title="Dep.js"></a>Dep.js</h3><p>在对象及对象属性的 _<em>ob</em>_ 属性上实例化一个dep存放需要添加的依赖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个id属性，每实例化一个Dep就会自增1</span></span><br><span class="line"><span class="keyword">var</span> uid = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dep</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是Dep类的构造器&#x27;</span>);</span><br><span class="line">    <span class="comment">//在实例化的对象身上绑定一个id保证dep的唯一性</span></span><br><span class="line">    <span class="built_in">this</span>.id = uid++;</span><br><span class="line">    <span class="comment">//用数组存储自己的订阅者，即Watcher的实例对象</span></span><br><span class="line">    <span class="built_in">this</span>.subs = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//添加订阅</span></span><br><span class="line">  <span class="function"><span class="title">addSub</span>(<span class="params">sub</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs.push(sub);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//添加依赖</span></span><br><span class="line">  <span class="function"><span class="title">depend</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//Dep.target就是一个我们自己指定的全局的位置（全局唯一）</span></span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      <span class="built_in">this</span>.addSub(Dep.target)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//通知更新</span></span><br><span class="line">  <span class="function"><span class="title">notify</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是notify&#x27;</span>);</span><br><span class="line">    <span class="comment">//浅克隆一份</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="built_in">this</span>.subs.slice();</span><br><span class="line">    <span class="comment">//遍历subs数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; subs.length; i++) &#123;</span><br><span class="line">      subs[i].update();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在Dep类身上定义一个静态属性target</span></span><br><span class="line">Dep.target = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><h3 id="Watcher-js"><a href="#Watcher-js" class="headerlink" title="Watcher.js"></a>Watcher.js</h3><p>实例化一个Watcher实例，表明需要监听的对象，监听对象那个属性，属性值被修改之后的回调函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&quot;./Dep&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个id属性，每实例化一个Watcher就会自增1</span></span><br><span class="line"><span class="keyword">var</span> uid = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Watcher</span></span>&#123;</span><br><span class="line">  <span class="comment">//target：要监听的对象，即哪一个组件</span></span><br><span class="line">  <span class="comment">//expression：要监听对象的哪一个属性</span></span><br><span class="line">  <span class="comment">//callback：监听到该对象之后要做到事情</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">target, expression, callback</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;我是Watcher类的实例&#x27;</span>);</span><br><span class="line">    <span class="comment">//给当前依赖添加一个id保证当前依赖的唯一性</span></span><br><span class="line">    <span class="built_in">this</span>.id = uid++;</span><br><span class="line">    <span class="built_in">this</span>.target = target;</span><br><span class="line">    <span class="comment">//该函数返回一个函数，返回的函数可以查询传入对象属性的值</span></span><br><span class="line">    <span class="built_in">this</span>.getter = parsePath(expression);</span><br><span class="line">    <span class="comment">//当监听到指定对象的属性时的回调函数</span></span><br><span class="line">    <span class="built_in">this</span>.callback = callback;</span><br><span class="line">    <span class="built_in">this</span>.value = <span class="built_in">this</span>.get();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.run();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//进入依赖收集的阶段，让全局的Dep.target设置为Watcher本身，那么就表明进入了依赖收集</span></span><br><span class="line">    Dep.target = <span class="built_in">this</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将当前监听的对象赋值给obj</span></span><br><span class="line">    <span class="keyword">const</span> obj = <span class="built_in">this</span>.target;</span><br><span class="line">    <span class="keyword">var</span> value;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//找到监听对象的属性的值</span></span><br><span class="line">      value = <span class="built_in">this</span>.getter(obj);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//找到对应属性的值后，退出依赖收集阶段</span></span><br><span class="line">      Dep.target = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getAndInvoke(<span class="built_in">this</span>.callback);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//获取和调用监听对象的属性的修改前后的值</span></span><br><span class="line">  <span class="function"><span class="title">getAndInvoke</span>(<span class="params">cb</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="built_in">this</span>.get();</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="built_in">this</span>.value || <span class="keyword">typeof</span> value == <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = <span class="built_in">this</span>.value;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line">      cb.call(<span class="built_in">this</span>.target, value, oldValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将传入的字符串拆分成数组，并返回一个函数</span></span><br><span class="line"><span class="comment">//返回的函数可以通过拆分的数组遍历出传入对象属性的值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parsePath</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> segments = str.split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; segments.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!obj) <span class="keyword">return</span>;</span><br><span class="line">      obj = obj[segments[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue源码之虚拟DOM和diff算法</title>
      <link href="/archives/8e0a33d3.html"/>
      <url>/archives/8e0a33d3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue源码之虚拟DOM和diff算法"><a href="#Vue源码之虚拟DOM和diff算法" class="headerlink" title="Vue源码之虚拟DOM和diff算法"></a>Vue源码之虚拟DOM和diff算法</h1><h2 id="snabbdom简介"><a href="#snabbdom简介" class="headerlink" title="snabbdom简介"></a>snabbdom简介</h2><p>snabdom是瑞典语，原意为速度</p><p>一个精简化、模块化、功能强大、性能卓越的虚拟 DOM 库</p><h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  init,</span><br><span class="line">  classModule,</span><br><span class="line">  propsModule,</span><br><span class="line">  styleModule,</span><br><span class="line">  eventListenersModule,</span><br><span class="line">  h,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;snabbdom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> patch = init([</span><br><span class="line">  <span class="comment">// 通过传入模块初始化 patch 函数</span></span><br><span class="line">  classModule, <span class="comment">// 开启 classes 功能</span></span><br><span class="line">  propsModule, <span class="comment">// 支持传入 props</span></span><br><span class="line">  styleModule, <span class="comment">// 支持内联样式同时支持动画</span></span><br><span class="line">  eventListenersModule, <span class="comment">// 添加事件监听</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = h(<span class="string">&quot;div#container.two.classes&quot;</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: someFn &#125; &#125;, [</span><br><span class="line">  h(<span class="string">&quot;span&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">fontWeight</span>: <span class="string">&quot;bold&quot;</span> &#125; &#125;, <span class="string">&quot;This is bold&quot;</span>),</span><br><span class="line">  <span class="string">&quot; and this is just normal text&quot;</span>,</span><br><span class="line">  h(<span class="string">&quot;a&quot;</span>, &#123; <span class="attr">props</span>: &#123; <span class="attr">href</span>: <span class="string">&quot;/foo&quot;</span> &#125; &#125;, <span class="string">&quot;I&#x27;ll take you places!&quot;</span>),</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 传入一个空的元素节点 - 将产生副作用（修改该节点）</span></span><br><span class="line">patch(container, vnode);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newVnode = h(</span><br><span class="line">  <span class="string">&quot;div#container.two.classes&quot;</span>,</span><br><span class="line">  &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: anotherEventHandler &#125; &#125;,</span><br><span class="line">  [</span><br><span class="line">    h(</span><br><span class="line">      <span class="string">&quot;span&quot;</span>,</span><br><span class="line">      &#123; <span class="attr">style</span>: &#123; <span class="attr">fontWeight</span>: <span class="string">&quot;normal&quot;</span>, <span class="attr">fontStyle</span>: <span class="string">&quot;italic&quot;</span> &#125; &#125;,</span><br><span class="line">      <span class="string">&quot;This is now italic type&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="string">&quot; and this is still just normal text&quot;</span>,</span><br><span class="line">    h(<span class="string">&quot;a&quot;</span>, &#123; <span class="attr">props</span>: &#123; <span class="attr">href</span>: <span class="string">&quot;/bar&quot;</span> &#125; &#125;, <span class="string">&quot;I&#x27;ll take you places!&quot;</span>),</span><br><span class="line">  ]</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 再次调用 `patch`</span></span><br><span class="line">patch(vnode, newVnode); <span class="comment">// 将旧节点更新为新节点</span></span><br></pre></td></tr></table></figure><h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><p><img src="https://hawkingl.cn/BlogPic/%E5%9B%BE%E8%A7%A3snabbdom.png"></p><h3 id="解析diff算法"><a href="#解析diff算法" class="headerlink" title="解析diff算法"></a>解析diff算法</h3><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%831.jpg"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%832.jpg"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%833.jpg"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%834.jpg"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%835.png"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%836.jpg"></p><p><img src="https://hawkingl.cn/BlogPic/diff%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%837.png"></p><h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><p>入口文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h <span class="keyword">from</span> <span class="string">&#x27;./mysnabbdom/h.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> patch <span class="keyword">from</span> <span class="string">&#x27;./mysnabbdom/patch.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;container&#x27;</span>);</span><br><span class="line"><span class="comment">//生成一个虚拟DOM</span></span><br><span class="line"><span class="keyword">const</span> myVnode = h(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, [</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;a&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;b&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;d&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;e&#x27;</span>),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将生成的虚拟DOM与旧的DOM进行比较之后添加到页面</span></span><br><span class="line">patch(container, myVnode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode2 = h(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, [</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;cccc&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;eeee&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;F&#x27;</span> &#125;, <span class="string">&#x27;ffff&#x27;</span>),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//点击按钮时将vnode1变为vnode2</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  patch(myVnode, vnode2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造虚拟DOM</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 该函数传入的参数类型有三种</span></span><br><span class="line"><span class="comment">     · h(&#x27;div&#x27;, &#123;&#125;, &#x27;文字&#x27;)</span></span><br><span class="line"><span class="comment">     · h(&#x27;div&#x27;, &#123;&#125;, [])</span></span><br><span class="line"><span class="comment">     · h(&#x27;div&#x27;, &#123;&#125;, h())</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">sel, data, c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//检查参数的个数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length != <span class="number">3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;对不起，h函数必须传入三个值&#x27;</span>);</span><br><span class="line">  <span class="comment">//检查c参数的类型</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c == <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> c == <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> vnode(sel, data, <span class="literal">undefined</span>, c, <span class="literal">undefined</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(c)) &#123;</span><br><span class="line">    <span class="comment">//传入的c参数是一个数组</span></span><br><span class="line">    <span class="keyword">let</span> children = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(<span class="keyword">typeof</span> c[i] == <span class="string">&#x27;object&#x27;</span> &amp;&amp; c[i].hasOwnProperty(<span class="string">&#x27;sel&#x27;</span>))) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;传入的数组项中有项不是h()函数&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        children.push(c[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//children收集完毕</span></span><br><span class="line">    <span class="keyword">return</span> vnode(sel, data, children, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> c == <span class="string">&#x27;object&#x27;</span> &amp;&amp; c.hasOwnProperty(<span class="string">&#x27;sel&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//传入的c参数是一个h()函数</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;传入的c参数类型错误&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default function vnode (sel, data, children, text, elm) &#123;</span><br><span class="line">  const key = data.key;</span><br><span class="line">  return &#123;</span><br><span class="line">    sel, data, children, text, elm, key</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将最终的DOM元素添加真实的DOM树上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElement <span class="keyword">from</span> <span class="string">&quot;./createElement&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&quot;./patchVnode&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//判断传入的第一个参数是虚拟节点还是真实DOM节点</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.sel == <span class="string">&#x27;&#x27;</span> || oldVnode.sel == <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">//当传入的是一个真实的DOM节点时，将真实的DOM节点转换成虚拟的DOM节点</span></span><br><span class="line">    <span class="comment">//注意：转换时暂时不考虑节点中有text属性的情况</span></span><br><span class="line">    oldVnode = vnode(oldVnode.tagName.toLowerCase(), &#123;&#125;, [], <span class="literal">undefined</span>, oldVnode);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断oldVnode和newVnode是不是在同一个节点</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.sel == newVnode.sel &amp;&amp; oldVnode.key == newVnode.key) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;是同一个节点&#x27;</span>);</span><br><span class="line">    patchVnode(oldVnode, newVnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;不是同一个节点&#x27;</span>);</span><br><span class="line">    <span class="comment">//使用新传入的虚拟DOM生成真实DOM</span></span><br><span class="line">    <span class="keyword">let</span> newVnodeElm = createElement(newVnode);</span><br><span class="line">    <span class="comment">//将新真实DOM绑定在旧真实DOM之前</span></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.elm.parentNode &amp;&amp; newVnodeElm) &#123;</span><br><span class="line">      oldVnode.elm.parentNode.insertBefore(newVnodeElm, oldVnode.elm);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除老节点</span></span><br><span class="line">    oldVnode.elm.parentNode.removeChild(oldVnode.elm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>递归虚拟DOM节点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElement <span class="keyword">from</span> <span class="string">&quot;./createElement&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&quot;./patchVnode&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//判断传入的第一个参数是虚拟节点还是真实DOM节点</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.sel == <span class="string">&#x27;&#x27;</span> || oldVnode.sel == <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">//当传入的是一个真实的DOM节点时，将真实的DOM节点转换成虚拟的DOM节点</span></span><br><span class="line">    <span class="comment">//注意：转换时暂时不考虑节点中有text属性的情况</span></span><br><span class="line">    oldVnode = vnode(oldVnode.tagName.toLowerCase(), &#123;&#125;, [], <span class="literal">undefined</span>, oldVnode);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断oldVnode和newVnode是不是在同一个节点</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.sel == newVnode.sel &amp;&amp; oldVnode.key == newVnode.key) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;是同一个节点&#x27;</span>);</span><br><span class="line">    patchVnode(oldVnode, newVnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;不是同一个节点&#x27;</span>);</span><br><span class="line">    <span class="comment">//使用新传入的虚拟DOM生成真实DOM</span></span><br><span class="line">    <span class="keyword">let</span> newVnodeElm = createElement(newVnode);</span><br><span class="line">    <span class="comment">//将新真实DOM绑定在旧真实DOM之前</span></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.elm.parentNode &amp;&amp; newVnodeElm) &#123;</span><br><span class="line">      oldVnode.elm.parentNode.insertBefore(newVnodeElm, oldVnode.elm);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除老节点</span></span><br><span class="line">    oldVnode.elm.parentNode.removeChild(oldVnode.elm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跳过虚拟DOM转换为DOM元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真正创建节点，将vnode创建为DOM</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//根据传过来的虚拟节点对象创建一个新的节点</span></span><br><span class="line">  <span class="keyword">let</span> domNode = <span class="built_in">document</span>.createElement(vnode.sel);</span><br><span class="line">  <span class="comment">//判断虚拟节点是否需要递归，即虚拟节点的children属性是一个数组</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.text &amp;&amp; (vnode.children == <span class="literal">undefined</span> || vnode.children.length == <span class="number">0</span>)) &#123;</span><br><span class="line">    <span class="comment">//将虚拟节点对象的文本内容放入新创建的节点中</span></span><br><span class="line">    domNode.innerText = vnode.text;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(vnode.children) &amp;&amp; vnode.children.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//虚拟节点属性内部还拥有子节点时</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; vnode.children.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> ch = vnode.children[i];</span><br><span class="line">      <span class="keyword">let</span> chDOM = createElement(ch);</span><br><span class="line">      <span class="comment">//给上一层创建的节点追加要给子节点</span></span><br><span class="line">      domNode.appendChild(chDOM);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//给虚拟节点的elm属性添加值</span></span><br><span class="line">  vnode.elm = domNode;</span><br><span class="line">  <span class="comment">//返回elm</span></span><br><span class="line">  <span class="keyword">return</span> vnode.elm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>diff算法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElement <span class="keyword">from</span> <span class="string">&quot;./createElement&quot;</span>; <span class="comment">//创造一个元素</span></span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&quot;./patchVnode&quot;</span>; <span class="comment">//新旧虚拟dom的比较</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否是同一个虚拟节点</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSameVnode</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a.sel == b.sel &amp;&amp; a.key == b.key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//更新children属性</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span>(<span class="params">parentElm, oldCh, newCh</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//旧前</span></span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//新前</span></span><br><span class="line">  <span class="keyword">let</span> newStartIdx = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//旧后</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.length - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//新后</span></span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.length - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//旧前节点</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">//旧后节点</span></span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx];</span><br><span class="line">  <span class="comment">//新前节点</span></span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">//新后节点</span></span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh[newEndIdx];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> keyMap = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//开始循环遍历数组进行新旧DOM的比较</span></span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="comment">//判断新旧节点中是否有undefined的节点，有就要跳过</span></span><br><span class="line">    <span class="keyword">if</span> (oldStartVnode == <span class="literal">null</span> || oldCh[oldStartIdx] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldEndVnode == <span class="literal">null</span> || oldCh[oldEndIdx] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartVnode == <span class="literal">null</span> || newCh[newStartIdx] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newEndVnode == <span class="literal">null</span> || newCh[newEndIdx] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newEndVnode = newCh[--newEndIdx];</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">//命中新前与旧前</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;①将旧前和新前的指针后移&#x27;</span>);</span><br><span class="line">      <span class="comment">//将旧前节点变为新前节点</span></span><br><span class="line">      patchVnode(oldStartVnode, newStartVnode);</span><br><span class="line">      <span class="comment">//将旧前和新前的指针后移</span></span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">//命中新后与旧后</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;②将新后与旧后的指针上移&#x27;</span>);</span><br><span class="line">      <span class="comment">//将旧后节点变为新后节点</span></span><br><span class="line">      patchVnode(oldEndVnode, newEndVnode);</span><br><span class="line">      <span class="comment">//将新后与旧后的指针上移</span></span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">      newEndVnode = newCh[--newEndIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">//命中新后与旧前</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;③移动旧前指向的节点到旧后节点之后&#x27;</span>);</span><br><span class="line">      <span class="comment">//将旧前节点变为新后节点</span></span><br><span class="line">      patchVnode(oldStartVnode, newEndVnode);</span><br><span class="line">      <span class="comment">//移动旧前指向的节点到旧后节点之后（node.nextSibling：node节点之后紧跟的一个节点）</span></span><br><span class="line">      parentElm.insertBefore(oldStartVnode.elm, oldEndVnode.elm.nextSibling);</span><br><span class="line">      <span class="comment">//将旧前指针下移新后指针上移</span></span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">      newEndVnode = newCh[--newEndIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">//命中新前与旧后</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;④移动旧后指向的节点到旧前节点之前&#x27;</span>);</span><br><span class="line">      <span class="comment">//将旧后节点变为新前节点</span></span><br><span class="line">      patchVnode(oldEndVnode, newStartVnode);</span><br><span class="line">      <span class="comment">//移动旧后指向的节点到旧前节点之前</span></span><br><span class="line">      parentElm.insertBefore(oldEndVnode.elm, oldStartVnode.elm);</span><br><span class="line">      <span class="comment">//将旧后指针上移新前指针下移</span></span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/* 四种规则都没有匹配到</span></span><br><span class="line"><span class="comment">            在旧的节点中寻找是否有当前newStartIdx指向的节点</span></span><br><span class="line"><span class="comment">            如果没有直接添加</span></span><br><span class="line"><span class="comment">            如果有将旧节点的属性更新后添加到旧前之前，并将它在oldCh中的位置设为undefine</span></span><br><span class="line"><span class="comment">            处理完之后再将旧前指针下移，处理下一个新节点</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="comment">//构建一个映射，在旧的节点中寻找是否有当前newStartIdx指向的节点</span></span><br><span class="line">      <span class="keyword">if</span> (!keyMap) &#123;</span><br><span class="line">        keyMap = &#123;&#125;;</span><br><span class="line">        <span class="comment">//遍历 [旧前，旧后] 形成映射</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) &#123;</span><br><span class="line">          <span class="keyword">const</span> key = oldCh[i].key;</span><br><span class="line">          <span class="keyword">if</span> (key != <span class="literal">undefined</span>) &#123;</span><br><span class="line">            keyMap[key] = i;</span><br><span class="line">          &#125;         </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//将上面的寻找结果映射到idInOld上</span></span><br><span class="line">      <span class="keyword">let</span> idxInOld = keyMap[newStartVnode.key];</span><br><span class="line">      <span class="keyword">if</span> (idxInOld == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">//idxInOld是一个新的节点</span></span><br><span class="line">        parentElm.insertBefore(createElement(newStartVnode), oldStartVnode.elm);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//idxInOld是一个旧的节点需要将这个节点移动到指定位置</span></span><br><span class="line">        <span class="keyword">const</span> elmToMove = oldCh[idxInOld];</span><br><span class="line">        patchVnode(elmToMove, newStartVnode);</span><br><span class="line">        <span class="comment">//需要先将旧节点中要移动的节点undefined，不然没办法添加相同的节点</span></span><br><span class="line">        oldCh[idxInOld] = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="comment">//将要移动的节点添加到旧前之前</span></span><br><span class="line">        parentElm.insertBefore(elmToMove.elm, oldStartVnode.elm);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//将旧前指针下移处理下一个节点</span></span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* 判断是要删除节点还是要增加节点 </span></span><br><span class="line"><span class="comment">        如果是新节点先循环完，删除指定的旧节点</span></span><br><span class="line"><span class="comment">        如果是旧节点先循环完，增加节点给旧节点</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    <span class="comment">//需要新增节点</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;需要新增节点&#x27;</span>);</span><br><span class="line">    <span class="comment">//遍历需要新增的节点，并将这些节点转换为真实DOM之后添加到标志节点之前</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = newStartIdx; i &lt;= newEndIdx; i++) &#123;</span><br><span class="line">      <span class="comment">//insertBefore：可以识别null，将要添加的节点自动追加到最后</span></span><br><span class="line">      parentElm.insertBefore(createElement(newCh[i]), oldCh[oldStartIdx]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    <span class="comment">//需要删除节点</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;需要删除节点&#x27;</span>);</span><br><span class="line">    <span class="comment">//遍历 [旧前, 旧后] 之间的节点并依次删除</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) &#123;</span><br><span class="line">      <span class="comment">//oldCh中有节点旧删除，没有旧跳过</span></span><br><span class="line">      <span class="keyword">if</span> (oldCh[i]) &#123;</span><br><span class="line">        parentElm.removeChild(oldCh[i].elm);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue源码之AST抽象语法树</title>
      <link href="/archives/aa923dbf.html"/>
      <url>/archives/aa923dbf.html</url>
      
        <content type="html"><![CDATA[<h1 id="AST抽象语法树"><a href="#AST抽象语法树" class="headerlink" title="AST抽象语法树"></a>AST抽象语法树</h1><h2 id="抽象语法树和虚拟节点的关系"><a href="#抽象语法树和虚拟节点的关系" class="headerlink" title="抽象语法树和虚拟节点的关系"></a>抽象语法树和虚拟节点的关系</h2><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-06-21_18-03-27.jpg"></p><p>简而言之，抽象语法树就是将你写的html语法拆分成固定格式的对象，该对象可以被渲染函数识别。</p><h2 id="测试环境的搭建"><a href="#测试环境的搭建" class="headerlink" title="测试环境的搭建"></a>测试环境的搭建</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>npm i webpack@5 -D</p><p>npm i webpack-cli@4 -D</p><p>npm i webpack-dev-server@4 -D</p><h3 id="新建对应文件夹"><a href="#新建对应文件夹" class="headerlink" title="新建对应文件夹"></a>新建对应文件夹</h3><p><img src="https://hawkingl.cn/BlogPic/%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%B9%E6%A0%B7%E5%BC%8F.jpg"></p><h3 id="webpack-config-js的配置"><a href="#webpack-config-js的配置" class="headerlink" title="webpack.config.js的配置"></a>webpack.config.js的配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/xuni/&#x27;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="attr">static</span>: &#123;</span><br><span class="line">      <span class="attr">directory</span>: path.join(__dirname, <span class="string">&#x27;www&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><p>index.js</p><p>JS的入口文件，将模板字符串传入抽象语法树的处理函数中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> parse <span class="keyword">from</span> <span class="string">&quot;./parse&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> templateStr = <span class="string">`&lt;div class=&#x27;ast&#x27; id=1&gt;</span></span><br><span class="line"><span class="string">    &lt;h3&gt;AST抽象语法树&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">      &lt;li&gt;递归&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;li&gt;栈&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;li&gt;指针&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象语法树的入口函数</span></span><br><span class="line">parse(templateStr)</span><br></pre></td></tr></table></figure><p>parse.js</p><p>AST抽象语法树的入口函数，可以将目标字符串转换为渲染函数可以识别的一个对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> parseAttrsString <span class="keyword">from</span> <span class="string">&quot;./parseAttrsString&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">templateStr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//指针，从左到右遍历字符串</span></span><br><span class="line">  <span class="keyword">var</span> pointer = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//存放每次遍历完之后的剩余字符串</span></span><br><span class="line">  <span class="keyword">var</span> result = templateStr;</span><br><span class="line">  <span class="comment">//用于匹配剩余字符串中开头标签的正则表达式</span></span><br><span class="line">  <span class="keyword">var</span> startRegExp = <span class="regexp">/^\&lt;([a-z]+[1-6]?)(\s[^\&gt;]+)?\&gt;/</span>;</span><br><span class="line">  <span class="comment">//用于匹配剩余字符串中结束标签的正则表达式</span></span><br><span class="line">  <span class="keyword">var</span> endRegExp = <span class="regexp">/^\&lt;\/([a-z]+[1-6]?)\&gt;/</span>;</span><br><span class="line">  <span class="comment">//用于匹配剩余字符串开头和结束标签之间内容部分的正则表达式</span></span><br><span class="line">  <span class="keyword">var</span> wordRegExp = <span class="regexp">/^([^\&lt;]+)\&lt;\/[a-z]+[1-6]?\&gt;/</span></span><br><span class="line">  <span class="comment">//辅助栈：用于存放匹配到的标签的栈</span></span><br><span class="line">  <span class="keyword">var</span> stack1 = [];</span><br><span class="line">  <span class="comment">//内容栈：用于存放匹配到的内容的栈</span></span><br><span class="line">  <span class="keyword">var</span> stack2 = [&#123; <span class="attr">children</span>: [] &#125;];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//循环遍历这个模板字符串</span></span><br><span class="line">  <span class="keyword">while</span> (pointer &lt; templateStr.length - <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//将将模板字符串进行截取，并将截取的字符串存到剩余字符串result中</span></span><br><span class="line">    result = templateStr.substring(pointer);</span><br><span class="line">    <span class="comment">//判断剩余字符串开头是开始标签、结束标签还是具体内容</span></span><br><span class="line">    <span class="keyword">if</span> (startRegExp.test(result)) &#123;</span><br><span class="line">      <span class="comment">//当匹配到开始标签时</span></span><br><span class="line">      <span class="comment">//捕获开始标签</span></span><br><span class="line">      <span class="keyword">let</span> startTag = result.match(startRegExp)[<span class="number">1</span>];</span><br><span class="line">      <span class="comment">//捕获开始标签的属性</span></span><br><span class="line">      <span class="keyword">let</span> attrsStr = result.match(startRegExp)[<span class="number">2</span>]</span><br><span class="line">      <span class="comment">//将开始标签推入stack1栈中</span></span><br><span class="line">      stack1.push(startTag);</span><br><span class="line">      <span class="comment">//向stack2栈中推入一个指定格式的对象</span></span><br><span class="line">      stack2.push(&#123; <span class="attr">tag</span>: startTag, <span class="attr">attrs</span>: parseAttrsString(attrsStr), <span class="attr">type</span>: <span class="number">1</span>, <span class="attr">children</span>: [] &#125;);</span><br><span class="line">      <span class="comment">//将指针后移，使其通过整个开始标签</span></span><br><span class="line">      pointer += startTag.length + <span class="number">2</span> + (attrsStr ? attrsStr.length : <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (wordRegExp.test(result)) &#123;</span><br><span class="line">      <span class="comment">//当匹配到标签中的内容时</span></span><br><span class="line">      <span class="comment">//捕获结束标签</span></span><br><span class="line">      <span class="keyword">let</span> word = result.match(wordRegExp)[<span class="number">1</span>];</span><br><span class="line">      <span class="comment">//当匹配到的标签内容不为空时</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="regexp">/^\s+$/</span>.test(word)) &#123;</span><br><span class="line">        <span class="comment">//向stack2栈中的最后一项的children属性中添加一个内容对象</span></span><br><span class="line">        <span class="comment">// @ts-ignore</span></span><br><span class="line">        stack2[stack2.length - <span class="number">1</span>].children.push(&#123;<span class="attr">text</span>: word, <span class="attr">type</span>: <span class="number">3</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//将指针后移</span></span><br><span class="line">      pointer += word.length;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (endRegExp.test(result)) &#123;</span><br><span class="line">      <span class="comment">//当匹配到结束标签时</span></span><br><span class="line">      <span class="comment">//捕获结束比标签</span></span><br><span class="line">      <span class="keyword">let</span> endTag = result.match(endRegExp)[<span class="number">1</span>];</span><br><span class="line">      <span class="comment">//判断捕获的标签是否和stack1栈中最后一个元素相同</span></span><br><span class="line">      <span class="keyword">if</span> (endTag == stack1[stack1.length - <span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="comment">//如果相同就将标签和内容出栈，即删除stack1和stack2中的最后一个元素</span></span><br><span class="line">        stack1.pop();</span><br><span class="line">        <span class="keyword">let</span> content = stack2.pop();</span><br><span class="line">        <span class="comment">//将stack2中删除的元素添加到当前stack2中最后一个元素的children属性中</span></span><br><span class="line">        <span class="comment">// @ts-ignore</span></span><br><span class="line">        stack2[stack2.length - <span class="number">1</span>].children.push(content)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果不相同就说明标签书写有误</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;标签没有闭合！！！&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//处理完结束标签后将指针后移</span></span><br><span class="line">      pointer += endTag.length + <span class="number">3</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//匹配到结束标签和下一个开始标签之间的内容时</span></span><br><span class="line">      pointer++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack2[<span class="number">0</span>].children[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>parseAttrsString.js</p><p>parse()函数的辅助函数，用于处理开始标签中属性部分的字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 处理开始标签中的属性部分 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">attrsStr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//如果开始标签中没有属性内容就直接返回一个空数组</span></span><br><span class="line">  <span class="keyword">if</span> (attrsStr == <span class="literal">undefined</span>) <span class="keyword">return</span> [];</span><br><span class="line">  <span class="comment">//标志变量，辅助判断空格所在的位置</span></span><br><span class="line">  <span class="keyword">var</span> isYinhao = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">//指针变量</span></span><br><span class="line">  <span class="keyword">var</span> point = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//将每次截取的剩余字符串存放到该变量</span></span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="comment">//循环遍历传入的开始标签的属性</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attrsStr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> char = attrsStr[i];</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">      当isYinhao为真时遇到空格不用对该字符串进行截取</span></span><br><span class="line"><span class="comment">      当isYinhao为假时遇到空格进行截取</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> (char == <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">      isYinhao = !isYinhao;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (char == <span class="string">&#x27; &#x27;</span> &amp;&amp; !isYinhao) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="regexp">/^\s*$/</span>.test(attrsStr.substring(point, i))) &#123;</span><br><span class="line">        result.push(attrsStr.substring(point, i).trim());</span><br><span class="line">        point = i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将最后剩余的部分也进行截取</span></span><br><span class="line">  result.push(attrsStr.substring(point).trim())</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//将拆分的字符串进行二次截取，变成键值对的形式</span></span><br><span class="line">  result = result.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> o = item.match(<span class="regexp">/^(.+)=(.+)$/</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: o[<span class="number">1</span>],</span><br><span class="line">      <span class="attr">value</span>: o[<span class="number">2</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue源码之mustache模板引擎</title>
      <link href="/archives/6c562092.html"/>
      <url>/archives/6c562092.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue源码之mustache模板引擎"><a href="#Vue源码之mustache模板引擎" class="headerlink" title="Vue源码之mustache模板引擎"></a>Vue源码之mustache模板引擎</h1><h2 id="mustache库的工作机理"><a href="#mustache库的工作机理" class="headerlink" title="mustache库的工作机理"></a>mustache库的工作机理</h2><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-05-26_19-10-35.jpg"></p><h2 id="tokens"><a href="#tokens" class="headerlink" title="tokens"></a>tokens</h2><p>tokens是一个JS的嵌套数组，是模板字符串的JS表示</p><p>模板字符串</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> 我买了一个&#123;&#123;thing&#125;&#125;，好&#123;&#123;mood&#125;&#125;啊 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>tokens（每个数组的第零项都是第一项的数据类型）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&lt;h1&gt; 我买了一个&quot;</span>],    <span class="comment">//token</span></span><br><span class="line">  [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;thing&quot;</span>],            <span class="comment">//token</span></span><br><span class="line">  [<span class="string">&quot;text&quot;</span>, <span class="string">&quot;,好&quot;</span>],              <span class="comment">//token</span></span><br><span class="line">  [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;mood&quot;</span>],             <span class="comment">//token</span></span><br><span class="line">  [<span class="string">&quot;text&quot;</span>, <span class="string">&quot;啊&lt;/h1&gt;&quot;</span>],          <span class="comment">//token</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>当模板字符串中有循环存在时，他将被编译为嵌套更深的tokens</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123;#arr&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;.&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/arr&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>tonkes</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&lt;div&gt;&lt;ul&gt;&quot;</span>],</span><br><span class="line">[<span class="string">&quot;#&quot;</span>, <span class="string">&quot;arr&quot;</span>, [</span><br><span class="line">[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&lt;li&gt;&quot;</span>],</span><br><span class="line">[<span class="string">&quot;name&quot;</span>, <span class="string">&quot;.&quot;</span>],</span><br><span class="line">[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&lt;/li&gt;&quot;</span>]</span><br><span class="line">]],</span><br><span class="line">[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&lt;/ul&gt;&lt;/div&gt;&quot;</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>因此mustache库只需要做两件事</p><ol><li>将模板字符串编译为tokens形式</li><li>将tokens结合数据，解析为dom字符串</li></ol><h2 id="手写一个简单的mustache模板引擎"><a href="#手写一个简单的mustache模板引擎" class="headerlink" title="手写一个简单的mustache模板引擎"></a>手写一个简单的mustache模板引擎</h2><p><img src="https://hawkingl.cn/BlogPic/mustache%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.jpg"></p><h3 id="初始化文件夹"><a href="#初始化文件夹" class="headerlink" title="初始化文件夹"></a>初始化文件夹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack@4 webpack-cli@3 webpack-dev-server@3</span><br></pre></td></tr></table></figure><h3 id="配置webpack"><a href="#配置webpack" class="headerlink" title="配置webpack"></a>配置webpack</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//模式为开发模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//配置webpack_dev_server</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">//静态文件根目录</span></span><br><span class="line">    <span class="attr">contentBase</span>: path.join(__dirname, <span class="string">&quot;www&quot;</span>),</span><br><span class="line">    <span class="comment">//端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8081</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="配置入口文件"><a href="#配置入口文件" class="headerlink" title="配置入口文件"></a>配置入口文件</h3><h4 id="www-index-html"><a href="#www-index-html" class="headerlink" title="www/index.html"></a>www/index.html</h4><p>引入一个html模板字符串，使用定义的模板引擎将模板字符串转换为html字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;mustache&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;container&quot;&gt;Hello world&lt;/div&gt;</span><br><span class="line">  &lt;script src=&quot;/xuni/bundle.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    //模板字符串</span><br><span class="line">    var templateStr = `</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;&#123;#students&#125;&#125;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;div class=&quot;hd&quot;&gt; &#123;&#123;name&#125;&#125; 的基本信息&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;bd&quot;&gt;</span><br><span class="line">              &lt;p&gt;姓名：&#123;&#123;name&#125;&#125;&lt;/p&gt;</span><br><span class="line">              &lt;p&gt;年龄：&#123;&#123;age&#125;&#125; &lt;/p&gt;</span><br><span class="line">              &lt;p&gt;性别：&#123;&#123;sex&#125;&#125; &lt;/p&gt;</span><br><span class="line">              &lt;h2&gt;爱好&lt;/h2&gt;</span><br><span class="line">              &#123;&#123;#hobbies&#125;&#125;</span><br><span class="line">                &lt;h3&gt;&#123;&#123;.&#125;&#125;&lt;/h3&gt;</span><br><span class="line">              &#123;&#123;/hobbies&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &#123;&#123;/students&#125;&#125;  </span><br><span class="line">      &lt;/ul&gt; </span><br><span class="line">    `</span><br><span class="line">    //模板数据</span><br><span class="line">    var data = &#123;</span><br><span class="line">      students: [</span><br><span class="line">        &#123;&quot;name&quot;: &quot;小明&quot;, &quot;age&quot;: 12, &quot;sex&quot;: &quot;男&quot;, &quot;hobbies&quot;: [&quot;游泳&quot;, &quot;跑步&quot;]&#125;,</span><br><span class="line">        &#123;&quot;name&quot;: &quot;小红&quot;, &quot;age&quot;: 11, &quot;sex&quot;: &quot;女&quot;, &quot;hobbies&quot;: [&quot;游泳&quot;, &quot;跑步&quot;]&#125;,</span><br><span class="line">        &#123;&quot;name&quot;: &quot;小强&quot;, &quot;age&quot;: 13, &quot;sex&quot;: &quot;男&quot;, &quot;hobbies&quot;: [&quot;游泳&quot;, &quot;跑步&quot;]&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">//mustache模板引擎</span><br><span class="line">    var domStr = myMustache.render(templateStr, data);</span><br><span class="line"></span><br><span class="line">//获取元素节点</span><br><span class="line">    var container = document.getElementById(&#x27;container&#x27;);</span><br><span class="line">    //将模板字符串插入该节点中</span><br><span class="line">    container.innerHTML = domStr;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h4 id="src-index-js"><a href="#src-index-js" class="headerlink" title="src/index.js"></a>src/index.js</h4><p>入口 JS 文件：在window属性上绑定一个myMustache属性，在myMustache属性上定义一个render(templateStr, data)方法，该方法需要传入模板字符串和对应的数据，其中parseTemplateToTokens()方法可以将模板字符串转换为一个tokens数组，renderTemplate() 方法可以将tokens数组中的模板那变量与对应的数据进行替换，再将替换完之后的tokens数组重新拼接成模板字符串返回。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> parseTemplateToTokens <span class="keyword">from</span> <span class="string">&quot;./parseTemplateToTokens&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> renderTemplate <span class="keyword">from</span> <span class="string">&quot;./renderTemplate&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="built_in">window</span>.myMustache = &#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">templateStr, data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tokens = parseTemplateToTokens(templateStr);</span><br><span class="line">    templateStr = renderTemplate(tokens, data);</span><br><span class="line">    <span class="keyword">return</span> templateStr;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="class-Scanner"><a href="#class-Scanner" class="headerlink" title="class Scanner"></a>class Scanner</h3><p>Scanner类：可以构造一个扫描类的实例对象，其中 scna(tag) 函数可以将字符串中为 tag 的字符跳过，输出 tag 之后的字符串；scanUtil(stopTag)函数可以将上一个stopTag和当前stopTag之间的字符串进行输出。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Scanner类：识别&#x27;&#123;&#123;&#x27;和’&#125;&#125;‘ 两边和之间的内容并将其包裹成相应的数组 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Scanner</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">templateStr</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.templateStr = templateStr;</span><br><span class="line">    <span class="built_in">this</span>.pos = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.tail = templateStr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">scan</span>(<span class="params">tag</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.tail.indexOf(tag) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.pos += tag.length;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.templateStr.substr(<span class="built_in">this</span>.pos);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">scanUtil</span>(<span class="params">stopTag</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> pos_back = <span class="built_in">this</span>.pos;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">this</span>.pos &lt; <span class="built_in">this</span>.templateStr.length &amp;&amp; <span class="built_in">this</span>.tail.indexOf(stopTag) != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.pos++;</span><br><span class="line">      <span class="built_in">this</span>.tail = <span class="built_in">this</span>.templateStr.substr(<span class="built_in">this</span>.pos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.templateStr.substring(pos_back, <span class="built_in">this</span>.pos);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="parseTemplateToTokens-templateStr"><a href="#parseTemplateToTokens-templateStr" class="headerlink" title="parseTemplateToTokens(templateStr)"></a>parseTemplateToTokens(templateStr)</h3><p>在parseTemplateToTokens()函数中实例化一个Scanner对象，配合scan()和 scanUtil()可以将模板字符串转换为一个tokens数组，最后再调用nestTokens(tokens)函数可以在tokens数组中嵌套一个tokens数组，实现数据的循环嵌套。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 将传入的字符串变为tokens数组 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nestTokens <span class="keyword">from</span> <span class="string">&quot;./nestTokens&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Scanner <span class="keyword">from</span> <span class="string">&quot;./Scanner&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">parseTemplateToTokens</span>(<span class="params">templateStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tokens = [];</span><br><span class="line">  <span class="keyword">var</span> scanner = <span class="keyword">new</span> Scanner(templateStr);</span><br><span class="line">  <span class="keyword">while</span> (scanner.pos &lt; templateStr.length) &#123;</span><br><span class="line">    <span class="keyword">var</span> words = scanner.scanUtil(<span class="string">&#x27;&#123;&#123;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (words) &#123;</span><br><span class="line">      tokens.push([<span class="string">&#x27;text&#x27;</span>, words]);</span><br><span class="line">    &#125;</span><br><span class="line">    scanner.scan(<span class="string">&#x27;&#123;&#123;&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> words = scanner.scanUtil(<span class="string">&#x27;&#125;&#125;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (words != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (words[<span class="number">0</span>] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">        tokens.push([<span class="string">&#x27;#&#x27;</span>, words.substring(<span class="number">1</span>)]);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (words[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        tokens.push([<span class="string">&#x27;/&#x27;</span>, words.substring(<span class="number">1</span>)]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tokens.push([<span class="string">&#x27;name&#x27;</span>, words]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    scanner.scan(<span class="string">&#x27;&#125;&#125;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nestTokens(tokens);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nestTokens-tokens"><a href="#nestTokens-tokens" class="headerlink" title="nestTokens(tokens)"></a>nestTokens(tokens)</h3><p>将传过来的二维数组折叠成更高维的数组，实现数组的循环嵌套</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*将 # 与 / 之间的数组进行折叠 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">nestTokens</span>(<span class="params">tokens</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nestTokens = [];</span><br><span class="line">  <span class="keyword">var</span> sections = [];</span><br><span class="line">  <span class="keyword">var</span> collector = nestTokens;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tokens.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> token = tokens[i];</span><br><span class="line">    <span class="keyword">switch</span> (token[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">        collector.push(token);</span><br><span class="line">        sections.push(token);</span><br><span class="line">        collector = token[<span class="number">2</span>] = [];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        sections.pop();</span><br><span class="line">        collector = sections.length &gt; <span class="number">0</span> ? sections[sections.length - <span class="number">1</span>][<span class="number">2</span>] : nestTokens;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        collector.push(token);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nestTokens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nestTokens(tokens)函数输出的nestTokens数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;ul&gt;&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;#&quot;</span>,<span class="string">&quot;students&quot;</span>,[</span><br><span class="line">        [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;li&gt;&lt;div class=\&quot;hd\&quot;&gt; &quot;</span>],</span><br><span class="line">        [<span class="string">&quot;name&quot;</span>,<span class="string">&quot;name&quot;</span>],</span><br><span class="line">        [ <span class="string">&quot;text&quot;</span>,<span class="string">&quot; 的基本信息&lt;/div&gt;&lt;div class=\&quot;bd\&quot;&gt;&lt;p&gt;姓名：&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;name&quot;</span>,<span class="string">&quot;name&quot;</span> ],</span><br><span class="line">        [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;/p&gt;&lt;p&gt;年龄：&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;text&quot;</span>,<span class="string">&quot; &lt;/p&gt;&lt;p&gt;性别：&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;sex&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;text&quot;</span>,<span class="string">&quot; &lt;/p&gt;&lt;h2&gt;爱好&lt;/h2&gt;&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;#&quot;</span>,<span class="string">&quot;hobbies&quot;</span>,[</span><br><span class="line">             [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;h3&gt;&quot;</span>],</span><br><span class="line">             [<span class="string">&quot;name&quot;</span>,<span class="string">&quot;.&quot;</span>],</span><br><span class="line">             [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;/h3&gt;&quot;</span>]</span><br><span class="line">         ]</span><br><span class="line">     ],</span><br><span class="line">     [<span class="string">&quot;text&quot;</span>,<span class="string">&quot;&lt;/div&gt;&lt;/li&gt;&quot;</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="renderTemplate-tokens-data"><a href="#renderTemplate-tokens-data" class="headerlink" title="renderTemplate(tokens, data)"></a>renderTemplate(tokens, data)</h3><p>将折叠之后的tokens数组中的模板变量用data中的真实数据进行替换后，重新拼接为html字符串，配置praseArray(tokens, data)函数使用递归算法，将tokens数组中嵌套的tokens数组也进行替换拼接处理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> parseArray <span class="keyword">from</span> <span class="string">&quot;./parseArray&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将tokens数组转换为模板字符串 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">renderTemplate</span>(<span class="params">tokens, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> resultStr = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tokens.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tokens[i][<span class="number">0</span>] == <span class="string">&#x27;text&#x27;</span>) &#123;</span><br><span class="line">      resultStr += tokens[i][<span class="number">1</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tokens[i][<span class="number">0</span>] == <span class="string">&#x27;name&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> v = tokens[i][<span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span> ? data : data[(tokens[i][<span class="number">1</span>])];</span><br><span class="line">      resultStr += v;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resultStr += parseArray(tokens[i], data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> resultStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="praseArray-tokens-data"><a href="#praseArray-tokens-data" class="headerlink" title="praseArray(tokens, data)"></a>praseArray(tokens, data)</h3><p>配合renderTemplate()函数使用递归算法输出拼接完成的模板字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> renderTemplate <span class="keyword">from</span> <span class="string">&quot;./renderTemplate&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理tokens中的循环遍历 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">parseArray</span>(<span class="params">tokens, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> templateStr = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">/* 遍历数据 */</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data[tokens[<span class="number">1</span>]].length; i++) &#123;</span><br><span class="line">    templateStr += renderTemplate(tokens[<span class="number">2</span>], data[tokens[<span class="number">1</span>]][i]);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> templateStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出resultStr字符串</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span> 小明 的基本信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：小明<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：12 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：男 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h2</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span>游泳<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span> 小红 的基本信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：小红<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：11 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：女 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h2</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span>游泳<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span> 小强 的基本信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：小强<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：13 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：男 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>游泳<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue源码之指令和生命周期</title>
      <link href="/archives/f966f55d.html"/>
      <url>/archives/f966f55d.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue源码之指令和生命周期"><a href="#Vue源码之指令和生命周期" class="headerlink" title="Vue源码之指令和生命周期"></a>Vue源码之指令和生命周期</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>该篇主要是对前面所有技术的总结，每一个算法在整个Vue框架中的哪一个环节运行，在什么时候执行，只针对Vue框架中的核心功能进行演示，不对细节进行处理。</p><h2 id="测试环境的搭建"><a href="#测试环境的搭建" class="headerlink" title="测试环境的搭建"></a>测试环境的搭建</h2><p><img src="https://hawkingl.cn/BlogPic/Snipaste_2022-06-21_15-45-51.jpg"></p><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>npm i webpack@5 -D</p><p>npm i webpack-cli@4 -D</p><p>npm i webpack-dev-server@4 -D</p><h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><p>配置整个程序的入口和出口文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/xuni/&#x27;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">    <span class="attr">static</span>: &#123;</span><br><span class="line">      <span class="attr">directory</span>: path.join(__dirname, <span class="string">&#x27;www&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><p>index.js</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>指令和生命周期<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    你好&#123;&#123;a&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;a &gt; 0&quot;</span>&gt;</span>你好&#123;&#123;a&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;a&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>A<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>B<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./xuni/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">a</span>: <span class="number">10</span></span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">a</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&quot;a改变了&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;./Vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="built_in">window</span>.Vue = Vue;</span><br></pre></td></tr></table></figure><p>Vue.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Compile <span class="keyword">from</span> <span class="string">&quot;./Compile&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observe &#125; <span class="keyword">from</span> <span class="string">&quot;./observe&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Watcher <span class="keyword">from</span> <span class="string">&quot;./Watcher&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Vue</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$options = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    <span class="built_in">this</span>._data = options.data || <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">//将传入的data中的数据变为响应式的</span></span><br><span class="line">    observe(<span class="built_in">this</span>._data);</span><br><span class="line">    <span class="comment">//将传入的data中的数据绑定在Vue实例上</span></span><br><span class="line">    <span class="built_in">this</span>._initData();</span><br><span class="line">    <span class="comment">//默认调用watch</span></span><br><span class="line">    <span class="built_in">this</span>._initWatch();</span><br><span class="line">    <span class="comment">//将数据变为响应式的</span></span><br><span class="line">    <span class="comment">//模板编译</span></span><br><span class="line">    <span class="keyword">new</span> Compile(options.el, <span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">_initData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>; </span><br><span class="line">    <span class="comment">//将传入的data中的数据绑定在Vue实例上</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(<span class="built_in">this</span>._data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(self, key, &#123;</span><br><span class="line">        <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> self._data[key];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">set</span>(<span class="params">newVal</span>)</span> &#123;</span><br><span class="line">          self._data[key] = newVal;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">_initWatch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> watch = <span class="built_in">this</span>.$options.watch;</span><br><span class="line">    <span class="built_in">Object</span>.keys(watch).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> Watcher(self, key, watch[key])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Complie.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Watcher <span class="keyword">from</span> <span class="string">&quot;./Watcher&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Compile</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">el, vue</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//vue实例</span></span><br><span class="line">    <span class="built_in">this</span>.$vue = vue;</span><br><span class="line">    <span class="comment">//挂载点</span></span><br><span class="line">    <span class="built_in">this</span>.$el = <span class="built_in">document</span>.querySelector(el); </span><br><span class="line">    <span class="comment">//如果用户传入了挂载点时</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.$el) &#123;</span><br><span class="line">      <span class="comment">//调用函数，让节点变为fragment,实际上就是将真实节点变为mustache中的tokens数组，使用的是AST抽象语法树</span></span><br><span class="line">      <span class="keyword">let</span> $fragment = <span class="built_in">this</span>.node2Fragment(<span class="built_in">this</span>.$el);</span><br><span class="line">      <span class="comment">//编译模板</span></span><br><span class="line">      <span class="built_in">this</span>.compile($fragment);</span><br><span class="line">      <span class="comment">//将编译好的模板上树</span></span><br><span class="line">      <span class="built_in">this</span>.$el.appendChild($fragment);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">node2Fragment</span>(<span class="params">el</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> fragment = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">    <span class="keyword">var</span> child;</span><br><span class="line">    <span class="comment">//注意：使用appendChild添加子元素时，如果该子元素是从真实DOM节点中获取到的则会删除他原来在真实DOM节点中的位置</span></span><br><span class="line">    <span class="keyword">while</span> (child = el.firstChild) &#123;</span><br><span class="line">      fragment.appendChild(child);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fragment;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">compile</span>(<span class="params">el</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//获取节点子元素</span></span><br><span class="line">    <span class="keyword">var</span> childNodes = el.childNodes;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/</span>;</span><br><span class="line"></span><br><span class="line">    childNodes.forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> text = node.textContent;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) &#123;</span><br><span class="line">        self.compileElement(node);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.nodeType == <span class="number">3</span> &amp;&amp; reg.test(text)) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = text.match(reg)[<span class="number">1</span>];</span><br><span class="line">        self.compileText(node, name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">compileElement</span>(<span class="params">node</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nodeAttrs = node.attributes;</span><br><span class="line">    <span class="built_in">Array</span>.prototype.slice.call(nodeAttrs).forEach(<span class="function"><span class="params">attr</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//这里开始分析指令</span></span><br><span class="line">      <span class="keyword">var</span> attrName = attr.name;</span><br><span class="line">      <span class="keyword">var</span> value = attr.value;</span><br><span class="line">      <span class="comment">//指令开头都是v-开头的</span></span><br><span class="line">      <span class="keyword">var</span> dir = attrName.substring(<span class="number">2</span>);</span><br><span class="line">      <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//判断是否为指令</span></span><br><span class="line">      <span class="keyword">if</span> (attrName.indexOf(<span class="string">&#x27;v-&#x27;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//v-开头的就是指令</span></span><br><span class="line">        <span class="keyword">if</span> (dir == <span class="string">&#x27;model&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">//双向数据绑定</span></span><br><span class="line">          <span class="keyword">new</span> Watcher(self.$vue, value, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            node.value = value;</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">var</span> v = self.getVueVal(self.$vue, value);</span><br><span class="line">          node.value = v;</span><br><span class="line"></span><br><span class="line">          node.addEventListener(<span class="string">&#x27;input&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> newVal = e.target.value;</span><br><span class="line"></span><br><span class="line">            self.setVueVal(self.$vue, value, newVal);</span><br><span class="line">            v = newVal;</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(dir == <span class="string">&#x27;if&#x27;</span>)&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;发现了if指令&#x27;</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">compileText</span>(<span class="params">node, name</span>)</span> &#123;</span><br><span class="line">    node.textContent = <span class="built_in">this</span>.getVueVal(<span class="built_in">this</span>.$vue, name);</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.$vue, name, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      node.textContent = value;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getVueVal</span>(<span class="params">vue, exp</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> val = vue;</span><br><span class="line">    exp = exp.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    exp.forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">      val = val[k];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setVueVal</span>(<span class="params">vue, exp, value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> val = vue;</span><br><span class="line">    exp = exp.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    exp.forEach(<span class="function">(<span class="params">k, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; exp.length - <span class="number">1</span>) &#123;</span><br><span class="line">        val = val[k];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val[k] = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入了解sync修饰符</title>
      <link href="/archives/a64c000c.html"/>
      <url>/archives/a64c000c.html</url>
      
        <content type="html"><![CDATA[<h1 id="深入理解sync修饰符"><a href="#深入理解sync修饰符" class="headerlink" title="深入理解sync修饰符"></a>深入理解sync修饰符</h1><p>🤗vue修饰符aync功能：<div class="note success no-icon flat"><p>当一个子组件改变了一个prop的值时，这个变化也会同步到父组件中。 </p></div></p><p>一个组件上只能定义一个v-model，如果其他prop也要实现双向绑定怎么办？简单的方法就是子组件发送一个事件，父组件监听该事件然后更新prop数据。</p><p>子组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// info.vue组件定义了一个value 属性， 和一个valueChanged事件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input @input=&quot;onInput&quot; :value=&quot;value&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">        value: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        onInput(e) &#123;</span><br><span class="line">            this.$emit(&quot;valueChanged&quot;, e.target.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>父组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;info :value=&quot;myValue&quot; @valueChanged=&quot;e =&gt; myValue = e&quot;&gt;&lt;/info&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    inport info from &#x27;./info.vue&#x27;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line">            info,</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                myValue: 1234,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>用sync修饰符简化上述代码：</p><p>用法1：v-bind:prop.sync=”propvalue”</p><p>父组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// info.vue组件</span><br><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    onInput(e) &#123;</span><br><span class="line">        this.$emit(&quot;update:value&quot;, e.target.value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// index.vue组件</span><br><span class="line">&lt;info :value.sync=&quot;myValue&quot;&gt;&lt;/info&gt;</span><br></pre></td></tr></table></figure><p>用法2：v-bind.sync=”obj”</p><p>如果一个组件的多个prop都要实现双向绑定，根据上面学到的知识，只需要每个prop加sync修饰符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;info :a.sync=&quot;value1&quot; :b.sync=&quot;value2&quot; :c.sync=&quot;value2&quot; :d.sync=&quot;value2&quot;&gt;&lt;/info&gt;</span><br></pre></td></tr></table></figure><p>这样写太麻烦，vue提供了一种更简便的方法， v-bind.sync = “对象”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;info v-bind.sync=&quot;obj&quot;&gt;&lt;/info&gt;</span><br><span class="line">...</span><br><span class="line">&lt;script&gt;</span><br><span class="line">..</span><br><span class="line">data() &#123;</span><br><span class="line">    obj: &#123;a: &#x27;&#x27;, b: &#x27;&#x27;, c: &#x27;&#x27;, d: &#x27;&#x27;&#125;</span><br><span class="line">&#125;</span><br><span class="line">..</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>注意：</p><div class="note danger no-icon flat"><p>带有.sync修饰符的v-bind不能喝表达式一起使用（例如 v-bind:title.sync = “doc.title + ‘!’”是无效的）。取而代之的是，你只能你想要绑定的属性名。</p></div>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue编译时Cannot read properties of undefined (reading &#39;0&#39;)错误的解决方法</title>
      <link href="/archives/450b38d8.html"/>
      <url>/archives/450b38d8.html</url>
      
        <content type="html"><![CDATA[<p>错误原因<span class="github-emoji" alias="sob" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8">&#x1f62d;</span>：由于页面在挂载时请求的数据没有及时的返回，使其解析时读取到的数据为空，如果连续读取空数据的属性值时，这时浏览器就会报错<span class="github-emoji" alias="broken_heart" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f494.png?v8">&#x1f494;</span>，读取空数据的属性值时会返回undefined，这时如果再次读取undefined的属性值时就会报错<span class="github-emoji" alias="rocket" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f680.png?v8">&#x1f680;</span>。<br><img src="https://hawkingl.cn/BlogPic/20220308203404.png"></p><p>解决方法：数据仓库返回数据时对数据进行加工，让其至少返回一个空数组，或对象<span class="github-emoji" alias="thumbsup" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8">&#x1f44d;</span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const getters = &#123;</span><br><span class="line">  categoryView(state) &#123;</span><br><span class="line">    return state.goodInfo.categoryView || &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不过值得注意的是，这种错误报的错误是一种假的错误，并不会影响代码的编译<span class="github-emoji" alias="joy" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8">&#x1f602;</span>。</p>]]></content>
      
      
      <categories>
          
          <category> 项目日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue常见错误 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>axios的深度理解和使用</title>
      <link href="/archives/d9e8b7c1.html"/>
      <url>/archives/d9e8b7c1.html</url>
      
        <content type="html"><![CDATA[<h2 id="axios-特点"><a href="#axios-特点" class="headerlink" title="axios 特点"></a>axios 特点</h2><ol><li>基于 xhr + promise 的异步 ajax请求库</li><li>浏览器端/node 端都可以使用</li><li>支持请求／响应拦截器</li><li>支持请求取消</li><li>请求/响应数据转换</li><li>批量发送多个请求</li></ol><h2 id="axios-常用语法"><a href="#axios-常用语法" class="headerlink" title="axios 常用语法"></a>axios 常用语法</h2><p><code>axios(config)</code>: 通用/最本质的发任意类型请求的方式<br><code>axios(url[, config])</code>: 可以只指定url 发get 请求<br><code>axios.request(config)</code>: 等同于axios(config)<br><code>axios.get(url[, config])</code>: 发get 请求<br><code>axios.delete(url[, config])</code>: 发delete 请求<br><code>axios.post(url[, data, config])</code>: 发post 请求<br><code>axios.put(url[, data, config])</code>: 发put 请求</p><p><code>axios.defaults.xxx</code>: 请求的默认全局配置（method\baseURL\params\timeout…）<br><code>axios.interceptors.request.use()</code>: 添加请求拦截器<br><code>axios.interceptors.response.use()</code>: 添加响应拦截器</p><p><code>axios.create([config])</code>: 创建一个新的axios(它没有下面的功能)</p><p><code>axios.Cancel()</code>: 用于创建取消请求的错误对象<br><code>axios.CancelToken()</code>: 用于创建取消请求的 token 对象<br><code>axios.isCancel()</code>: 是否是一个取消请求的错误<br><code>axios.all(promises)</code>: 用于批量执行多个异步请求<br><code>axios.spread()</code>: 用来指定接收所有成功数据的回调函数的方法</p><h2 id="难点语法的理解和使用"><a href="#难点语法的理解和使用" class="headerlink" title="难点语法的理解和使用"></a>难点语法的理解和使用</h2><h3 id="axios-create-config"><a href="#axios-create-config" class="headerlink" title="axios.create(config)"></a><code>axios.create(config)</code></h3><ol><li>根据指定配置创建一个新的 axios, 也就是每个新 axios 都有自己的配置</li><li>新 axios 只是没有<strong>取消请求</strong>和<strong>批量发请求</strong>的方法, 其它所有语法都是一致的</li><li>为什么要设计这个语法?<br>(1) 需求: 项目中有部分接口需要的配置与另一部分接口需要的配置不太一样, 如何处理（比如有多个baseURL需要指定）<br>(2) 解决: 创建2 个新axios, 每个都有自己特有的配置, 分别应用到不同要求的接口请求中</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const instance = axios.create(&#123; // instance是函数类型</span><br><span class="line">baseURL: &#x27;http://localhost:3000&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">// 使用instance发Ajax请求</span><br><span class="line">instance(&#123;</span><br><span class="line">url: &#x27;/posts&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">instance.get(&#x27;/posts&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="拦截器函数-ajax-请求-请求的回调函数的调用顺序"><a href="#拦截器函数-ajax-请求-请求的回调函数的调用顺序" class="headerlink" title="拦截器函数/ajax 请求/请求的回调函数的调用顺序"></a>拦截器函数/ajax 请求/请求的回调函数的调用顺序</h3><ol><li>说明: 调用<code>axios()</code>并不是立即发送ajax 请求, 而是需要经历一个较长的流程</li><li>流程: 请求拦截器2 =&gt; 请求拦截器1 =&gt; 发ajax 请求 =&gt; 响应拦截器1 =&gt; 响应拦截器2 =&gt; 请求的回调</li><li>注意: 此流程是通过 promise 串连起来的, 请求拦截器传递的是<code>config</code>, 响应拦截器传递的是<code>response</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">// 添加两个请求拦截器(回调函数)</span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    console.log(&#x27;request interceptor1 onResolved()&#x27;) // -----------2</span><br><span class="line">    return config</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&#x27;request interceptor1 onRejected()&#x27;)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    console.log(&#x27;request interceptor2 onResolved()&#x27;) // -----------1</span><br><span class="line">    return config</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&#x27;request interceptor2 onRejected()&#x27;)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 添加两个响应拦截器</span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  resopnse =&gt; &#123;</span><br><span class="line">    console.log(&#x27;response interceptor1 onResolved()&#x27;) // -----------3</span><br><span class="line">    return resopnse</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&#x27;response interceptor1 onRejected()&#x27;)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  resopnse =&gt; &#123;</span><br><span class="line">    console.log(&#x27;response interceptor2 onResolved()&#x27;) // -----------4</span><br><span class="line">    return resopnse</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&#x27;response interceptor2 onRejected()&#x27;)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">axios.get(&#x27;http://localhost:3000/posts&#x27;)</span><br><span class="line">  .then(response =&gt; &#123;</span><br><span class="line">    console.log(&#x27;data&#x27;, response.data) //data Array(4) -------------5</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    cosole.log(&#x27;error&#x27;, error.message)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">// request interceptor2 onResolved()</span><br><span class="line">// request interceptor1 onResolved()</span><br><span class="line">// response interceptor1 onResolved()</span><br><span class="line">// response interceptor2 onResolved()</span><br><span class="line">// data Array(4)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="取消请求"><a href="#取消请求" class="headerlink" title="取消请求"></a>取消请求</h3><h4 id="1-基本流程"><a href="#1-基本流程" class="headerlink" title="1. 基本流程"></a>1. 基本流程</h4><ol><li>配置 <code>cancelToken</code> 对象</li><li>缓存用于取消请求的 <code>cancel</code> 函数</li><li>在后面特定时机调用 <code>cancel</code> 函数取消请求</li><li>在错误回调中判断如果 <code>error</code> 是 <code>cancel</code>, 做相应处理</li></ol><h4 id="2-实现功能"><a href="#2-实现功能" class="headerlink" title="2. 实现功能"></a>2. 实现功能</h4><p>1.用express先搭建一个有延迟的服务器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;)</span><br><span class="line">const cors = require(&#x27;cors&#x27;)</span><br><span class="line"></span><br><span class="line">const app = express()</span><br><span class="line"></span><br><span class="line">// 使用cors, 允许跨域</span><br><span class="line">app.use(cors())</span><br><span class="line">// 能解析urlencode格式的post请求体参数</span><br><span class="line">app.use(express.urlencoded())</span><br><span class="line">// 能解析json格式的请求体参数</span><br><span class="line">app.use(express.json())</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/products1&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    res.send([</span><br><span class="line">      &#123;id: 1, name: &#x27;product1.1&#x27;&#125;,</span><br><span class="line">      &#123;id: 2, name: &#x27;product1.2&#x27;&#125;,</span><br><span class="line">      &#123;id: 3, name: &#x27;product1.3&#x27;&#125;</span><br><span class="line">    ])</span><br><span class="line">  &#125;, 1000 + Math.random()*2000);</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/products2&#x27;, (req, res) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    res.send([&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        name: &#x27;product2.1&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        name: &#x27;product2.2&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        id: 3,</span><br><span class="line">        name: &#x27;product2.3&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">  &#125;, 1000 + Math.random() * 2000);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(4000, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;server app start on port 4000&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.点击按钮, 取消某个正在请求中的请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">let cancel // 用于保存取消请求的函数</span><br><span class="line">function getProducts1() &#123;</span><br><span class="line">  axios(&#123;</span><br><span class="line">    url: &#x27;http://localhost:4000/products1&#x27;,</span><br><span class="line">    cancelToken: new axios.CancelToken(function executor(c)&#123; // c是用于取消当前请求的函数</span><br><span class="line">      // 保存取消函数，用于之后可能需要取消当前请求</span><br><span class="line">      cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      cancel = null</span><br><span class="line">      console.log(&#x27;请求1成功了&#x27;, response.data)</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      cancel = null</span><br><span class="line">      console.log(&#x27;请求1失败了&#x27;, error.message, error) // 请求1失败了 强制取消请求 Cancel &#123;message: &quot;强制取消请求&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getProducts2() &#123;</span><br><span class="line">  axios(&#123;</span><br><span class="line">      url: &#x27;http://localhost:4000/products2&#x27;</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      console.log(&#x27;请求2成功了&#x27;, response.data)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cancelReq() &#123;</span><br><span class="line">  // alert(&#x27;取消请求&#x27;)</span><br><span class="line">  // 执行取消请求的函数</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;强制取消请求&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(&#x27;没有可取消的请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3.在请求一个接口前, 取消前面一个未完成的请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">let cancel // 用于保存取消请求的函数</span><br><span class="line">function getProducts1() &#123;</span><br><span class="line">  // 在准备发请求前，取消未完成的请求</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;取消请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  axios(&#123;</span><br><span class="line">    url: &#x27;http://localhost:4000/products1&#x27;,</span><br><span class="line">    cancelToken: new axios.CancelToken(function executor(c)&#123; // c是用于取消当前请求的函数</span><br><span class="line">      // 保存取消函数，用于之后可能需要取消当前请求</span><br><span class="line">      cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line"></span><br><span class="line">      cancel = null</span><br><span class="line">      console.log(&#x27;请求1成功了&#x27;, response.data)</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      if (axios.isCancel(error))&#123;</span><br><span class="line">        console.log(&#x27;请求1取消的错误&#x27;, error.message)</span><br><span class="line">      &#125;else&#123; // 请求出错了</span><br><span class="line">        cancel = null</span><br><span class="line">        console.log(&#x27;请求1失败了&#x27;, error.message, error) // 请求1失败了 强制取消请求 Cancel &#123;message: &quot;强制取消请求&quot;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getProducts2() &#123;</span><br><span class="line">// 在准备发请求前，取消未完成的请求</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;取消请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  axios(&#123;</span><br><span class="line">      url: &#x27;http://localhost:4000/products2&#x27;,</span><br><span class="line">      cancelToken: new axios.CancelToken(function executor(c)&#123; </span><br><span class="line">      cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      cancel = null</span><br><span class="line">      console.log(&#x27;请求2成功了&#x27;, response.data)</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      if (axios.isCancel(error))&#123;</span><br><span class="line">        console.log(&#x27;请求2取消的错误&#x27;, error.message)</span><br><span class="line">      &#125;else&#123; </span><br><span class="line">        cancel = null</span><br><span class="line">        console.log(&#x27;请求2失败了&#x27;, error.message, error) </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">function cancelReq() &#123;</span><br><span class="line">  // alert(&#x27;取消请求&#x27;)</span><br><span class="line">  // 执行取消请求的函数</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;强制取消请求&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(&#x27;没有可取消的请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="使用拦截器改进代码，减少重复代码"><a href="#使用拦截器改进代码，减少重复代码" class="headerlink" title="使用拦截器改进代码，减少重复代码"></a>使用拦截器改进代码，减少重复代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">// 添加请求拦截器</span><br><span class="line">axios.interceptors.request.use((config) =&gt; &#123; // 只写一个成功的回调</span><br><span class="line">  // 在准备发请求前，取消未完成的请求</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;取消请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  // 添加一个cancelToken的配置</span><br><span class="line">  config.cancelToken = new axios.CancelToken(function executor(c)&#123; // c是用于取消当前请求的函数</span><br><span class="line">      // 保存取消函数，用于之后可能需要取消当前请求</span><br><span class="line">      cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">    return config</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 添加响应拦截器</span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  response =&gt; &#123; // 成功的回调</span><br><span class="line">    cancel = null </span><br><span class="line">    return response</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123; // 失败的回调</span><br><span class="line">    if (axios.isCancel(error))&#123; // 请求取消的错误</span><br><span class="line">        console.log(&#x27;请求取消的错误&#x27;, error.message)</span><br><span class="line">        // 中断promise链</span><br><span class="line">        return new Promise(() =&gt; &#123;&#125;)</span><br><span class="line">    &#125;else&#123; // 请求出错了</span><br><span class="line">      cancel = null </span><br><span class="line">      // 将错误向下传递 </span><br><span class="line">      // throw error</span><br><span class="line">      return Promise.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">let cancel // 用于保存取消请求的函数</span><br><span class="line">function getProducts1() &#123;</span><br><span class="line">  axios(&#123;</span><br><span class="line">    url: &#x27;http://localhost:4000/products1&#x27;</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      console.log(&#x27;请求1成功了&#x27;, response.data)</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123; // 只用处理请求失败的情况，取消请求的错误不用处理</span><br><span class="line">      console.log(&#x27;请求1失败了&#x27;, error.message, error) </span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getProducts2() &#123;</span><br><span class="line">  axios(&#123;</span><br><span class="line">      url: &#x27;http://localhost:4000/products2&#x27;</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      console.log(&#x27;请求2成功了&#x27;, response.data)</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      console.log(&#x27;请求2失败了&#x27;, error.message, error) </span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">function cancelReq() &#123;</span><br><span class="line">  if (typeof cancel === &#x27;function&#x27;)&#123;</span><br><span class="line">    cancel(&#x27;强制取消请求&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(&#x27;没有可取消的请求&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> axios </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm错误———npm ERR! code ERESOLVE 解决方法</title>
      <link href="/archives/f0d9c826.html"/>
      <url>/archives/f0d9c826.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Vue\Project\SPH\app&gt; npm i vue-router</span><br><span class="line">npm ERR! code ERESOLVE</span><br><span class="line">npm ERR! ERESOLVE unable to resolve dependency tree</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! While resolving: app@<span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">npm ERR! Found: vue@<span class="number">2.6</span><span class="number">.14</span></span><br><span class="line">npm ERR! node_modules/vue</span><br><span class="line">npm ERR!   vue@<span class="string">&quot;^2.6.11&quot;</span> <span class="keyword">from</span> the root project</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! Could not resolve dependency:</span><br><span class="line">npm ERR! peer vue@<span class="string">&quot;^3.0.0&quot;</span> <span class="keyword">from</span> vue-router@<span class="number">4.0</span><span class="number">.12</span></span><br><span class="line">npm ERR! node_modules/vue-router</span><br><span class="line">npm ERR!   vue-router@<span class="string">&quot;*&quot;</span> <span class="keyword">from</span> the root project</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! Fix the upstream dependency conflict, or retry</span><br><span class="line">npm ERR! <span class="built_in">this</span> command <span class="keyword">with</span> --force, or --legacy-peer-deps</span><br><span class="line">npm ERR! to accept an incorrect (and potentially broken) dependency resolution.</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! See C:\Users\**\AppData\Local\npm-cache\eresolve-report.txt <span class="keyword">for</span> a full report.        </span><br><span class="line"></span><br><span class="line">npm ERR! A complete log <span class="keyword">of</span> <span class="built_in">this</span> run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     C:\Users\**\AppData\Local\npm-cache\_logs\<span class="number">2022</span>-<span class="number">02</span>-17T09_55_46_246Z-debug.log</span><br></pre></td></tr></table></figure><p>在安装组件的时候出现以上问题，是npm版本问题报错</p><p>解决方法：在命令后面加上  –legacy-peer-deps</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xxx --legacy-peer-deps</span><br></pre></td></tr></table></figure><p>如图：</p><p><img src="https://hawkingl.cn/BlogPic/image-20220217210639346.png" alt="image-20220217210639346"></p><p><img src="https://hawkingl.cn/BlogPic/image-20220217210719220.png" alt="image-20220217210719220"></p>]]></content>
      
      
      <categories>
          
          <category> node </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm错误 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3学习笔记</title>
      <link href="/archives/879455de.html"/>
      <url>/archives/879455de.html</url>
      
        <content type="html"><![CDATA[<h1 id="Vue3快速上手"><a href="#Vue3快速上手" class="headerlink" title="Vue3快速上手"></a>Vue3快速上手</h1><img src="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png" style="width:200px" /><h2 id="1-Vue3简介"><a href="#1-Vue3简介" class="headerlink" title="1.Vue3简介"></a>1.Vue3简介</h2><ul><li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li><li>耗时2年多、<a href="https://github.com/vuejs/vue-next/graphs/commit-activity">2600+次提交</a>、<a href="https://github.com/vuejs/rfcs/tree/master/active-rfcs">30+个RFC</a>、<a href="https://github.com/vuejs/vue-next/pulls?q=is:pr+is:merged+-author:app/dependabot-preview+">600+次PR</a>、<a href="https://github.com/vuejs/vue-next/graphs/contributors">99位贡献者</a> </li><li>github上的tags地址：<a href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li></ul><h2 id="2-Vue3带来了什么"><a href="#2-Vue3带来了什么" class="headerlink" title="2.Vue3带来了什么"></a>2.Vue3带来了什么</h2><h3 id="1-性能的提升"><a href="#1-性能的提升" class="headerlink" title="1.性能的提升"></a>1.性能的提升</h3><ul><li><p>打包大小减少41%</p></li><li><p>初次渲染快55%, 更新渲染快133%</p></li><li><p>内存减少54%</p><p>……</p></li></ul><h3 id="2-源码的升级"><a href="#2-源码的升级" class="headerlink" title="2.源码的升级"></a>2.源码的升级</h3><ul><li><p>使用Proxy代替defineProperty实现响应式</p></li><li><p>重写虚拟DOM的实现和Tree-Shaking</p><p>……</p></li></ul><h3 id="3-拥抱TypeScript"><a href="#3-拥抱TypeScript" class="headerlink" title="3.拥抱TypeScript"></a>3.拥抱TypeScript</h3><ul><li>Vue3可以更好的支持TypeScript</li></ul><h3 id="4-新的特性"><a href="#4-新的特性" class="headerlink" title="4.新的特性"></a>4.新的特性</h3><ol><li><p>Composition API（组合API）</p><ul><li>setup配置</li><li>ref与reactive</li><li>watch与watchEffect</li><li>provide与inject</li><li>……</li></ul></li><li><p>新的内置组件</p><ul><li>Fragment </li><li>Teleport</li><li>Suspense</li></ul></li><li><p>其他改变</p><ul><li>新的生命周期钩子</li><li>data 选项应始终被声明为一个函数</li><li>移除keyCode支持作为 v-on 的修饰符</li><li>……</li></ul></li></ol><h1 id="一、创建Vue3-0工程"><a href="#一、创建Vue3-0工程" class="headerlink" title="一、创建Vue3.0工程"></a>一、创建Vue3.0工程</h1><h2 id="1-使用-vue-cli-创建"><a href="#1-使用-vue-cli-创建" class="headerlink" title="1.使用 vue-cli 创建"></a>1.使用 vue-cli 创建</h2><p>官方文档：<a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span><br><span class="line">vue --version</span><br><span class="line"><span class="comment">## 安装或者升级你的@vue/cli</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"><span class="comment">## 创建</span></span><br><span class="line">vue create vue_test</span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line"><span class="built_in">cd</span> vue_test</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure><h2 id="2-使用-vite-创建"><a href="#2-使用-vite-创建" class="headerlink" title="2.使用 vite 创建"></a>2.使用 vite 创建</h2><p>官方文档：<a href="https://v3.cn.vuejs.org/guide/installation.html#vite">https://v3.cn.vuejs.org/guide/installation.html#vite</a></p><p>vite官网：<a href="https://vitejs.cn/">https://vitejs.cn</a></p><ul><li>什么是vite？—— 新一代前端构建工具。</li><li>优势如下：<ul><li>开发环境中，无需打包操作，可快速的冷启动。</li><li>轻量快速的热重载（HMR）。</li><li>真正的按需编译，不再等待整个应用编译完成。</li></ul></li><li>传统构建 与 vite构建对比图</li></ul><p><img src="https://cn.vitejs.dev/assets/bundler.37740380.png" style="width:500px;height:280px;float:left" /><img src="https://cn.vitejs.dev/assets/esm.3070012d.png" style="width:480px;height:280px" /></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建工程</span></span><br><span class="line">npm init vite-app &lt;project-name&gt;</span><br><span class="line"><span class="comment">## 进入工程目录</span></span><br><span class="line"><span class="built_in">cd</span> &lt;project-name&gt;</span><br><span class="line"><span class="comment">## 安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"><span class="comment">## 运行</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h1 id="二、常用-Composition-API"><a href="#二、常用-Composition-API" class="headerlink" title="二、常用 Composition API"></a>二、常用 Composition API</h1><p>官方文档: <a href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html">https://v3.cn.vuejs.org/guide/composition-api-introduction.html</a></p><h2 id="1-拉开序幕的setup"><a href="#1-拉开序幕的setup" class="headerlink" title="1.拉开序幕的setup"></a>1.拉开序幕的setup</h2><ol><li>理解：Vue3.0中一个新的配置项，值为一个函数。</li><li>setup是所有<strong style="color:#DD5145">Composition API（组合API）</strong><i style="color:gray;font-weight:bold">“ 表演的舞台 ”</i>。</li><li>组件中所用到的：数据、方法等等，均要配置在setup中。</li><li>setup函数的两种返回值：<ol><li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li><li><span style="color:#aad">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li></ol></li><li>注意点：<ol><li>尽量不要与Vue2.x配置混用<ul><li>Vue2.x配置（data、methos、computed…）中<strong style="color:#DD5145">可以访问到</strong>setup中的属性、方法。</li><li>但在setup中<strong style="color:#DD5145">不能访问到</strong>Vue2.x配置（data、methos、computed…）。</li><li>如果有重名, setup优先。</li></ul></li><li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li></ol></li></ol><h2 id="2-ref函数"><a href="#2-ref函数" class="headerlink" title="2.ref函数"></a>2.ref函数</h2><ul><li>作用: 定义一个响应式的数据</li><li>语法: <code>const xxx = ref(initValue)</code> <ul><li>创建一个包含响应式数据的<strong style="color:#DD5145">引用对象（reference对象，简称ref对象）</strong>。</li><li>JS中操作数据： <code>xxx.value</code></li><li>模板中读取数据: 不需要.value，直接：<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li></ul></li><li>备注：<ul><li>接收的数据可以是：基本类型、也可以是对象类型。</li><li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li><li>对象类型的数据：内部 <i style="color:gray;font-weight:bold">“ 求助 ”</i> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li></ul></li></ul><h2 id="3-reactive函数"><a href="#3-reactive函数" class="headerlink" title="3.reactive函数"></a>3.reactive函数</h2><ul><li>作用: 定义一个<strong style="color:#DD5145">对象类型</strong>的响应式数据（基本类型不要用它，要用<code>ref</code>函数）</li><li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style="color:#DD5145">代理对象（Proxy的实例对象，简称proxy对象）</strong></li><li>reactive定义的响应式数据是“深层次的”。</li><li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li></ul><h2 id="4-Vue3-0中的响应式原理"><a href="#4-Vue3-0中的响应式原理" class="headerlink" title="4.Vue3.0中的响应式原理"></a>4.Vue3.0中的响应式原理</h2><h3 id="vue2-x的响应式"><a href="#vue2-x的响应式" class="headerlink" title="vue2.x的响应式"></a>vue2.x的响应式</h3><ul><li><p>实现原理：</p><ul><li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</p></li><li><p>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(data, <span class="string">&#x27;count&#x27;</span>, &#123;</span><br><span class="line">    get () &#123;&#125;, </span><br><span class="line">    set () &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>存在问题：</p><ul><li>新增属性、删除属性, 界面不会更新。</li><li>直接通过下标修改数组, 界面不会自动更新。</li></ul></li></ul><h3 id="Vue3-0的响应式"><a href="#Vue3-0的响应式" class="headerlink" title="Vue3.0的响应式"></a>Vue3.0的响应式</h3><ul><li>实现原理: <ul><li>通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。</li><li>通过Reflect（反射）:  对源对象的属性进行操作。</li><li>MDN文档中描述的Proxy与Reflect：<ul><li><p>Proxy：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p></li><li><p>Reflect：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Proxy</span>(data, &#123;</span><br><span class="line"><span class="comment">// 拦截读取属性值</span></span><br><span class="line">    get (target, prop) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 拦截设置属性值或添加新属性</span></span><br><span class="line">    set (target, prop, value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, prop, value)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 拦截删除属性</span></span><br><span class="line">    deleteProperty (target, prop) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.deleteProperty(target, prop)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">proxy.name = <span class="string">&#x27;tom&#x27;</span>   </span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h2 id="5-reactive对比ref"><a href="#5-reactive对比ref" class="headerlink" title="5.reactive对比ref"></a>5.reactive对比ref</h2><ul><li>从定义数据角度对比：<ul><li> ref用来定义：<strong style="color:#DD5145">基本类型数据</strong>。</li><li> reactive用来定义：<strong style="color:#DD5145">对象（或数组）类型数据</strong>。</li><li> 备注：ref也可以用来定义<strong style="color:#DD5145">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style="color:#DD5145">代理对象</strong>。</li></ul></li><li>从原理角度对比：<ul><li> ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li><li> reactive通过使用<strong style="color:#DD5145">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style="color:#DD5145">Reflect</strong>操作<strong style="color:orange">源对象</strong>内部的数据。</li></ul></li><li>从使用角度对比：<ul><li> ref定义的数据：操作数据<strong style="color:#DD5145">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style="color:#DD5145">不需要</strong><code>.value</code>。</li><li> reactive定义的数据：操作数据与读取数据：<strong style="color:#DD5145">均不需要</strong><code>.value</code>。</li></ul></li></ul><h2 id="6-setup的两个注意点"><a href="#6-setup的两个注意点" class="headerlink" title="6.setup的两个注意点"></a>6.setup的两个注意点</h2><ul><li>setup执行的时机<ul><li>在beforeCreate之前执行一次，this是undefined。</li></ul></li><li>setup的参数<ul><li>props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</li><li>context：上下文对象<ul><li>attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 <code>this.$attrs</code>。</li><li>slots: 收到的插槽内容, 相当于 <code>this.$slots</code>。</li><li>emit: 分发自定义事件的函数, 相当于 <code>this.$emit</code>。</li></ul></li></ul></li></ul><h2 id="7-计算属性与监视"><a href="#7-计算属性与监视" class="headerlink" title="7.计算属性与监视"></a>7.计算属性与监视</h2><h3 id="1-computed函数"><a href="#1-computed函数" class="headerlink" title="1.computed函数"></a>1.computed函数</h3><ul><li><p>与Vue2.x中computed配置功能一致</p></li><li><p>写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;computed&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line"><span class="comment">//计算属性——简写</span></span><br><span class="line">    <span class="keyword">let</span> fullName = computed(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person.firstName + <span class="string">&#x27;-&#x27;</span> + person.lastName</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//计算属性——完整</span></span><br><span class="line">    <span class="keyword">let</span> fullName = computed(&#123;</span><br><span class="line">        <span class="function"><span class="title">get</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> person.firstName + <span class="string">&#x27;-&#x27;</span> + person.lastName</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">set</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> nameArr = value.split(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            person.firstName = nameArr[<span class="number">0</span>]</span><br><span class="line">            person.lastName = nameArr[<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-watch函数"><a href="#2-watch函数" class="headerlink" title="2.watch函数"></a>2.watch函数</h3><ul><li><p>与Vue2.x中watch配置功能一致</p></li><li><p>两个小“坑”：</p><ul><li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li><li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//情况一：监视ref定义的响应式数据</span></span><br><span class="line">watch(sum,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;sum变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//情况二：监视多个ref定义的响应式数据</span></span><br><span class="line">watch([sum,msg],<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;sum或msg变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 情况三：监视reactive定义的响应式数据</span></span><br><span class="line"><span class="comment">若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span></span><br><span class="line"><span class="comment">若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">watch(person,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;person变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">false</span>&#125;) <span class="comment">//此处的deep配置不再奏效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//情况四：监视reactive定义的响应式数据中的某个属性</span></span><br><span class="line">watch(<span class="function">()=&gt;</span>person.job,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">true</span>&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">//情况五：监视reactive定义的响应式数据中的某些属性</span></span><br><span class="line">watch([<span class="function">()=&gt;</span>person.job,<span class="function">()=&gt;</span>person.name],<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊情况</span></span><br><span class="line">watch(<span class="function">()=&gt;</span>person.job,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">deep</span>:<span class="literal">true</span>&#125;) <span class="comment">//此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-watchEffect函数"><a href="#3-watchEffect函数" class="headerlink" title="3.watchEffect函数"></a>3.watchEffect函数</h3><ul><li><p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p></li><li><p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</p></li><li><p>watchEffect有点像computed：</p><ul><li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li><li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span></span><br><span class="line">watchEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> x1 = sum.value</span><br><span class="line">    <span class="keyword">const</span> x2 = person.age</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h2 id="8-生命周期"><a href="#8-生命周期" class="headerlink" title="8.生命周期"></a>8.生命周期</h2><div style="border:1px solid black;width:300px;float:left;margin-right:20px;"><strong>vue2.x的生命周期</strong><img src="https://cn.vuejs.org/images/lifecycle.png" alt="lifecycle_2" style="zoom:33%;width:1200px" /></div><div style="border:1px solid black;width:510px;height:985px;float:left"><strong>vue3.0的生命周期</strong><img src="https://v3.cn.vuejs.org/images/lifecycle.svg" alt="lifecycle_2" style="zoom:33%;width:2000px" /></div><ul><li>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：<ul><li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li><li><code>destroyed</code>改名为 <code>unmounted</code></li></ul></li><li>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：<ul><li><code>beforeCreate</code>===&gt;<code>setup()</code></li><li><code>created</code>=======&gt;<code>setup()</code></li><li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li><li><code>mounted</code>=======&gt;<code>onMounted</code></li><li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li><li><code>updated</code> =======&gt;<code>onUpdated</code></li><li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li><li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li></ul></li></ul><h2 id="9-自定义hook函数"><a href="#9-自定义hook函数" class="headerlink" title="9.自定义hook函数"></a>9.自定义hook函数</h2><ul><li><p>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</p></li><li><p>类似于vue2.x中的mixin。</p></li><li><p>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</p></li></ul><h2 id="10-toRef"><a href="#10-toRef" class="headerlink" title="10.toRef"></a>10.toRef</h2><ul><li>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</li><li>语法：<code>const name = toRef(person,&#39;name&#39;)</code></li><li>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</li></ul><ul><li>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code></li></ul><h1 id="三、其它-Composition-API"><a href="#三、其它-Composition-API" class="headerlink" title="三、其它 Composition API"></a>三、其它 Composition API</h1><h2 id="1-shallowReactive-与-shallowRef"><a href="#1-shallowReactive-与-shallowRef" class="headerlink" title="1.shallowReactive 与 shallowRef"></a>1.shallowReactive 与 shallowRef</h2><ul><li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p></li><li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p></li><li><p>什么时候使用?</p><ul><li> 如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive。</li><li> 如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 ===&gt; shallowRef。</li></ul></li></ul><h2 id="2-readonly-与-shallowReadonly"><a href="#2-readonly-与-shallowReadonly" class="headerlink" title="2.readonly 与 shallowReadonly"></a>2.readonly 与 shallowReadonly</h2><ul><li>readonly: 让一个响应式数据变为只读的（深只读）。</li><li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。</li><li>应用场景: 不希望数据被修改时。</li></ul><h2 id="3-toRaw-与-markRaw"><a href="#3-toRaw-与-markRaw" class="headerlink" title="3.toRaw 与 markRaw"></a>3.toRaw 与 markRaw</h2><ul><li>toRaw：<ul><li>作用：将一个由<code>reactive</code>生成的<strong style="color:orange">响应式对象</strong>转为<strong style="color:orange">普通对象</strong>。</li><li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li></ul></li><li>markRaw：<ul><li>作用：标记一个对象，使其永远不会再成为响应式对象。</li><li>应用场景:<ol><li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li><li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li></ol></li></ul></li></ul><h2 id="4-customRef"><a href="#4-customRef" class="headerlink" title="4.customRef"></a>4.customRef</h2><ul><li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p></li><li><p>实现防抖效果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;</span><br><span class="line">&lt;h3&gt;&#123;&#123;keyword&#125;&#125;&lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;ref,customRef&#125; from &#x27;vue&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">name:&#x27;Demo&#x27;,</span><br><span class="line">setup()&#123;</span><br><span class="line">// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span><br><span class="line">//自定义一个myRef</span><br><span class="line">function myRef(value,delay)&#123;</span><br><span class="line">let timer</span><br><span class="line">//通过customRef去实现自定义</span><br><span class="line">return customRef((track,trigger)=&gt;&#123;</span><br><span class="line">return&#123;</span><br><span class="line">get()&#123;</span><br><span class="line">track() //告诉Vue这个value值是需要被“追踪”的</span><br><span class="line">return value</span><br><span class="line">&#125;,</span><br><span class="line">set(newValue)&#123;</span><br><span class="line">clearTimeout(timer)</span><br><span class="line">timer = setTimeout(()=&gt;&#123;</span><br><span class="line">value = newValue</span><br><span class="line">trigger() //告诉Vue去更新界面</span><br><span class="line">&#125;,delay)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">let keyword = myRef(&#x27;hello&#x27;,500) //使用程序员自定义的ref</span><br><span class="line">return &#123;</span><br><span class="line">keyword</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-provide-与-inject"><a href="#5-provide-与-inject" class="headerlink" title="5.provide 与 inject"></a>5.provide 与 inject</h2><img src="https://v3.cn.vuejs.org/images/components_provide.png" style="width:300px" /><ul><li><p>作用：实现<strong style="color:#DD5145">祖与后代组件间</strong>通信</p></li><li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p></li><li><p>具体写法：</p><ol><li><p>祖组件中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">let</span> car = reactive(&#123;<span class="attr">name</span>:<span class="string">&#x27;奔驰&#x27;</span>,<span class="attr">price</span>:<span class="string">&#x27;40万&#x27;</span>&#125;)</span><br><span class="line">    provide(<span class="string">&#x27;car&#x27;</span>,car)</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>后代组件中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params">props,context</span>)</span>&#123;</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">const</span> car = inject(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;car&#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="6-响应式数据的判断"><a href="#6-响应式数据的判断" class="headerlink" title="6.响应式数据的判断"></a>6.响应式数据的判断</h2><ul><li>isRef: 检查一个值是否为一个 ref 对象</li><li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li><li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li><li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li></ul><h1 id="四、Composition-API-的优势"><a href="#四、Composition-API-的优势" class="headerlink" title="四、Composition API 的优势"></a>四、Composition API 的优势</h1><h2 id="1-Options-API-存在的问题"><a href="#1-Options-API-存在的问题" class="headerlink" title="1.Options API 存在的问题"></a>1.Options API 存在的问题</h2><p>使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。</p><div style="width:600px;height:370px;overflow:hidden;float:left">    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image" style="width:600px;float:left" /></div><div style="width:300px;height:370px;overflow:hidden;float:left">    <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;width:560px;left" /> </div><h2 id="2-Composition-API-的优势"><a href="#2-Composition-API-的优势" class="headerlink" title="2.Composition API 的优势"></a>2.Composition API 的优势</h2><p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p><div style="width:500px;height:340px;overflow:hidden;float:left">    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image"style="height:360px"/></div><div style="width:430px;height:340px;overflow:hidden;float:left">    <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image"style="height:360px"/></div><h1 id="五、新的组件"><a href="#五、新的组件" class="headerlink" title="五、新的组件"></a>五、新的组件</h1><h2 id="1-Fragment"><a href="#1-Fragment" class="headerlink" title="1.Fragment"></a>1.Fragment</h2><ul><li>在Vue2中: 组件必须有一个根标签</li><li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li><li>好处: 减少标签层级, 减小内存占用</li></ul><h2 id="2-Teleport"><a href="#2-Teleport" class="headerlink" title="2.Teleport"></a>2.Teleport</h2><ul><li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style="color:#DD5145">组件html结构</strong>移动到指定位置的技术。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;移动位置&quot;&gt;</span><br><span class="line">&lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;</span><br><span class="line">&lt;div class=&quot;dialog&quot;&gt;</span><br><span class="line">&lt;h3&gt;我是一个弹窗&lt;/h3&gt;</span><br><span class="line">&lt;button @click=&quot;isShow = false&quot;&gt;关闭弹窗&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-Suspense"><a href="#3-Suspense" class="headerlink" title="3.Suspense"></a>3.Suspense</h2><ul><li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p></li><li><p>使用步骤：</p><ul><li><p>异步引入组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineAsyncComponent&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Child = defineAsyncComponent(<span class="function">()=&gt;</span><span class="keyword">import</span>(<span class="string">&#x27;./components/Child.vue&#x27;</span>))</span><br></pre></td></tr></table></figure></li><li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">&lt;h3&gt;我是App组件&lt;/h3&gt;</span><br><span class="line">&lt;Suspense&gt;</span><br><span class="line">&lt;template v-slot:default&gt;</span><br><span class="line">&lt;Child/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;template v-slot:fallback&gt;</span><br><span class="line">&lt;h3&gt;加载中.....&lt;/h3&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;/Suspense&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="六、其他"><a href="#六、其他" class="headerlink" title="六、其他"></a>六、其他</h1><h2 id="1-全局API的转移"><a href="#1-全局API的转移" class="headerlink" title="1.全局API的转移"></a>1.全局API的转移</h2><ul><li><p>Vue 2.x 有许多全局 API 和配置。</p><ul><li><p>例如：注册全局组件、注册全局指令等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册全局组件</span></span><br><span class="line">Vue.component(<span class="string">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册全局指令</span></span><br><span class="line">Vue.directive(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="function"><span class="params">el</span> =&gt;</span> el.focus()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Vue3.0中对这些API做出了调整：</p><ul><li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p><table><thead><tr><th>2.x 全局 API（<code>Vue</code>）</th><th>3.x 实例 API (<code>app</code>)</th></tr></thead><tbody><tr><td>Vue.config.xxxx</td><td>app.config.xxxx</td></tr><tr><td>Vue.config.productionTip</td><td><strong style="color:#DD5145">移除</strong></td></tr><tr><td>Vue.component</td><td>app.component</td></tr><tr><td>Vue.directive</td><td>app.directive</td></tr><tr><td>Vue.mixin</td><td>app.mixin</td></tr><tr><td>Vue.use</td><td>app.use</td></tr><tr><td>Vue.prototype</td><td>app.config.globalProperties</td></tr></tbody></table></li></ul></li></ul><h2 id="2-其他改变"><a href="#2-其他改变" class="headerlink" title="2.其他改变"></a>2.其他改变</h2><ul><li><p>data选项应始终被声明为一个函数。</p></li><li><p>过度类名的更改：</p><ul><li><p>Vue2.x写法</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-leave</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Vue3.x写法</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-enter-from</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.v-leave-from</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong style="color:#DD5145">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p></li><li><p><strong style="color:#DD5145">移除</strong><code>v-on.native</code>修饰符</p><ul><li><p>父组件中绑定事件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;my-component</span><br><span class="line">  v-on:close=&quot;handleComponentEvent&quot;</span><br><span class="line">  v-on:click=&quot;handleNativeClickEvent&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></li><li><p>子组件中声明自定义事件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    emits: [&#x27;close&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong style="color:#DD5145">移除</strong>过滤器（filter）</p><blockquote><p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p></blockquote></li><li><p>……；/</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/archives/0.html"/>
      <url>/archives/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="脚手架文件结构"><a href="#脚手架文件结构" class="headerlink" title="脚手架文件结构"></a>脚手架文件结构</h2><pre><code>├── node_modules ├── public│   ├── favicon.ico: 页签图标│   └── index.html: 主页面├── src│   ├── assets: 存放静态资源│   │   └── logo.png│   │── component: 存放组件│   │   └── HelloWorld.vue│   │── App.vue: 汇总所有组件│   │── main.js: 入口文件├── .gitignore: git版本管制忽略的配置├── babel.config.js: babel的配置文件├── package.json: 应用包配置文件 ├── README.md: 应用描述文件├── package-lock.json：包版本控制文件</code></pre><h2 id="关于不同版本的Vue"><a href="#关于不同版本的Vue" class="headerlink" title="关于不同版本的Vue"></a>关于不同版本的Vue</h2><ol><li>vue.js与vue.runtime.xxx.js的区别：<ol><li>vue.js是完整版的Vue，包含：核心功能 + 模板解析器。</li><li>vue.runtime.xxx.js是运行版的Vue，只包含：核心功能；没有模板解析器。</li></ol></li><li>因为vue.runtime.xxx.js没有模板解析器，所以不能使用template这个配置项，需要使用render函数接收到的createElement函数去指定具体内容。</li></ol><h2 id="vue-config-js配置文件"><a href="#vue-config-js配置文件" class="headerlink" title="vue.config.js配置文件"></a>vue.config.js配置文件</h2><ol><li>使用vue inspect &gt; output.js可以查看到Vue脚手架的默认配置。</li><li>使用vue.config.js可以对脚手架进行个性化定制，详情见：<a href="https://cli.vuejs.org/zh">https://cli.vuejs.org/zh</a></li></ol><h2 id="ref属性"><a href="#ref属性" class="headerlink" title="ref属性"></a>ref属性</h2><ol><li>被用来给元素或子组件注册引用信息（id的替代者）</li><li>应用在html标签上获取的是真实DOM元素，应用在组件标签上是组件实例对象（vc）</li><li>使用方式：<ol><li>打标识：<code>&lt;h1 ref=&quot;xxx&quot;&gt;.....&lt;/h1&gt;</code> 或 <code>&lt;School ref=&quot;xxx&quot;&gt;&lt;/School&gt;</code></li><li>获取：<code>this.$refs.xxx</code></li></ol></li></ol><h2 id="props配置项"><a href="#props配置项" class="headerlink" title="props配置项"></a>props配置项</h2><ol><li><p>功能：让组件接收外部传过来的数据</p></li><li><p>传递数据：<code>&lt;Demo name=&quot;xxx&quot;/&gt;</code></p></li><li><p>接收数据：</p><ol><li><p>第一种方式（只接收）：<code>props:[&#39;name&#39;] </code></p></li><li><p>第二种方式（限制类型）：<code>props:&#123;name:String&#125;</code></p></li><li><p>第三种方式（限制类型、限制必要性、指定默认值）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">props:&#123;</span><br><span class="line"><span class="attr">name</span>:&#123;</span><br><span class="line"><span class="attr">type</span>:<span class="built_in">String</span>, <span class="comment">//类型</span></span><br><span class="line"><span class="attr">required</span>:<span class="literal">true</span>, <span class="comment">//必要性</span></span><br><span class="line"><span class="attr">default</span>:<span class="string">&#x27;老王&#x27;</span> <span class="comment">//默认值</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>备注：props是只读的，Vue底层会监测你对props的修改，如果进行了修改，就会发出警告，若业务需求确实需要修改，那么请复制props的内容到data中一份，然后去修改data中的数据。</p></blockquote></li></ol><h2 id="mixin-混入"><a href="#mixin-混入" class="headerlink" title="mixin(混入)"></a>mixin(混入)</h2><ol><li><p>功能：可以把多个组件共用的配置提取成一个混入对象</p></li><li><p>使用方式：</p><p>第一步定义混合：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    data()&#123;....&#125;,</span><br><span class="line">    methods:&#123;....&#125;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二步使用混入：</p><p>​    全局混入：<code>Vue.mixin(xxx)</code><br>​    局部混入：<code>mixins:[&#39;xxx&#39;]    </code></p></li></ol><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ol><li><p>功能：用于增强Vue</p></li><li><p>本质：包含install方法的一个对象，install的第一个参数是Vue，第二个以后的参数是插件使用者传递的数据。</p></li><li><p>定义插件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">对象.install = <span class="function"><span class="keyword">function</span> (<span class="params">Vue, options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 添加全局过滤器</span></span><br><span class="line">    Vue.filter(....)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加全局指令</span></span><br><span class="line">    Vue.directive(....)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 配置全局混入(合)</span></span><br><span class="line">    Vue.mixin(....)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 添加实例方法</span></span><br><span class="line">    Vue.prototype.$myMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;...&#125;</span><br><span class="line">    Vue.prototype.$myProperty = xxxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用插件：<code>Vue.use()</code></p></li></ol><h2 id="scoped样式"><a href="#scoped样式" class="headerlink" title="scoped样式"></a>scoped样式</h2><ol><li>作用：让样式在局部生效，防止冲突。</li><li>写法：<code>&lt;style scoped&gt;</code></li></ol><h2 id="总结TodoList案例"><a href="#总结TodoList案例" class="headerlink" title="总结TodoList案例"></a>总结TodoList案例</h2><ol><li><p>组件化编码流程：</p><p>​    (1).拆分静态组件：组件要按照功能点拆分，命名不要与html元素冲突。</p><p>​    (2).实现动态组件：考虑好数据的存放位置，数据是一个组件在用，还是一些组件在用：</p><p>​            1).一个组件在用：放在组件自身即可。</p><p>​            2). 一些组件在用：放在他们共同的父组件上（<span style="color:red">状态提升</span>）。</p><p>​    (3).实现交互：从绑定事件开始。</p></li><li><p>props适用于：</p><p>​    (1).父组件 ==&gt; 子组件 通信</p><p>​    (2).子组件 ==&gt; 父组件 通信（要求父先给子一个函数）</p></li><li><p>使用v-model时要切记：v-model绑定的值不能是props传过来的值，因为props是不可以修改的！</p></li><li><p>props传过来的若是对象类型的值，修改对象中的属性时Vue不会报错，但不推荐这样做。</p></li></ol><h2 id="webStorage"><a href="#webStorage" class="headerlink" title="webStorage"></a>webStorage</h2><ol><li><p>存储内容大小一般支持5MB左右（不同浏览器可能还不一样）</p></li><li><p>浏览器端通过 Window.sessionStorage 和 Window.localStorage 属性来实现本地存储机制。</p></li><li><p>相关API：</p><ol><li><p><code>xxxxxStorage.setItem(&#39;key&#39;, &#39;value&#39;);</code></p><pre><code>该方法接受一个键和值作为参数，会把键值对添加到存储中，如果键名存在，则更新其对应的值。</code></pre></li><li><p><code>xxxxxStorage.getItem(&#39;person&#39;);</code></p><p>​        该方法接受一个键名作为参数，返回键名对应的值。</p></li><li><p><code>xxxxxStorage.removeItem(&#39;key&#39;);</code></p><p>​        该方法接受一个键名作为参数，并把该键名从存储中删除。</p></li><li><p><code> xxxxxStorage.clear()</code></p><p>​        该方法会清空存储中的所有数据。</p></li></ol></li><li><p>备注：</p><ol><li>SessionStorage存储的内容会随着浏览器窗口关闭而消失。</li><li>LocalStorage存储的内容，需要手动清除才会消失。</li><li><code>xxxxxStorage.getItem(xxx)</code>如果xxx对应的value获取不到，那么getItem的返回值是null。</li><li><code>JSON.parse(null)</code>的结果依然是null。</li></ol></li></ol><h2 id="组件的自定义事件"><a href="#组件的自定义事件" class="headerlink" title="组件的自定义事件"></a>组件的自定义事件</h2><ol><li><p>一种组件间通信的方式，适用于：<strong style="color:red">子组件 ===&gt; 父组件</strong></p></li><li><p>使用场景：A是父组件，B是子组件，B想给A传数据，那么就要在A中给B绑定自定义事件（<span style="color:red">事件的回调在A中</span>）。</p></li><li><p>绑定自定义事件：</p><ol><li><p>第一种方式，在父组件中：<code>&lt;Demo @atguigu=&quot;test&quot;/&gt;</code>  或 <code>&lt;Demo v-on:atguigu=&quot;test&quot;/&gt;</code></p></li><li><p>第二种方式，在父组件中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Demo ref=<span class="string">&quot;demo&quot;</span>/&gt;</span><br><span class="line">......</span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">this</span>.$refs.xxx.$on(<span class="string">&#x27;atguigu&#x27;</span>,<span class="built_in">this</span>.test)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>若想让自定义事件只能触发一次，可以使用<code>once</code>修饰符，或<code>$once</code>方法。</p></li></ol></li><li><p>触发自定义事件：<code>this.$emit(&#39;atguigu&#39;,数据)</code>        </p></li><li><p>解绑自定义事件<code>this.$off(&#39;atguigu&#39;)</code></p></li><li><p>组件上也可以绑定原生DOM事件，需要使用<code>native</code>修饰符。</p></li><li><p>注意：通过<code>this.$refs.xxx.$on(&#39;atguigu&#39;,回调)</code>绑定自定义事件时，回调<span style="color:red">要么配置在methods中</span>，<span style="color:red">要么用箭头函数</span>，否则this指向会出问题！</p></li></ol><h2 id="全局事件总线（GlobalEventBus）"><a href="#全局事件总线（GlobalEventBus）" class="headerlink" title="全局事件总线（GlobalEventBus）"></a>全局事件总线（GlobalEventBus）</h2><ol><li><p>一种组件间通信的方式，适用于<span style="color:red">任意组件间通信</span>。</p></li><li><p>安装全局事件总线：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">......</span><br><span class="line"><span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">Vue.prototype.$bus = <span class="built_in">this</span> <span class="comment">//安装全局事件总线，$bus就是当前应用的vm</span></span><br><span class="line">&#125;,</span><br><span class="line">    ......</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure></li><li><p>使用事件总线：</p><ol><li><p>接收数据：A组件想接收数据，则在A组件中给$bus绑定自定义事件，事件的<span style="color:red">回调留在A组件自身。</span></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">methods</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">demo</span>(<span class="params">data</span>)</span>&#123;......&#125;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$bus.$on(<span class="string">&#x27;xxxx&#x27;</span>,<span class="built_in">this</span>.demo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>提供数据：<code>this.$bus.$emit(&#39;xxxx&#39;,数据)</code></p></li></ol></li><li><p>最好在beforeDestroy钩子中，用$off去解绑<span style="color:red">当前组件所用到的</span>事件。</p></li></ol><h2 id="消息订阅与发布（pubsub）"><a href="#消息订阅与发布（pubsub）" class="headerlink" title="消息订阅与发布（pubsub）"></a>消息订阅与发布（pubsub）</h2><ol><li><p>一种组件间通信的方式，适用于<span style="color:red">任意组件间通信</span>。</p></li><li><p>使用步骤：</p><ol><li><p>安装pubsub：<code>npm i pubsub-js</code></p></li><li><p>引入: <code>import pubsub from &#39;pubsub-js&#39;</code></p></li><li><p>接收数据：A组件想接收数据，则在A组件中订阅消息，订阅的<span style="color:red">回调留在A组件自身。</span></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">methods</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">demo</span>(<span class="params">data</span>)</span>&#123;......&#125;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.pid = pubsub.subscribe(<span class="string">&#x27;xxx&#x27;</span>,<span class="built_in">this</span>.demo) <span class="comment">//订阅消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>提供数据：<code>pubsub.publish(&#39;xxx&#39;,数据)</code></p></li><li><p>最好在beforeDestroy钩子中，用<code>PubSub.unsubscribe(pid)</code>去<span style="color:red">取消订阅。</span></p></li></ol></li></ol><h2 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h2><ol><li>语法：<code>this.$nextTick(回调函数)</code></li><li>作用：在下一次 DOM 更新结束后执行其指定的回调。</li><li>什么时候用：当改变数据后，要基于更新后的新DOM进行某些操作时，要在nextTick所指定的回调函数中执行。</li></ol><h2 id="Vue封装的过度与动画"><a href="#Vue封装的过度与动画" class="headerlink" title="Vue封装的过度与动画"></a>Vue封装的过度与动画</h2><ol><li><p>作用：在插入、更新或移除 DOM元素时，在合适的时候给元素添加样式类名。</p></li><li><p>写法：</p><ol><li><p>准备好样式：</p><ul><li>元素进入的样式：<ol><li>v-enter：进入的起点</li><li>v-enter-active：进入过程中</li><li>v-enter-to：进入的终点</li></ol></li><li>元素离开的样式：<ol><li>v-leave：离开的起点</li><li>v-leave-active：离开过程中</li><li>v-leave-to：离开的终点</li></ol></li></ul></li><li><p>使用<code>&lt;transition&gt;</code>包裹要过度的元素，并配置name属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition name=&quot;hello&quot;&gt;</span><br><span class="line">&lt;h1 v-show=&quot;isShow&quot;&gt;你好啊！&lt;/h1&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure></li><li><p>备注：若有多个元素需要过度，则需要使用：<code>&lt;transition-group&gt;</code>，且每个元素都要指定<code>key</code>值。</p></li></ol></li></ol><h2 id="vue脚手架配置代理"><a href="#vue脚手架配置代理" class="headerlink" title="vue脚手架配置代理"></a>vue脚手架配置代理</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>​    在vue.config.js中添加如下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devServer:&#123;</span><br><span class="line">  <span class="attr">proxy</span>:<span class="string">&quot;http://localhost:5000&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><ol><li>优点：配置简单，请求资源时直接发给前端（8080）即可。</li><li>缺点：不能配置多个代理，不能灵活的控制请求是否走代理。</li><li>工作方式：若按照上述配置代理，当请求了前端不存在的资源时，那么该请求会转发给服务器 （优先匹配前端资源）</li></ol><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>​    编写vue.config.js配置具体代理规则：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">      <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api1&#x27;</span>: &#123;<span class="comment">// 匹配所有以 &#x27;/api1&#x27;开头的请求路径</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:5000&#x27;</span>,<span class="comment">// 代理目标的基础路径</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;<span class="string">&#x27;^/api1&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;/api2&#x27;</span>: &#123;<span class="comment">// 匹配所有以 &#x27;/api2&#x27;开头的请求路径</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:5001&#x27;</span>,<span class="comment">// 代理目标的基础路径</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;<span class="string">&#x27;^/api2&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   changeOrigin设置为true时，服务器收到的请求头中的host为：localhost:5000</span></span><br><span class="line"><span class="comment">   changeOrigin设置为false时，服务器收到的请求头中的host为：localhost:8080</span></span><br><span class="line"><span class="comment">   changeOrigin默认值为true</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>说明：</p><ol><li>优点：可以配置多个代理，且可以灵活的控制请求是否走代理。</li><li>缺点：配置略微繁琐，请求资源时必须加前缀。</li></ol><h2 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h2><ol><li><p>作用：让父组件可以向子组件指定位置插入html结构，也是一种组件间通信的方式，适用于 <strong style="color:red">父组件 ===&gt; 子组件</strong> 。</p></li><li><p>分类：默认插槽、具名插槽、作用域插槽</p></li><li><p>使用方式：</p><ol><li><p>默认插槽：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">父组件中：</span><br><span class="line">        &lt;Category&gt;</span><br><span class="line">           &lt;div&gt;html结构1&lt;/div&gt;</span><br><span class="line">        &lt;/Category&gt;</span><br><span class="line">子组件中：</span><br><span class="line">        &lt;template&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">               &lt;!-- 定义插槽 --&gt;</span><br><span class="line">               &lt;slot&gt;插槽默认内容...&lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br></pre></td></tr></table></figure></li><li><p>具名插槽：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">父组件中：</span><br><span class="line">        &lt;Category&gt;</span><br><span class="line">            &lt;template slot=&quot;center&quot;&gt;</span><br><span class="line">              &lt;div&gt;html结构1&lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">            &lt;template v-slot:footer&gt;</span><br><span class="line">               &lt;div&gt;html结构2&lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">        &lt;/Category&gt;</span><br><span class="line">子组件中：</span><br><span class="line">        &lt;template&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">               &lt;!-- 定义插槽 --&gt;</span><br><span class="line">               &lt;slot name=&quot;center&quot;&gt;插槽默认内容...&lt;/slot&gt;</span><br><span class="line">               &lt;slot name=&quot;footer&quot;&gt;插槽默认内容...&lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br></pre></td></tr></table></figure></li><li><p>作用域插槽：</p><ol><li><p>理解：<span style="color:red">数据在组件的自身，但根据数据生成的结构需要组件的使用者来决定。</span>（games数据在Category组件中，但使用数据所遍历出来的结构由App组件决定）</p></li><li><p>具体编码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">父组件中：</span><br><span class="line">&lt;Category&gt;</span><br><span class="line">&lt;template scope=&quot;scopeData&quot;&gt;</span><br><span class="line">&lt;!-- 生成的是ul列表 --&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li v-for=&quot;g in scopeData.games&quot; :key=&quot;g&quot;&gt;&#123;&#123;g&#125;&#125;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;/Category&gt;</span><br><span class="line"></span><br><span class="line">&lt;Category&gt;</span><br><span class="line">&lt;template slot-scope=&quot;scopeData&quot;&gt;</span><br><span class="line">&lt;!-- 生成的是h4标题 --&gt;</span><br><span class="line">&lt;h4 v-for=&quot;g in scopeData.games&quot; :key=&quot;g&quot;&gt;&#123;&#123;g&#125;&#125;&lt;/h4&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;/Category&gt;</span><br><span class="line">子组件中：</span><br><span class="line">        &lt;template&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;slot :games=&quot;games&quot;&gt;&lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">        &lt;script&gt;</span><br><span class="line">            export default &#123;</span><br><span class="line">                name:&#x27;Category&#x27;,</span><br><span class="line">                props:[&#x27;title&#x27;],</span><br><span class="line">                //数据在子组件自身</span><br><span class="line">                data() &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        games:[&#x27;红色警戒&#x27;,&#x27;穿越火线&#x27;,&#x27;劲舞团&#x27;,&#x27;超级玛丽&#x27;]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ol></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h2 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h3><p>​        在Vue中实现集中式状态（数据）管理的一个Vue插件，对vue应用中多个组件的共享状态进行集中式的管理（读/写），也是一种组件间通信的方式，且适用于任意组件间通信。</p><h3 id="2-何时使用？"><a href="#2-何时使用？" class="headerlink" title="2.何时使用？"></a>2.何时使用？</h3><p>​        多个组件需要共享数据时</p><h3 id="3-搭建vuex环境"><a href="#3-搭建vuex环境" class="headerlink" title="3.搭建vuex环境"></a>3.搭建vuex环境</h3><ol><li><p>创建文件：<code>src/store/index.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入Vue核心库</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//引入Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">//应用Vuex插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">//准备actions对象——响应组件中用户的动作</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="comment">//准备mutations对象——修改state中的数据</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;&#125;</span><br><span class="line"><span class="comment">//准备state对象——保存具体的数据</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建并暴露store</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">actions,</span><br><span class="line">mutations,</span><br><span class="line">state</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>在<code>main.js</code>中创建vm时传入<code>store</code>配置项</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"><span class="comment">//引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建vm</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line"><span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line"><span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">store</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-基本使用"><a href="#4-基本使用" class="headerlink" title="4.基本使用"></a>4.基本使用</h3><ol><li><p>初始化数据、配置<code>actions</code>、配置<code>mutations</code>，操作文件<code>store.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入Vue核心库</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//引入Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">//引用Vuex</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="comment">//响应组件中加的动作</span></span><br><span class="line"><span class="function"><span class="title">jia</span>(<span class="params">context,value</span>)</span>&#123;</span><br><span class="line"><span class="comment">// console.log(&#x27;actions中的jia被调用了&#x27;,miniStore,value)</span></span><br><span class="line">context.commit(<span class="string">&#x27;JIA&#x27;</span>,value)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    <span class="comment">//执行加</span></span><br><span class="line"><span class="function"><span class="title">JIA</span>(<span class="params">state,value</span>)</span>&#123;</span><br><span class="line"><span class="comment">// console.log(&#x27;mutations中的JIA被调用了&#x27;,state,value)</span></span><br><span class="line">state.sum += value</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化数据</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">   <span class="attr">sum</span>:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建并暴露store</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">actions,</span><br><span class="line">mutations,</span><br><span class="line">state,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>组件中读取vuex中的数据：<code>$store.state.sum</code></p></li><li><p>组件中修改vuex中的数据：<code>$store.dispatch(&#39;action中的方法名&#39;,数据)</code> 或 <code>$store.commit(&#39;mutations中的方法名&#39;,数据)</code></p><blockquote><p> 备注：若没有网络请求或其他业务逻辑，组件中也可以越过actions，即不写<code>dispatch</code>，直接编写<code>commit</code></p></blockquote></li></ol><h3 id="5-getters的使用"><a href="#5-getters的使用" class="headerlink" title="5.getters的使用"></a>5.getters的使用</h3><ol><li><p>概念：当state中的数据需要经过加工后再使用时，可以使用getters加工。</p></li><li><p>在<code>store.js</code>中追加<code>getters</code>配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line"><span class="function"><span class="title">bigSum</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> state.sum * <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建并暴露store</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">......</span><br><span class="line">getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>组件中读取数据：<code>$store.getters.bigSum</code></p></li></ol><h3 id="6-四个map方法的使用"><a href="#6-四个map方法的使用" class="headerlink" title="6.四个map方法的使用"></a>6.四个map方法的使用</h3><ol><li><p><strong>mapState方法：</strong>用于帮助我们映射<code>state</code>中的数据为计算属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">//借助mapState生成计算属性：sum、school、subject（对象写法）</span></span><br><span class="line">     ...mapState(&#123;<span class="attr">sum</span>:<span class="string">&#x27;sum&#x27;</span>,<span class="attr">school</span>:<span class="string">&#x27;school&#x27;</span>,<span class="attr">subject</span>:<span class="string">&#x27;subject&#x27;</span>&#125;),</span><br><span class="line">         </span><br><span class="line">    <span class="comment">//借助mapState生成计算属性：sum、school、subject（数组写法）</span></span><br><span class="line">    ...mapState([<span class="string">&#x27;sum&#x27;</span>,<span class="string">&#x27;school&#x27;</span>,<span class="string">&#x27;subject&#x27;</span>]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p><strong>mapGetters方法：</strong>用于帮助我们映射<code>getters</code>中的数据为计算属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">//借助mapGetters生成计算属性：bigSum（对象写法）</span></span><br><span class="line">    ...mapGetters(&#123;<span class="attr">bigSum</span>:<span class="string">&#x27;bigSum&#x27;</span>&#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">//借助mapGetters生成计算属性：bigSum（数组写法）</span></span><br><span class="line">    ...mapGetters([<span class="string">&#x27;bigSum&#x27;</span>])</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p><strong>mapActions方法：</strong>用于帮助我们生成与<code>actions</code>对话的方法，即：包含<code>$store.dispatch(xxx)</code>的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">    <span class="comment">//靠mapActions生成：incrementOdd、incrementWait（对象形式）</span></span><br><span class="line">    ...mapActions(&#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;jiaOdd&#x27;</span>,<span class="attr">incrementWait</span>:<span class="string">&#x27;jiaWait&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//靠mapActions生成：incrementOdd、incrementWait（数组形式）</span></span><br><span class="line">    ...mapActions([<span class="string">&#x27;jiaOdd&#x27;</span>,<span class="string">&#x27;jiaWait&#x27;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>mapMutations方法：</strong>用于帮助我们生成与<code>mutations</code>对话的方法，即：包含<code>$store.commit(xxx)</code>的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">    <span class="comment">//靠mapActions生成：increment、decrement（对象形式）</span></span><br><span class="line">    ...mapMutations(&#123;<span class="attr">increment</span>:<span class="string">&#x27;JIA&#x27;</span>,<span class="attr">decrement</span>:<span class="string">&#x27;JIAN&#x27;</span>&#125;),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//靠mapMutations生成：JIA、JIAN（对象形式）</span></span><br><span class="line">    ...mapMutations([<span class="string">&#x27;JIA&#x27;</span>,<span class="string">&#x27;JIAN&#x27;</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>备注：mapActions与mapMutations使用时，若需要传递参数需要：在模板中绑定事件时传递好参数，否则参数是事件对象。</p></blockquote><h3 id="7-模块化-命名空间"><a href="#7-模块化-命名空间" class="headerlink" title="7.模块化+命名空间"></a>7.模块化+命名空间</h3><ol><li><p>目的：让代码更好维护，让多种数据分类更加明确。</p></li><li><p>修改<code>store.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> countAbout = &#123;</span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,<span class="comment">//开启命名空间</span></span><br><span class="line">  <span class="attr">state</span>:&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">bigSum</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> state.sum * <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> personAbout = &#123;</span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,<span class="comment">//开启命名空间</span></span><br><span class="line">  <span class="attr">state</span>:&#123; ... &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    countAbout,</span><br><span class="line">    personAbout</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>开启命名空间后，组件中读取state数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式一：自己直接读取</span></span><br><span class="line"><span class="built_in">this</span>.$store.state.personAbout.list</span><br><span class="line"><span class="comment">//方式二：借助mapState读取：</span></span><br><span class="line">...mapState(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;sum&#x27;</span>,<span class="string">&#x27;school&#x27;</span>,<span class="string">&#x27;subject&#x27;</span>]),</span><br></pre></td></tr></table></figure></li><li><p>开启命名空间后，组件中读取getters数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式一：自己直接读取</span></span><br><span class="line"><span class="built_in">this</span>.$store.getters[<span class="string">&#x27;personAbout/firstPersonName&#x27;</span>]</span><br><span class="line"><span class="comment">//方式二：借助mapGetters读取：</span></span><br><span class="line">...mapGetters(<span class="string">&#x27;countAbout&#x27;</span>,[<span class="string">&#x27;bigSum&#x27;</span>])</span><br></pre></td></tr></table></figure></li><li><p>开启命名空间后，组件中调用dispatch</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式一：自己直接dispatch</span></span><br><span class="line"><span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;personAbout/addPersonWang&#x27;</span>,person)</span><br><span class="line"><span class="comment">//方式二：借助mapActions：</span></span><br><span class="line">...mapActions(<span class="string">&#x27;countAbout&#x27;</span>,&#123;<span class="attr">incrementOdd</span>:<span class="string">&#x27;jiaOdd&#x27;</span>,<span class="attr">incrementWait</span>:<span class="string">&#x27;jiaWait&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p>开启命名空间后，组件中调用commit</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式一：自己直接commit</span></span><br><span class="line"><span class="built_in">this</span>.$store.commit(<span class="string">&#x27;personAbout/ADD_PERSON&#x27;</span>,person)</span><br><span class="line"><span class="comment">//方式二：借助mapMutations：</span></span><br><span class="line">...mapMutations(<span class="string">&#x27;countAbout&#x27;</span>,&#123;<span class="attr">increment</span>:<span class="string">&#x27;JIA&#x27;</span>,<span class="attr">decrement</span>:<span class="string">&#x27;JIAN&#x27;</span>&#125;),</span><br></pre></td></tr></table></figure></li></ol><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><ol><li>理解： 一个路由（route）就是一组映射关系（key - value），多个路由需要路由器（router）进行管理。</li><li>前端路由：key是路径，value是组件。</li></ol><h3 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1.基本使用"></a>1.基本使用</h3><ol><li><p>安装vue-router，命令：<code>npm i vue-router</code></p></li><li><p>应用插件：<code>Vue.use(VueRouter)</code></p></li><li><p>编写router配置项:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入VueRouter</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">//引入Luyou 组件</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&#x27;../components/About&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../components/Home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建router实例对象，去管理一组一组的路由规则</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line"><span class="attr">routes</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:About</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Home</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露router</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></li><li><p>实现切换（active-class可配置高亮样式）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link active-class=&quot;active&quot; to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span><br></pre></td></tr></table></figure></li><li><p>指定展示位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view&gt;&lt;/router-view&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-几个注意点"><a href="#2-几个注意点" class="headerlink" title="2.几个注意点"></a>2.几个注意点</h3><ol><li>路由组件通常存放在<code>pages</code>文件夹，一般组件通常存放在<code>components</code>文件夹。</li><li>通过切换，“隐藏”了的路由组件，默认是被销毁掉的，需要的时候再去挂载。</li><li>每个组件都有自己的<code>$route</code>属性，里面存储着自己的路由信息。</li><li>整个应用只有一个router，可以通过组件的<code>$router</code>属性获取到。</li></ol><h3 id="3-多级路由（多级路由）"><a href="#3-多级路由（多级路由）" class="headerlink" title="3.多级路由（多级路由）"></a>3.多级路由（多级路由）</h3><ol><li><p>配置路由规则，使用children配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">routes:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:About,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Home,</span><br><span class="line"><span class="attr">children</span>:[ <span class="comment">//通过children配置子级路由</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;news&#x27;</span>, <span class="comment">//此处一定不要写：/news</span></span><br><span class="line"><span class="attr">component</span>:News</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;message&#x27;</span>,<span class="comment">//此处一定不要写：/message</span></span><br><span class="line"><span class="attr">component</span>:Message</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>跳转（要写完整路径）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to=&quot;/home/news&quot;&gt;News&lt;/router-link&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-路由的query参数"><a href="#4-路由的query参数" class="headerlink" title="4.路由的query参数"></a>4.路由的query参数</h3><ol><li><p>传递参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 跳转并携带query参数，to的字符串写法 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;/home/message/detail?id=666&amp;title=你好&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 跳转并携带query参数，to的对象写法 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">:to=&quot;&#123;</span><br><span class="line">path:&#x27;/home/message/detail&#x27;,</span><br><span class="line">query:&#123;</span><br><span class="line">   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure></li><li><p>接收参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$route.query.id</span><br><span class="line">$route.query.title</span><br></pre></td></tr></table></figure></li></ol><h3 id="5-命名路由"><a href="#5-命名路由" class="headerlink" title="5.命名路由"></a>5.命名路由</h3><ol><li><p>作用：可以简化路由的跳转。</p></li><li><p>如何使用</p><ol><li><p>给路由命名：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/demo&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Demo,</span><br><span class="line"><span class="attr">children</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;test&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Test,</span><br><span class="line"><span class="attr">children</span>:[</span><br><span class="line">&#123;</span><br><span class="line">                      <span class="attr">name</span>:<span class="string">&#x27;hello&#x27;</span> <span class="comment">//给路由命名</span></span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;welcome&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Hello,</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>简化跳转：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--简化前，需要写完整的路径 --&gt;</span><br><span class="line">&lt;router-link to=&quot;/demo/test/welcome&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--简化后，直接通过名字跳转 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;&#123;name:&#x27;hello&#x27;&#125;&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--简化写法配合传递参数 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">:to=&quot;&#123;</span><br><span class="line">name:&#x27;hello&#x27;,</span><br><span class="line">query:&#123;</span><br><span class="line">   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="6-路由的params参数"><a href="#6-路由的params参数" class="headerlink" title="6.路由的params参数"></a>6.路由的params参数</h3><ol><li><p>配置路由，声明接收params参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Home,</span><br><span class="line"><span class="attr">children</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;news&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:News</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">component</span>:Message,</span><br><span class="line"><span class="attr">children</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;detail/:id/:title&#x27;</span>, <span class="comment">//使用占位符声明接收params参数</span></span><br><span class="line"><span class="attr">component</span>:Detail</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>传递参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 跳转并携带params参数，to的字符串写法 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;/home/message/detail/666/你好&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 跳转并携带params参数，to的对象写法 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">:to=&quot;&#123;</span><br><span class="line">name:&#x27;xiangqing&#x27;,</span><br><span class="line">params:&#123;</span><br><span class="line">   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure><blockquote><p>特别注意：路由携带params参数时，若使用to的对象写法，则不能使用path配置项，必须使用name配置！</p></blockquote></li><li><p>接收参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$route.params.id</span><br><span class="line">$route.params.title</span><br></pre></td></tr></table></figure></li></ol><h3 id="7-路由的props配置"><a href="#7-路由的props配置" class="headerlink" title="7.路由的props配置"></a>7.路由的props配置</h3><p>​    作用：让路由组件更方便的收到参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line"><span class="attr">path</span>:<span class="string">&#x27;detail/:id&#x27;</span>,</span><br><span class="line"><span class="attr">component</span>:Detail,</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一种写法：props值为对象，该对象中所有的key-value的组合最终都会通过props传给Detail组件</span></span><br><span class="line"><span class="comment">// props:&#123;a:900&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种写法：props值为布尔值，布尔值为true，则把路由收到的所有params参数通过props传给Detail组件</span></span><br><span class="line"><span class="comment">// props:true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第三种写法：props值为函数，该函数返回的对象中每一组key-value都会通过props传给Detail组件</span></span><br><span class="line"><span class="function"><span class="title">props</span>(<span class="params">route</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">id</span>:route.query.id,</span><br><span class="line"><span class="attr">title</span>:route.query.title</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-lt-router-link-gt-的replace属性"><a href="#8-lt-router-link-gt-的replace属性" class="headerlink" title="8.&lt;router-link&gt;的replace属性"></a>8.<code>&lt;router-link&gt;</code>的replace属性</h3><ol><li>作用：控制路由跳转时操作浏览器历史记录的模式</li><li>浏览器的历史记录有两种写入方式：分别为<code>push</code>和<code>replace</code>，<code>push</code>是追加历史记录，<code>replace</code>是替换当前记录。路由跳转时候默认为<code>push</code></li><li>如何开启<code>replace</code>模式：<code>&lt;router-link replace .......&gt;News&lt;/router-link&gt;</code></li></ol><h3 id="9-编程式路由导航"><a href="#9-编程式路由导航" class="headerlink" title="9.编程式路由导航"></a>9.编程式路由导航</h3><ol><li><p>作用：不借助<code>&lt;router-link&gt; </code>实现路由跳转，让路由跳转更加灵活</p></li><li><p>具体编码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$router的两个API</span></span><br><span class="line"><span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line"><span class="attr">params</span>:&#123;</span><br><span class="line"><span class="attr">id</span>:xxx,</span><br><span class="line"><span class="attr">title</span>:xxx</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line"><span class="attr">params</span>:&#123;</span><br><span class="line"><span class="attr">id</span>:xxx,</span><br><span class="line"><span class="attr">title</span>:xxx</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">this</span>.$router.forward() <span class="comment">//前进</span></span><br><span class="line"><span class="built_in">this</span>.$router.back() <span class="comment">//后退</span></span><br><span class="line"><span class="built_in">this</span>.$router.go() <span class="comment">//可前进也可后退</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="10-缓存路由组件"><a href="#10-缓存路由组件" class="headerlink" title="10.缓存路由组件"></a>10.缓存路由组件</h3><ol><li><p>作用：让不展示的路由组件保持挂载，不被销毁。</p></li><li><p>具体编码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;keep-alive include=&quot;News&quot;&gt; </span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="11-两个新的生命周期钩子"><a href="#11-两个新的生命周期钩子" class="headerlink" title="11.两个新的生命周期钩子"></a>11.两个新的生命周期钩子</h3><ol><li>作用：路由组件所独有的两个钩子，用于捕获路由组件的激活状态。</li><li>具体名字：<ol><li><code>activated</code>路由组件被激活时触发。</li><li><code>deactivated</code>路由组件失活时触发。</li></ol></li></ol><h3 id="12-路由守卫"><a href="#12-路由守卫" class="headerlink" title="12.路由守卫"></a>12.路由守卫</h3><ol><li><p>作用：对路由进行权限控制</p></li><li><p>分类：全局守卫、独享守卫、组件内守卫</p></li><li><p>全局守卫:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局前置守卫：初始化时执行、每次路由切换前执行</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;beforeEach&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line"><span class="keyword">if</span>(to.meta.isAuth)&#123; <span class="comment">//判断当前路由是否需要进行权限控制</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;school&#x27;</span>) === <span class="string">&#x27;atguigu&#x27;</span>)&#123; <span class="comment">//权限控制的具体规则</span></span><br><span class="line">next() <span class="comment">//放行</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">alert(<span class="string">&#x27;暂无权限查看&#x27;</span>)</span><br><span class="line"><span class="comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">next() <span class="comment">//放行</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局后置守卫：初始化时执行、每次路由切换后执行</span></span><br><span class="line">router.afterEach(<span class="function">(<span class="params">to,<span class="keyword">from</span></span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;afterEach&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line"><span class="keyword">if</span>(to.meta.title)&#123; </span><br><span class="line"><span class="built_in">document</span>.title = to.meta.title <span class="comment">//修改网页的title</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">document</span>.title = <span class="string">&#x27;vue_test&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>独享守卫:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">beforeEnter</span>(<span class="params">to,<span class="keyword">from</span>,next</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;beforeEnter&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line"><span class="keyword">if</span>(to.meta.isAuth)&#123; <span class="comment">//判断当前路由是否需要进行权限控制</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;school&#x27;</span>) === <span class="string">&#x27;atguigu&#x27;</span>)&#123;</span><br><span class="line">next()</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">alert(<span class="string">&#x27;暂无权限查看&#x27;</span>)</span><br><span class="line"><span class="comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">next()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>组件内守卫：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进入守卫：通过路由规则，进入该组件时被调用</span></span><br><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//离开守卫：通过路由规则，离开该组件时被调用</span></span><br><span class="line">beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="13-路由器的两种工作模式"><a href="#13-路由器的两种工作模式" class="headerlink" title="13.路由器的两种工作模式"></a>13.路由器的两种工作模式</h3><ol><li><p>对于一个url来说，什么是hash值？—— #及其后面的内容就是hash值。</p></li><li><p>hash值不会包含在 HTTP 请求中，即：hash值不会带给服务器。</p></li><li><p>hash模式：</p><ol><li>地址中永远带着#号，不美观 。</li><li>若以后将地址通过第三方手机app分享，若app校验严格，则地址会被标记为不合法。</li><li>兼容性较好。</li></ol></li><li><p>history模式：</p><ol><li>地址干净，美观 。</li><li>兼容性和hash模式相比略差。</li><li>应用部署上线时需要后端人员支持，解决刷新页面服务端404的问题。</li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>axios的配置和基本使用方法</title>
      <link href="/archives/6087338d.html"/>
      <url>/archives/6087338d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h2><div class="note success no-icon flat"><p>首先将axios安装到全局，或用script标签直接导入 </p></div><p>Using npm:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure><p>Using bower:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bower install axios</span><br></pre></td></tr></table></figure><p>Using yarn:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add axios</span><br></pre></td></tr></table></figure><p>Using jsDelivr CDN:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>国内CDN：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>Using unpkg CDN:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="使用JSON-Server配置一个可被访问的服务器"><a href="#使用JSON-Server配置一个可被访问的服务器" class="headerlink" title="使用JSON Server配置一个可被访问的服务器"></a>使用JSON Server配置一个可被访问的服务器</h3><div class="note default simple"><p>在全局安装 JSON Server </p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g json-server</span><br></pre></td></tr></table></figure><div class="note default simple"><p>在根目录下创建一个db.json文件存放服务器数据</p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;posts&quot;</span>: [</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;json-server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;typicode&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;comments&quot;</span>: [</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">        <span class="string">&quot;body&quot;</span>: <span class="string">&quot;some comment&quot;</span>, </span><br><span class="line">        <span class="string">&quot;postId&quot;</span>: <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;profile&quot;</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;typicode&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note default simple"><p>在终端中启动服务器 </p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json-server --watch db.json</span><br></pre></td></tr></table></figure><div class="note default simple"><p>默认路由 </p></div><p>多路路由</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET    /posts</span><br><span class="line">GET    /posts/1</span><br><span class="line">POST   /posts</span><br><span class="line">PUT    /posts/1</span><br><span class="line">PATCH  /posts/1</span><br><span class="line">DELETE /posts/1</span><br></pre></td></tr></table></figure><p>单路路由</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET    /profile</span><br><span class="line">POST   /profile</span><br><span class="line">PUT    /profile</span><br><span class="line">PATCH  /profile</span><br></pre></td></tr></table></figure><h3 id="axios的配置"><a href="#axios的配置" class="headerlink" title="axios的配置"></a>axios的配置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>axios的基本使用<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        </span></span><br><span class="line"><span class="css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-size</span>: large;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: <span class="number">0px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        </span></span><br><span class="line"><span class="css">        <span class="selector-class">.btn1</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#FF7959</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        </span></span><br><span class="line"><span class="css">        <span class="selector-class">.btn2</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#8A76B5</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        </span></span><br><span class="line"><span class="css">        <span class="selector-class">.btn3</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#EF4E00</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        </span></span><br><span class="line"><span class="css">        <span class="selector-class">.btn4</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#E39001</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>基本使用<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>发送GET请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>发送POST请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn3&quot;</span>&gt;</span>发送PUT请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn4&quot;</span>&gt;</span>发送DELETE请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;button&#x27;</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//GET获取服务器的信息</span></span></span><br><span class="line"><span class="javascript">        btn[<span class="number">0</span>].addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送Ajax请求</span></span></span><br><span class="line"><span class="javascript">            axios(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置请求方式</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置请求的地址(最后面的数字代表数组中id为2的对象)</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/posts/2&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//axios会返回一个promise对象，将返回的promise对象进行处理</span></span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//打印响应体</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//POST给服务器添加数据</span></span></span><br><span class="line"><span class="javascript">        btn[<span class="number">1</span>].addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送ajax请求</span></span></span><br><span class="line"><span class="javascript">            axios(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置请求方式</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//将要添加的data数据放到posts数组中</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/posts&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置要添加的数据</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">title</span>: <span class="string">&quot;爱你所爱，行你所行，听从你心你，无问西东&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">author</span>: <span class="string">&quot;Mr&#x27;L&quot;</span></span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//PUT更新(修改)服务器的数据</span></span></span><br><span class="line"><span class="javascript">        btn[<span class="number">2</span>].addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送ajax请求</span></span></span><br><span class="line"><span class="javascript">            axios(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置请求方式</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//将posts数组中id=3的数据进行修改</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/posts/3&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置修改的数据</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">title</span>: <span class="string">&quot;浮世三千，吾爱有三，日月于卿，日为朝，月为暮，吾原与卿朝朝暮暮&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">author</span>: <span class="string">&quot;Mr&#x27;L&quot;</span></span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//DELETE删除服务器中的某条数据</span></span></span><br><span class="line"><span class="javascript">        btn[<span class="number">3</span>].addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送ajax请求</span></span></span><br><span class="line"><span class="javascript">            axios(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置请求方式</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">//设置要删除的数据（将posts中id=4的数组对象删除）</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/posts/4&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> axios </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS中的闭包</title>
      <link href="/archives/d0e761e9.html"/>
      <url>/archives/d0e761e9.html</url>
      
        <content type="html"><![CDATA[<h2 id="闭包的概念"><a href="#闭包的概念" class="headerlink" title="闭包的概念"></a>闭包的概念</h2><div class="note success no-icon flat"><p>有权访问另一个函数作用域中的变量的函数。一般情况下就是一个函数中包含另一个函数。由此我们可以知道闭包就是一个函数，只不过这个函数可以访问到另一个函数的作用域。闭包可以访问到父级函数的变量，且该变量不会被销毁</p></div><div class="note danger no-icon flat"><p>函数的作用域是独立的封闭的，外部的执行环境是无法访问的，但是闭包具有这个能力。</p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&#x27;LF&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cat</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> per = person(); <span class="comment">//per的值就是return后的结果，即一个函数</span></span><br><span class="line">per(); <span class="comment">//LF per()相当于cat()</span></span><br><span class="line">per(); <span class="comment">//LF  变量在函数执行完之后一直没有被销毁，存在于内存中</span></span><br><span class="line">per(); <span class="comment">//LF</span></span><br></pre></td></tr></table></figure><p>闭包的原理其实是利用了作用域链的特性，我们都知道作用域链就是当前执行环境下访问某个变量时，如果不存在就一直向外寻找，最终找到最外层就是全局作用域，这样就形成了一个作用域链 </p><div class="note success no-icon flat"><p> 闭包的优点：可以隐藏变量避免全局污染。可以读取函数内部的变量。</p><p>闭包的缺点：变量不会被回收，造成内存的消耗，不恰当的使用闭包可能会造成内存的泄露 </p></div>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS中一些常见的函数</title>
      <link href="/archives/e0e75f8e.html"/>
      <url>/archives/e0e75f8e.html</url>
      
        <content type="html"><![CDATA[<h2 id="Array-potortype"><a href="#Array-potortype" class="headerlink" title="Array.potortype"></a>Array.potortype</h2><h3 id="arr-slice"><a href="#arr-slice" class="headerlink" title="arr.slice()"></a>arr.slice()</h3><div class="note info no-icon flat"><p>arr.slice(start, end)</p><p> 选择从给定的start参数开始的元素，并在给定的end处结束，包括start但不包括end</p><p>方法从数组中返回选定的元素，作为一个新数组。 </p></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>start</td><td>可选。整数，指定从哪里开始选择（第一个元素的索引为 0）。使用负数从数组的末尾进行选择。如果省略，则类似于 “0”。</td></tr><tr><td>end</td><td>可选。整数，指定选择结束的位置。如果省略，将选择从开始的位置到数组末尾的所有元素。使用负数从数组末尾进行选择</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fruits = [<span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Lemon&quot;</span>, <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Mango&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> citrus = fruits.slice(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(citrus)</span><br><span class="line"><span class="comment">//Orange,Lemon</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fruits = [<span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Lemon&quot;</span>, <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Mango&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> myBest = fruits.slice(-<span class="number">3</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myBest)</span><br><span class="line"><span class="comment">//Lemon,Apple</span></span><br></pre></td></tr></table></figure><h3 id="arr-reduce"><a href="#arr-reduce" class="headerlink" title="arr.reduce()"></a>arr.reduce()</h3><div class="note info no-icon flat"><p> arr.reduce(function(total, currentValue, currentIndex, arr), initialValue)</p><p>主要功能是做累加处理，即接受一个函数作为累加器将数组中的元素从 左到右执行累加器，返回最终结果 </p></div><table><thead><tr><th align="left">参数</th><th>描述</th></tr></thead><tbody><tr><td align="left">total</td><td>必需，上一次调用累加器是返回值，initial Value有值时 total = initialValue</td></tr><tr><td align="left">currentValue</td><td>必需，数组当前元素的值</td></tr><tr><td align="left">currentIndex</td><td>可选，数组当前元素值的索引</td></tr><tr><td align="left">arr</td><td>可选，当前元素所属的数组对象</td></tr><tr><td align="left">initialValue</td><td>可选，传递给函数的初始值，若没有则 initialValue = arr[currentIndex]</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">65</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSum</span>(<span class="params">total, num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> total + num;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">let</span> sum = numbers.reduce(getSum);</span><br><span class="line"> <span class="built_in">console</span>.log(sum);</span><br><span class="line"> <span class="comment">// 125</span></span><br></pre></td></tr></table></figure><h3 id="arr-forEach"><a href="#arr-forEach" class="headerlink" title="arr.forEach()"></a>arr.forEach()</h3><div class="note info no-icon flat"><p>arr.forEach(callback(currentValue [, index [, array]])[, thisArg])</p><p> 对数组的每个元素执行一次给定的函数。 </p></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>currentValue</td><td>数组正在处理的当前元素</td></tr><tr><td>index</td><td>数组正在处理的当前元素的索引</td></tr><tr><td>array</td><td>数组本身</td></tr><tr><td>thisArg</td><td>可选，如果 thisArg 参数有值，则每次 callback 函数被调用时，this 都会指向 thisArg 参数。如果省略了 thisArg 参数，或者其值为 null 或 undefined，this 则指向全局对象</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arraySparse = [<span class="number">1</span>,<span class="number">3</span>,,<span class="number">7</span>];</span><br><span class="line"><span class="keyword">let</span> numCallbackRuns = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">arraySparse.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(element);</span><br><span class="line">  numCallbackRuns++;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;numCallbackRuns: &quot;</span>, numCallbackRuns);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 7</span></span><br><span class="line"><span class="comment">// numCallbackRuns: 3</span></span><br></pre></td></tr></table></figure><h3 id="bind-、call-、apply"><a href="#bind-、call-、apply" class="headerlink" title="bind()、call()、apply()"></a>bind()、call()、apply()</h3><h4 id="function-bind"><a href="#function-bind" class="headerlink" title="function.bind()"></a>function.bind()</h4><div class="note info no-icon flat"><p> function.bind(thisArg[, arg1[, arg2[, …]]])</p><p>bind()方法创建一个新的函数，在 bind() 被调用时，这个新函数的 this 被指定为 bind() 的第一个参数，而其余参数将作为新函数的参数，供调用时使用。返回值是一个原函数的拷贝值，并拥有指定的this值和初始参数</p></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>thisArg</td><td>调用绑定函数时作为 this 参数传递给目标函数的值。 如果使用new运算符构造绑定函数，则忽略该值。当使用 bind 在 setTimeout 中创建一个函数（作为回调提供）时，作为 thisArg 传递的任何原始值都将转换为 object。如果 bind 函数的参数列表为空，或者thisArg是null或undefined，执行作用域的 this 将被视为新函数的 thisArg。</td></tr><tr><td>arg1,arg2…</td><td>当目标函数被调用时，被预置入绑定函数的参数列表中的参数。</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.x = <span class="number">9</span>;    <span class="comment">// 在浏览器中，this 指向全局的 &quot;window&quot; 对象</span></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">81</span>,</span><br><span class="line">  <span class="attr">getX</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">this</span>.x; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.getX(); <span class="comment">// 81</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> retrieveX = <span class="built_in">module</span>.getX;</span><br><span class="line">retrieveX();</span><br><span class="line"><span class="comment">// 返回 9 - 因为函数是在全局作用域中调用的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个新函数，把 &#x27;this&#x27; 绑定到 module 对象</span></span><br><span class="line"><span class="comment">// 新手可能会将全局变量 x 与 module 的属性 x 混淆</span></span><br><span class="line"><span class="keyword">var</span> boundGetX = retrieveX.bind(<span class="built_in">module</span>);</span><br><span class="line">boundGetX(); <span class="comment">// 81</span></span><br></pre></td></tr></table></figure><h4 id="function-call"><a href="#function-call" class="headerlink" title="function.call()"></a>function.call()</h4><div class="note info no-icon flat"><p> function.call(thisArg, arg1, arg2, …)</p><p>call() 方法使用一个指定的 this 值和单独给出的一个或多个参数来调用一个函数。</p></div><div class="note info no-icon flat"><p> call() call() 允许为不同的对象分配和调用属于一个对象的函数/方法。</p><p>call() 提供新的 this 值给当前调用的函数/方法。你可以使用 call 来实现继承：写一个方法，然后让另外一个新的对象来继承它（而不是在新对象中再写一次这个方法）。</p></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>thisArg</td><td>可选的。在 function 函数运行时使用的 this 值。请注意，this可能不是该方法看到的实际值：如果这个函数处于非严格模式下，则指定为 null 或 undefined 时会自动替换为指向全局对象，原始值会被包装。</td></tr><tr><td>arg1,arg2…</td><td>传给thisArg函数的参数</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Product</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Food</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  Product.call(<span class="built_in">this</span>, name, price);</span><br><span class="line">  <span class="built_in">this</span>.category = <span class="string">&#x27;food&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Toy</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  Product.call(<span class="built_in">this</span>, name, price);</span><br><span class="line">  <span class="built_in">this</span>.category = <span class="string">&#x27;toy&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cheese = <span class="keyword">new</span> Food(<span class="string">&#x27;feta&#x27;</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">var</span> fun = <span class="keyword">new</span> Toy(<span class="string">&#x27;robot&#x27;</span>, <span class="number">40</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="func-apply"><a href="#func-apply" class="headerlink" title="func.apply()"></a>func.apply()</h4><div class="note info no-icon flat"><p>func.apply(thisArg, [argsArray])</p><p>方法调用一个具有给定this值的函数，以及以一个数组（或<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Indexed_collections#working_with_array-like_objects">类数组对象</a>）的形式提供的参数。返回值是调用有指定this值和参数的函数的结果。</p></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>thisArg</td><td>必选的。在 func 函数运行时使用的 this 值。请注意，this可能不是该方法看到的实际值：如果这个函数处于非严格模式下，则指定为 null 或 undefined 时会自动替换为指向全局对象，原始值会被包装。</td></tr><tr><td>argsArray</td><td>可选的。一个数组或者类数组对象，其中的数组元素将作为单独的参数传给 func 函数。如果该参数的值为 null 或  undefined，则表示不需要传入任何参数。从ECMAScript 5 开始可以使用类数组对象。 浏览器兼容性 请参阅本文底部内容。</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> elements = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">array.push.apply(array, elements);</span><br><span class="line"><span class="built_in">console</span>.info(array); <span class="comment">// [&quot;a&quot;, &quot;b&quot;, 0, 1, 2]</span></span><br></pre></td></tr></table></figure><h4 id="bind-、call-、apply-的区别"><a href="#bind-、call-、apply-的区别" class="headerlink" title="bind()、call()、apply()的区别"></a>bind()、call()、apply()的区别</h4><table><thead><tr><th>函数</th><th>区别</th></tr></thead><tbody><tr><td>call()</td><td>立即调用前面的数，参数是一个一个的传入的</td></tr><tr><td>apply()</td><td>立即调用前面的数，参数是以数组的形式传入的</td></tr><tr><td>bind()</td><td>不会立即调用，而会生成一个新的函数，参数是一个一个的传入的</td></tr></tbody></table><h2 id="Object-prototype"><a href="#Object-prototype" class="headerlink" title="Object.prototype"></a>Object.prototype</h2><h3 id="Object-prototype-valueOf"><a href="#Object-prototype-valueOf" class="headerlink" title="Object.prototype.valueOf()"></a>Object.prototype.valueOf()</h3><div class="note info no-icon flat"><p>valueOf()是object的原型方法，他定义在Object.prototype对象上，所有实例对象搜会继承valuueOf()方法  。valueOf()返回指定对象的原始值</p></div><p>不同类型对象的valueOf()方法的返回值</p><table><thead><tr><th align="left"><strong>对象</strong></th><th align="left"><strong>返回值</strong></th></tr></thead><tbody><tr><td align="left">Array</td><td align="left">返回数组对象本身。</td></tr><tr><td align="left">Boolean</td><td align="left">布尔值。</td></tr><tr><td align="left">Date</td><td align="left">存储的时间是从 1970 年 1 月 1 日午夜开始计的毫秒数 UTC。</td></tr><tr><td align="left">Function</td><td align="left">函数本身。</td></tr><tr><td align="left">Number</td><td align="left">数字值。</td></tr><tr><td align="left">Object</td><td align="left">对象本身。这是默认情况。</td></tr><tr><td align="left">String</td><td align="left">字符串值。</td></tr><tr><td align="left"></td><td align="left">Math 和 Error 对象没有 valueOf 方法。</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Array：返回数组对象本身</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="string">&quot;ABC&quot;</span>, <span class="literal">true</span>, <span class="number">12</span>, -<span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log(array.valueOf() === array);   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Date：当前时间距1970年1月1日午夜的毫秒数</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2013</span>, <span class="number">7</span>, <span class="number">18</span>, <span class="number">23</span>, <span class="number">11</span>, <span class="number">59</span>, <span class="number">230</span>);</span><br><span class="line"><span class="built_in">console</span>.log(date.valueOf());   <span class="comment">// 1376838719230</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number：返回数字值</span></span><br><span class="line"><span class="keyword">var</span> num =  <span class="number">15.26540</span>;</span><br><span class="line"><span class="built_in">console</span>.log(num.valueOf());   <span class="comment">// 15.2654</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 布尔：返回布尔值true或false</span></span><br><span class="line"><span class="keyword">var</span> bool = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.log(bool.valueOf() === bool);   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// new一个Boolean对象</span></span><br><span class="line"><span class="keyword">var</span> newBool = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// valueOf()返回的是true，两者的值相等</span></span><br><span class="line"><span class="built_in">console</span>.log(newBool.valueOf() == newBool);   <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 但是不全等，两者类型不相等，前者是boolean类型，后者是object类型</span></span><br><span class="line"><span class="built_in">console</span>.log(newBool.valueOf() === newBool);   <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function：返回函数本身</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log( foo.valueOf() === foo );   <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> foo2 =  <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;return x + y;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log( foo2.valueOf() );</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ƒ anonymous(x,y</span></span><br><span class="line"><span class="comment">) &#123;</span></span><br><span class="line"><span class="comment">return x + y;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object：返回对象本身</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log( obj.valueOf() === obj );   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String：返回字符串值</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;http://www.xyz.com&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log( str.valueOf() === str );   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// new一个字符串对象</span></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&quot;http://www.xyz.com&quot;</span>);</span><br><span class="line"><span class="comment">// 两者的值相等，但不全等，因为类型不同，前者为string类型，后者为object类型</span></span><br><span class="line"><span class="built_in">console</span>.log( str2.valueOf() === str2 );   <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="Object-prototype-toString"><a href="#Object-prototype-toString" class="headerlink" title="Object.prototype.toString()"></a>Object.prototype.toString()</h3><div class="note info no-icon flat"><p>toString()方法返回一个表示该对象的字符串。</p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog1 = <span class="keyword">new</span> Dog(<span class="string">&#x27;Gabby&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Dog.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">dogToString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(dog1.toString());</span><br><span class="line"><span class="comment">// expected output: &quot;Gabby&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在博客中使用表情包</title>
      <link href="/archives/4093aa1.html"/>
      <url>/archives/4093aa1.html</url>
      
        <content type="html"><![CDATA[<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p>安装一个插件：hexo-filter-emoji 。我们只需要安装这一个插件就好了，渲染的话，还是采用默认的渲染引擎。<br><code>npm install hexo-filter-emoji</code></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在站点配置文件 .config.yml 中增加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emoji:</span><br><span class="line">  enable: true</span><br><span class="line">  className: github-emoji</span><br><span class="line">  styles:</span><br><span class="line">  customEmojis:</span><br></pre></td></tr></table></figure><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>输入对应的 emoji 编码就行了，这个是两种方法都通用的<br>例如：输入笑脸对应的 emoji 编码 <code>&lt;span class=&quot;github-emoji&quot; alias=&quot;smile&quot; style=&quot;&quot; fallback-src=&quot;https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8&quot;&gt;&amp;#x1f604;&lt;/span&gt;</code> 就可以得到 😄</p><p>方法二额外的用法：<br>如果你不喜欢 :: 这种方法，你还可以这样采用 tags 的方式：<br><code>&#123;% emoji sparkles %&#125;</code><br>为了避免有时候 :: 带来的解析问题，我们可以在 front-matter 中添加 no-emoji:  true 来禁用 :: 的方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Hello World</span><br><span class="line">no-emoji: true</span><br><span class="line">---</span><br><span class="line"><span class="github-emoji" alias="tada" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png?v8">&#x1f389;</span> as it is.</span><br><span class="line">&#123;% emoji tada %&#125; still works.</span><br></pre></td></tr></table></figure><h2 id="表情包代码"><a href="#表情包代码" class="headerlink" title="表情包代码"></a>表情包代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">😐` : neutral_face: `😄` : smile: `😆` : laughing: `</span><br><span class="line">😊` : blush: `😃` : smiley: `☺️` : relaxed: `</span><br><span class="line">😏` : smirk: `😍` : heart_eyes: `😘` : kissing_heart: `</span><br><span class="line">😚` : kissing_closed_eyes: `😳` : flushed: `😌` : relieved: `</span><br><span class="line">😆` : satisfied: `😁` : grin: `😉` : wink: `</span><br><span class="line">😜` : stuck_out_tongue_winking_eye: `😝` : stuck_out_tongue_closed_eyes: `😀` : grinning: `</span><br><span class="line">😗` : kissing: `😙` : kissing_smiling_eyes: `😛` : stuck_out_tongue: `</span><br><span class="line">😴` : sleeping: `😟` : worried: `😦` : frowning: `</span><br><span class="line">😧` : anguished: `😮` : open_mouth: `😬` : grimacing: `</span><br><span class="line">😕` : confused: `😯` : hushed: `😑` : expressionless: `</span><br><span class="line">😒` : unamused: `😅` : sweat_smile: `😓` : sweat: `</span><br><span class="line">😥` : disappointed_relieved: `😩` : weary: `😔` : pensive: `</span><br><span class="line">😞` : disappointed: `😖` : confounded: `😨` : fearful: `</span><br><span class="line">😰` : cold_sweat: `😣` : persevere: `😢` : cry: `</span><br><span class="line">😭` : sob: `😂` : joy: `😲` : astonished: `</span><br><span class="line">😱` : scream: `💭` : thought_balloon: `😫` : tired_face: `</span><br><span class="line">😠` : angry: `😡` : rage: `😤` : triumph: `</span><br><span class="line">😪` : sleepy: `😋` : yum: `😷` : mask: `</span><br><span class="line">😎` : sunglasses: `😵` : dizzy_face: `👿` : imp: `</span><br><span class="line">😈` : smiling_imp: `💬` : speech_balloon: `😶` : no_mouth: `</span><br><span class="line">😇` : innocent: `👽` : alien: `💛` : yellow_heart: `</span><br><span class="line">💙` : blue_heart: `💜` : purple_heart: `❤️` : heart: `</span><br><span class="line">💚` : green_heart: `💔` : broken_heart: `💓` : heartbeat: `</span><br><span class="line">💗` : heartpulse: `💕` : two_hearts: `💞` : revolving_hearts: `</span><br><span class="line">💘` : cupid: `💖` : sparkling_heart: `✨` : sparkles: `</span><br><span class="line">⭐️` : star: `🌟` : star2: `💫` : dizzy: `</span><br><span class="line">💥` : boom: `💥` : collision: `💢` : anger: `</span><br><span class="line">❗️` : exclamation: `❓` : question: `❕` : grey_exclamation: `</span><br><span class="line">❔` : grey_question: `💤` : zzz: `💨` : dash: `</span><br><span class="line">💦` : sweat_drops: `🎶` : notes: `🎵` : musical_note: `</span><br><span class="line">🔥` : fire: `💩` : hankey: `💩` : poop: `</span><br><span class="line">💩` : shit: `👍` : +1: `👍` : thumbsup: `</span><br><span class="line">👎` : -1: `👎` : thumbsdown: `👌` : ok_hand: `</span><br><span class="line">👊` : punch: `👊` : facepunch: `✊` : fist: `</span><br><span class="line">✌️` : v: `👋` : wave: `✋` : hand: `</span><br><span class="line">✋` : raised_hand: `👐` : open_hands: `☝️` : point_up: `</span><br><span class="line">👇` : point_down: `👈` : point_left: `👉` : point_right: `</span><br><span class="line">🙌` : raised_hands: `🙏` : pray: `👆` : point_up_2: `</span><br><span class="line">👏` : clap: `💪` : muscle: `🤘` : metal: `</span><br><span class="line">🖕` : fu: `🚶` : walking: `🏃` : runner: `</span><br><span class="line">🏃` : running: `👫` : couple: `👪` : family: `</span><br><span class="line">👬` : two_men_holding_hands: `👭` : two_women_holding_hands: `💃` : dancer: `</span><br><span class="line">👯` : dancers: `🙆` : ok_woman: `🙅` : no_good: `</span><br><span class="line">💁` : information_desk_person: `🙋` : raising_hand: `👰` : bride_with_veil: `</span><br><span class="line">🙎` : person_with_pouting_face: `🙍` : person_frowning: `🙇` : bow: `</span><br><span class="line">: `couplekiss: `` : couplekiss: `💑` : couple_with_heart: `💆` : massage: `</span><br><span class="line">💇` : haircut: `💅` : nail_care: `👦` : boy: `</span><br><span class="line">👧` : girl: `👩` : woman: `👨` : man: `</span><br><span class="line">👶` : baby: `👵` : older_woman: `👴` : older_man: `</span><br><span class="line">👱` : person_with_blond_hair: `👲` : man_with_gua_pi_mao: `👳` : man_with_turban: `</span><br><span class="line">👷` : construction_worker: `👮` : cop: `👼` : angel: `</span><br><span class="line">👸` : princess: `😺` : smiley_cat: `😸` : smile_cat: `</span><br><span class="line">😻` : heart_eyes_cat: `😽` : kissing_cat: `😼` : smirk_cat: `</span><br><span class="line">🙀` : scream_cat: `😿` : crying_cat_face: `😹` : joy_cat: `</span><br><span class="line">😾` : pouting_cat: `👹` : japanese_ogre: `👺` : japanese_goblin: `</span><br><span class="line">🙈` : see_no_evil: `🙉` : hear_no_evil: `🙊` : speak_no_evil: `</span><br><span class="line">💂` : guardsman: `💀` : skull: `🐾` : feet: `</span><br><span class="line">👄` : lips: `💋` : kiss: `💧` : droplet: `</span><br><span class="line">👂` : ear: `👀` : eyes: `👃` : nose: `</span><br><span class="line">👅` : tongue: `💌` : love_letter: `👤` : bust_in_silhouette: `</span><br><span class="line">👥` : busts_in_silhouette: `</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">☀️` : sunny: `☔️` : umbrella: `☁️` : cloud: `</span><br><span class="line">❄️` : snowflake: `⛄️` : snowman: `⚡️` : zap: `</span><br><span class="line">🌀` : cyclone: `🌁` : foggy: `🌊` : ocean: `</span><br><span class="line">🐱` : cat: `🐶` : dog: `🐭` : mouse: `</span><br><span class="line">🐹` : hamster: `🐰` : rabbit: `🐺` : wolf: `</span><br><span class="line">🐸` : frog: `🐯` : tiger: `🐨` : koala: `</span><br><span class="line">🐻` : bear: `🐷` : pig: `🐽` : pig_nose: `</span><br><span class="line">🐮` : cow: `🐗` : boar: `🐵` : monkey_face: `</span><br><span class="line">🐒` : monkey: `🐴` : horse: `🐎` : racehorse: `</span><br><span class="line">🐫` : camel: `🐑` : sheep: `🐘` : elephant: `</span><br><span class="line">🐼` : panda_face: `🐍` : snake: `🐦` : bird: `</span><br><span class="line">🐤` : baby_chick: `🐥` : hatched_chick: `🐣` : hatching_chick: `</span><br><span class="line">🐔` : chicken: `🐧` : penguin: `🐢` : turtle: `</span><br><span class="line">🐛` : bug: `🐝` : honeybee: `🐜` : ant: `</span><br><span class="line">🐞` : beetle: `🐌` : snail: `🐙` : octopus: `</span><br><span class="line">🐠` : tropical_fish: `🐟` : fish: `🐳` : whale: `</span><br><span class="line">🐋` : whale2: `🐬` : dolphin: `🐄` : cow2: `</span><br><span class="line">🐏` : ram: `🐀` : rat: `🐃` : water_buffalo: `</span><br><span class="line">🐅` : tiger2: `🐇` : rabbit2: `🐉` : dragon: `</span><br><span class="line">🐐` : goat: `🐓` : rooster: `🐕` : dog2: `</span><br><span class="line">🐖` : pig2: `🐁` : mouse2: `🐂` : ox: `</span><br><span class="line">🐲` : dragon_face: `🐡` : blowfish: `🐊` : crocodile: `</span><br><span class="line">🐪` : dromedary_camel: `🐆` : leopard: `🐈` : cat2: `</span><br><span class="line">🐩` : poodle: `🐾` : paw_prints: `💐` : bouquet: `</span><br><span class="line">🌸` : cherry_blossom: `🌷` : tulip: `🍀` : four_leaf_clover: `</span><br><span class="line">🌹` : rose: `🌻` : sunflower: `🌺` : hibiscus: `</span><br><span class="line">🍁` : maple_leaf: `🍃` : leaves: `🍂` : fallen_leaf: `</span><br><span class="line">🌿` : herb: `🍄` : mushroom: `🌵` : cactus: `</span><br><span class="line">🌴` : palm_tree: `🌲` : evergreen_tree: `🌳` : deciduous_tree: `</span><br><span class="line">🌰` : chestnut: `🌱` : seedling: `🌼` : blossom: `</span><br><span class="line">🌾` : ear_of_rice: `🐚` : shell: `🌐` : globe_with_meridians: `</span><br><span class="line">🌞` : sun_with_face: `🌝` : full_moon_with_face: `🌚` : new_moon_with_face: `</span><br><span class="line">🌑` : new_moon: `🌒` : waxing_crescent_moon: `🌓` : first_quarter_moon: `</span><br><span class="line">🌔` : waxing_gibbous_moon: `🌕` : full_moon: `🌖` : waning_gibbous_moon: `</span><br><span class="line">🌗` : last_quarter_moon: `🌘` : waning_crescent_moon: `🌜` : last_quarter_moon_with_face: `</span><br><span class="line">🌛` : first_quarter_moon_with_face: `🌔` : moon: `🌍` : earth_africa: `</span><br><span class="line">🌎` : earth_americas: `🌏` : earth_asia: `🌋` : volcano: `</span><br><span class="line">🌌` : milky_way: `⛅️` : partly_sunny: `</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">🎍` : bamboo: `💝` : gift_heart: `🎎` : dolls: `</span><br><span class="line">🎒` : school_satchel: `🎓` : mortar_board: `🎏` : flags: `</span><br><span class="line">🎆` : fireworks: `🎇` : sparkler: `🎐` : wind_chime: `</span><br><span class="line">🎑` : rice_scene: `🎃` : jack_o_lantern: `👻` : ghost: `</span><br><span class="line">🎅` : santa: `🎄` : christmas_tree: `🎁` : gift: `</span><br><span class="line">🔔` : bell: `🔕` : no_bell: `🎋` : tanabata_tree: `</span><br><span class="line">🎉` : tada: `🎊` : confetti_ball: `🎈` : balloon: `</span><br><span class="line">🔮` : crystal_ball: `💿` : cd: `📀` : dvd: `</span><br><span class="line">💾` : floppy_disk: `📷` : camera: `📹` : video_camera: `</span><br><span class="line">🎥` : movie_camera: `💻` : computer: `📺` : tv: `</span><br><span class="line">📱` : iphone: `☎️` : phone: `☎️` : telephone: `</span><br><span class="line">📞` : telephone_receiver: `📟` : pager: `📠` : fax: `</span><br><span class="line">💽` : minidisc: `📼` : vhs: `🔉` : sound: `</span><br><span class="line">🔈` : speaker: `🔇` : mute: `📢` : loudspeaker: `</span><br><span class="line">📣` : mega: `⌛️` : hourglass: `⏳` : hourglass_flowing_sand: `</span><br><span class="line">⏰` : alarm_clock: `⌚️` : watch: `📻` : radio: `</span><br><span class="line">📡` : satellite: `➿` : loop: `🔍` : mag: `</span><br><span class="line">🔎` : mag_right: `🔓` : unlock: `🔒` : lock: `</span><br><span class="line">🔏` : lock_with_ink_pen: `🔐` : closed_lock_with_key: `🔑` : key: `</span><br><span class="line">💡` : bulb: `🔦` : flashlight: `🔆` : high_brightness: `</span><br><span class="line">🔅` : low_brightness: `🔌` : electric_plug: `🔋` : battery: `</span><br><span class="line">📲` : calling: `✉️` : email: `📫` : mailbox: `</span><br><span class="line">📮` : postbox: `🛀` : bath: `🛁` : bathtub: `</span><br><span class="line">🚿` : shower: `🚽` : toilet: `🔧` : wrench: `</span><br><span class="line">🔩` : nut_and_bolt: `🔨` : hammer: `💺` : seat: `</span><br><span class="line">💰` : moneybag: `💴` : yen: `💵` : dollar: `</span><br><span class="line">💷` : pound: `💶` : euro: `💳` : credit_card: `</span><br><span class="line">💸` : money_with_wings: `📧` : e-mail: `📥` : inbox_tray: `</span><br><span class="line">📤` : outbox_tray: `✉️` : envelope: `📨` : incoming_envelope: `</span><br><span class="line">📯` : postal_horn: `📪` : mailbox_closed: `📬` : mailbox_with_mail: `</span><br><span class="line">📭` : mailbox_with_no_mail: `🚪` : door: `🚬` : smoking: `</span><br><span class="line">💣` : bomb: `🔫` : gun: `🔪` : hocho: `</span><br><span class="line">💊` : pill: `💉` : syringe: `📄` : page_facing_up: `</span><br><span class="line">📃` : page_with_curl: `📑` : bookmark_tabs: `📊` : bar_chart: `</span><br><span class="line">📈` : chart_with_upwards_trend: `📉` : chart_with_downwards_trend: `📜` : scroll: `</span><br><span class="line">📋` : clipboard: `📆` : calendar: `📅` : date: `</span><br><span class="line">📇` : card_index: `📁` : file_folder: `📂` : open_file_folder: `</span><br><span class="line">✂️` : scissors: `📌` : pushpin: `📎` : paperclip: `</span><br><span class="line">✒️` : black_nib: `✏️` : pencil2: `📏` : straight_ruler: `</span><br><span class="line">📐` : triangular_ruler: `📕` : closed_book: `📗` : green_book: `</span><br><span class="line">📘` : blue_book: `📙` : orange_book: `📓` : notebook: `</span><br><span class="line">📔` : notebook_with_decorative_cover: `📒` : ledger: `📚` : books: `</span><br><span class="line">🔖` : bookmark: `📛` : name_badge: `🔬` : microscope: `</span><br><span class="line">🔭` : telescope: `📰` : newspaper: `🏈` : football: `</span><br><span class="line">🏀` : basketball: `⚽️` : soccer: `⚾️` : baseball: `</span><br><span class="line">🎾` : tennis: `🎱` : 8ball: `🏉` : rugby_football: `</span><br><span class="line">🎳` : bowling: `⛳️` : golf: `🚵` : mountain_bicyclist: `</span><br><span class="line">🚴` : bicyclist: `🏇` : horse_racing: `🏂` : snowboarder: `</span><br><span class="line">🏊` : swimmer: `🏄` : surfer: `🎿` : ski: `</span><br><span class="line">♠️` : spades: `♥️` : hearts: `♣️` : clubs: `</span><br><span class="line">♦️` : diamonds: `💎` : gem: `💍` : ring: `</span><br><span class="line">🏆` : trophy: `🎼` : musical_score: `🎹` : musical_keyboard: `</span><br><span class="line">🎻` : violin: `👾` : space_invader: `🎮` : video_game: `</span><br><span class="line">🃏` : black_joker: `🎴` : flower_playing_cards: `🎲` : game_die: `</span><br><span class="line">🎯` : dart: `🀄️` : mahjong: `🎬` : clapper: `</span><br><span class="line">📝` : memo: `📝` : pencil: `📖` : book: `</span><br><span class="line">🎨` : art: `🎤` : microphone: `🎧` : headphones: `</span><br><span class="line">🎺` : trumpet: `🎷` : saxophone: `🎸` : guitar: `</span><br><span class="line">👞` : shoe: `👡` : sandal: `👠` : high_heel: `</span><br><span class="line">💄` : lipstick: `👢` : boot: `👕` : shirt: `</span><br><span class="line">👕` : tshirt: `👔` : necktie: `👚` : womans_clothes: `</span><br><span class="line">👗` : dress: `🎽` : running_shirt_with_sash: `👖` : jeans: `</span><br><span class="line">👘` : kimono: `👙` : bikini: `🎀` : ribbon: `</span><br><span class="line">🎩` : tophat: `👑` : crown: `👒` : womans_hat: `</span><br><span class="line">👞` : mans_shoe: `🌂` : closed_umbrella: `💼` : briefcase: `</span><br><span class="line">👜` : handbag: `👝` : pouch: `👛` : purse: `</span><br><span class="line">👓` : eyeglasses: `🎣` : fishing_pole_and_fish: `☕️` : coffee: `</span><br><span class="line">🍵` : tea: `🍶` : sake: `🍼` : baby_bottle: `</span><br><span class="line">🍺` : beer: `🍻` : beers: `🍸` : cocktail: `</span><br><span class="line">🍹` : tropical_drink: `🍷` : wine_glass: `🍴` : fork_and_knife: `</span><br><span class="line">🍕` : pizza: `🍔` : hamburger: `🍟` : fries: `</span><br><span class="line">🍗` : poultry_leg: `🍖` : meat_on_bone: `🍝` : spaghetti: `</span><br><span class="line">🍛` : curry: `🍤` : fried_shrimp: `🍱` : bento: `</span><br><span class="line">🍣` : sushi: `🍥` : fish_cake: `🍙` : rice_ball: `</span><br><span class="line">🍘` : rice_cracker: `🍚` : rice: `🍜` : ramen: `</span><br><span class="line">🍲` : stew: `🍢` : oden: `🍡` : dango: `</span><br><span class="line">🥚` : egg: `🍞` : bread: `🍩` : doughnut: `</span><br><span class="line">🍮` : custard: `🍦` : icecream: `🍨` : ice_cream: `</span><br><span class="line">🍧` : shaved_ice: `🎂` : birthday: `🍰` : cake: `</span><br><span class="line">🍪` : cookie: `🍫` : chocolate_bar: `🍬` : candy: `</span><br><span class="line">🍭` : lollipop: `🍯` : honey_pot: `🍎` : apple: `</span><br><span class="line">🍏` : green_apple: `🍊` : tangerine: `🍋` : lemon: `</span><br><span class="line">🍒` : cherries: `🍇` : grapes: `🍉` : watermelon: `</span><br><span class="line">🍓` : strawberry: `🍑` : peach: `🍈` : melon: `</span><br><span class="line">🍌` : banana: `🍐` : pear: `🍍` : pineapple: `</span><br><span class="line">🍠` : sweet_potato: `🍆` : eggplant: `🍅` : tomato: `</span><br><span class="line">🌽` : corn: `</span><br><span class="line">Places</span><br><span class="line">🏠` : house: `🏡` : house_with_garden: `🏫` : school: `</span><br><span class="line">🏢` : office: `🏣` : post_office: `🏥` : hospital: `</span><br><span class="line">🏦` : bank: `🏪` : convenience_store: `🏩` : love_hotel: `</span><br><span class="line">🏨` : hotel: `💒` : wedding: `⛪️` : church: `</span><br><span class="line">🏬` : department_store: `🏤` : european_post_office: `🌇` : city_sunrise: `</span><br><span class="line">🌆` : city_sunset: `🏯` : japanese_castle: `🏰` : european_castle: `</span><br><span class="line">⛺️` : tent: `🏭` : factory: `🗼` : tokyo_tower: `</span><br><span class="line">🗾` : japan: `🗻` : mount_fuji: `🌄` : sunrise_over_mountains: `</span><br><span class="line">🌅` : sunrise: `🌠` : stars: `🗽` : statue_of_liberty: `</span><br><span class="line">🌉` : bridge_at_night: `🎠` : carousel_horse: `🌈` : rainbow: `</span><br><span class="line">🎡` : ferris_wheel: `⛲️` : fountain: `🎢` : roller_coaster: `</span><br><span class="line">🚢` : ship: `🚤` : speedboat: `⛵️` : boat: `</span><br><span class="line">⛵️` : sailboat: `🚣` : rowboat: `⚓️` : anchor: `</span><br><span class="line">🚀` : rocket: `✈️` : airplane: `🚁` : helicopter: `</span><br><span class="line">🚂` : steam_locomotive: `🚊` : tram: `🚞` : mountain_railway: `</span><br><span class="line">🚲` : bike: `🚡` : aerial_tramway: `🚟` : suspension_railway: `</span><br><span class="line">🚠` : mountain_cableway: `🚜` : tractor: `🚙` : blue_car: `</span><br><span class="line">🚘` : oncoming_automobile: `🚗` : car: `🚗` : red_car: `</span><br><span class="line">🚕` : taxi: `🚖` : oncoming_taxi: `🚛` : articulated_lorry: `</span><br><span class="line">🚌` : bus: `🚍` : oncoming_bus: `🚨` : rotating_light: `</span><br><span class="line">🚓` : police_car: `🚔` : oncoming_police_car: `🚒` : fire_engine: `</span><br><span class="line">🚑` : ambulance: `🚐` : minibus: `🚚` : truck: `</span><br><span class="line">🚋` : train: `🚉` : station: `🚆` : train2: `</span><br><span class="line">🚅` : bullettrain_front: `🚄` : bullettrain_side: `🚈` : light_rail: `</span><br><span class="line">🚝` : monorail: `🚃` : railway_car: `🚎` : trolleybus: `</span><br><span class="line">🎫` : ticket: `⛽️` : fuelpump: `🚦` : vertical_traffic_light: `</span><br><span class="line">🚥` : traffic_light: `⚠️` : warning: `🚧` : construction: `</span><br><span class="line">🔰` : beginner: `🏧` : atm: `🎰` : slot_machine: `</span><br><span class="line">🚏` : busstop: `💈` : barber: `♨️` : hotsprings: `</span><br><span class="line">🏁` : checkered_flag: `🎌` : crossed_flags: `🏮` : izakaya_lantern: `</span><br><span class="line">🗿` : moyai: `🎪` : circus_tent: `🎭` : performing_arts: `</span><br><span class="line">📍` : round_pushpin: `🚩` : triangular_flag_on_post: `</span><br><span class="line">Symbols</span><br><span class="line">1️⃣` : one: `2️⃣` : two: `3️⃣` : three: `</span><br><span class="line">4️⃣` : four: `5️⃣` : five: `6️⃣` : six: `</span><br><span class="line">7️⃣` : seven: `8️⃣` : eight: `9️⃣` : nine: `</span><br><span class="line">🔟` : keycap_ten: `🔢` : 1234: `0️⃣` : zero: `</span><br><span class="line">#️⃣` : hash: `🔣` : symbols: `◀️` : arrow_backward: `</span><br><span class="line">⬇️` : arrow_down: `▶️` : arrow_forward: `⬅️` : arrow_left: `</span><br><span class="line">🔠` : capital_abcd: `🔡` : abcd: `🔤` : abc: `</span><br><span class="line">↙️` : arrow_lower_left: `↘️` : arrow_lower_right: `➡️` : arrow_right: `</span><br><span class="line">⬆️` : arrow_up: `↖️` : arrow_upper_left: `↗️` : arrow_upper_right: `</span><br><span class="line">⏬` : arrow_double_down: `⏫` : arrow_double_up: `🔽` : arrow_down_small: `</span><br><span class="line">⤵️` : arrow_heading_down: `⤴️` : arrow_heading_up: `↩️` : leftwards_arrow_with_hook: `</span><br><span class="line">↪️` : arrow_right_hook: `↔️` : left_right_arrow: `↕️` : arrow_up_down: `</span><br><span class="line">🔼` : arrow_up_small: `🔃` : arrows_clockwise: `🔄` : arrows_counterclockwise: `</span><br><span class="line">⏪` : rewind: `⏩` : fast_forward: `ℹ️` : information_source: `</span><br><span class="line">🆗` : ok: `🔀` : twisted_rightwards_arrows: `🔁` : repeat: `</span><br><span class="line">🔂` : repeat_one: `🆕` : new: `🔝` : top: `</span><br><span class="line">🆙` : up: `🆒` : cool: `🆓` : free: `</span><br><span class="line">🆖` : ng: `🎦` : cinema: `🈁` : koko: `</span><br><span class="line">📶` : signal_strength: `</span><br><span class="line">🈂️` : sa: `🚻` : restroom: `🚹` : mens: `</span><br><span class="line">🚺` : womens: `🚼` : baby_symbol: `🚭` : no_smoking: `</span><br><span class="line">🅿️` : parking: `♿️` : wheelchair: `🚇` : metro: `</span><br><span class="line">🛄` : baggage_claim: `🉑` : accept: `🚾` : wc: `</span><br><span class="line">🚰` : potable_water: `🚮` : put_litter_in_its_place: `㊙️` : secret: `</span><br><span class="line">㊗️` : congratulations: `Ⓜ️` : m: `🛂` : passport_control: `</span><br><span class="line">🛅` : left_luggage: `🛃` : customs: `🉐` : ideograph_advantage: `</span><br><span class="line">🆑` : cl: `🆘` : sos: `🆔` : id: `</span><br><span class="line">🚫` : no_entry_sign: `🔞` : underage: `📵` : no_mobile_phones: `</span><br><span class="line">🚯` : do_not_litter: `🚱` : non-potable_water: `🚳` : no_bicycles: `</span><br><span class="line">🚷` : no_pedestrians: `🚸` : children_crossing: `⛔️` : no_entry: `</span><br><span class="line">✳️` : eight_spoked_asterisk: `✴️` : eight_pointed_black_star: `💟` : heart_decoration: `</span><br><span class="line">🆚` : vs: `📳` : vibration_mode: `📴` : mobile_phone_off: `</span><br><span class="line">💹` : chart: `💱` : currency_exchange: `♈️` : aries: `</span><br><span class="line">♉️` : taurus: `♊️` : gemini: `♋️` : cancer: `</span><br><span class="line">♌️` : leo: `♍️` : virgo: `♎️` : libra: `</span><br><span class="line">♏️` : scorpius: `♐️` : sagittarius: `♑️` : capricorn: `</span><br><span class="line">♒️` : aquarius: `♓️` : pisces: `⛎` : ophiuchus: `</span><br><span class="line">🔯` : six_pointed_star: `❎` : negative_squared_cross_mark: `🅰️` : a: `</span><br><span class="line">🅱️` : b: `🆎` : ab: `🅾️` : o2: `</span><br><span class="line">💠` : diamond_shape_with_a_dot_inside: `♻️` : recycle: `🔚` : end: `</span><br><span class="line">🔛` : on: `🔜` : soon: `🕐` : clock1: `</span><br><span class="line">🕜` : clock130: `🕙` : clock10: `🕥` : clock1030: `</span><br><span class="line">🕚` : clock11: `🕦` : clock1130: `🕛` : clock12: `</span><br><span class="line">🕧` : clock1230: `🕑` : clock2: `🕝` : clock230: `</span><br><span class="line">🕒` : clock3: `🕞` : clock330: `🕓` : clock4: `</span><br><span class="line">🕟` : clock430: `🕔` : clock5: `🕠` : clock530: `</span><br><span class="line">🕕` : clock6: `🕡` : clock630: `🕖` : clock7: `</span><br><span class="line">🕢` : clock730: `🕗` : clock8: `🕣` : clock830: `</span><br><span class="line">🕘` : clock9: `🕤` : clock930: `💲` : heavy_dollar_sign: `</span><br><span class="line">©️` : copyright: `®️` : registered: `™️` : tm: `</span><br><span class="line">❌` : x: `❗️` : heavy_exclamation_mark: `‼️` : bangbang: `</span><br><span class="line">⁉️` : interrobang: `⭕️` : o: `✖️` : heavy_multiplication_x: `</span><br><span class="line">➕` : heavy_plus_sign: `➖` : heavy_minus_sign: `➗` : heavy_division_sign: `</span><br><span class="line">💮` : white_flower: `💯` : 100: `✔️` : heavy_check_mark: `</span><br><span class="line">☑️` : ballot_box_with_check: `🔘` : radio_button: `🔗` : link: `</span><br><span class="line">➰` : curly_loop: `〰️` : wavy_dash: `〽️` : part_alternation_mark: `</span><br><span class="line">🔱` : trident: `🔻` : small_red_triangle_down: `🔺` : small_red_triangle: `</span><br><span class="line">✅` : white_check_mark: `🔲` : black_square_button: `🔳` : white_square_button: `</span><br><span class="line">⚫️` : black_circle: `⚪️` : white_circle: `🔴` : red_circle: `</span><br><span class="line">🔵` : large_blue_circle: `🔷` : large_blue_diamond: `🔶` : large_orange_diamond: `</span><br><span class="line">🔹` : small_blue_diamond: `🔸` : small_orange_diamond: `</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 表情包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>butterfly模板下博客的书写规范</title>
      <link href="/archives/46fbf4ba.html"/>
      <url>/archives/46fbf4ba.html</url>
      
        <content type="html"><![CDATA[<h2 id="博客页面配置"><a href="#博客页面配置" class="headerlink" title="博客页面配置"></a>博客页面配置</h2><h3 id="文章页面配置"><a href="#文章页面配置" class="headerlink" title="文章页面配置"></a>文章页面配置</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title:【必需】文章标题</span><br><span class="line">date:【必需】文章创建日期</span><br><span class="line">updated:【可选】文章更新日期</span><br><span class="line">tags:【可选】文章标签</span><br><span class="line">categories:【可选】文章分类</span><br><span class="line">keywords:【可选】文章关键词</span><br><span class="line">description:【可选】文章描述</span><br><span class="line">top<span class="emphasis">_img:【可选】文章顶部图片</span></span><br><span class="line"><span class="emphasis">cover:【可选】文章封面（如果没有设置top_</span>img，文章页顶部将显示缩略图，可设为false/图片地址/留空）</span><br><span class="line">sticky: 【可选】置顶操作，后跟数子，数字越大权重越高</span><br><span class="line">comments:【可选】显示文章评论模块（默认 true）</span><br><span class="line">toc:【可选】显示文章TOC（默认为设置中toc的enable配置）</span><br><span class="line">toc<span class="emphasis">_number:【可选】显示toc_</span>number（默认为设置中toc的number配置）</span><br><span class="line">copyright:【可选】显示文章版权模块（默认为设置中post<span class="emphasis">_copyright的enable配置）</span></span><br><span class="line"><span class="emphasis">copyright_</span>author:【可选】文章版权模块的文章作者</span><br><span class="line">copyright<span class="emphasis">_author_</span>href:【可选】文章版权模块的链接文章作者</span><br><span class="line">copyright<span class="emphasis">_url:【可选】文章版权模块的链接文章连结</span></span><br><span class="line"><span class="emphasis">copyright_</span>info:【可选】文章版权模块的文字版权声明</span><br><span class="line">mathjax:【可选】显示mathjax（当设置mathjax的per<span class="emphasis">_page： false时，才需要配置，默认 false）</span></span><br><span class="line"><span class="emphasis">katex:【可选】显示katex（当设置katex的per_</span>page： false时，才需要配置，默认 false）</span><br><span class="line">aplayer:【可选】在需要的页面加载aplayer的js和css，请参考文章下面的 配置音乐</span><br><span class="line">highlight<span class="emphasis">_shrink:【可选】配置代码框是否展开（true/false）（默认为设置中highlight_</span>shrink的配置）</span><br><span class="line"><span class="section">aside:【可选】显示侧边栏 （默认 true）</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><p>文章内容以“— 博客内容 —”进行包裹</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--- </span><br><span class="line"><span class="section"> 内容1</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"><span class="section"> 内容2</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h2 id="标签页"><a href="#标签页" class="headerlink" title="标签页"></a>标签页</h2><p>前往你的 Hexo 博客的根目录</p><p>找到这个文件： source/tags/index.md</p><p>修改文件为;</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--- MARKDOWN</span><br><span class="line">title: 标签页面</span><br><span class="line">date: 2018-01-05 00:00:00</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line"><span class="section">top<span class="emphasis">_img:【可选】文章顶部图片</span></span></span><br><span class="line"><span class="emphasis"><span class="section">---</span></span></span><br></pre></td></tr></table></figure><h3 id="分类页"><a href="#分类页" class="headerlink" title="分类页"></a>分类页</h3><p>前往你的 Hexo 博客的根目录</p><p>找到这个文件：source/categories/index.md</p><p>修改此文档 为：</p><p>MARKDOWN</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2018-01-05 00:00:00</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line"><span class="section">top<span class="emphasis">_img:【可选】文章顶部图片</span></span></span><br><span class="line"><span class="emphasis"><span class="section">---</span></span></span><br></pre></td></tr></table></figure><h2 id="链接页面"><a href="#链接页面" class="headerlink" title="链接页面"></a>链接页面</h2><p>前往你的 Hexo 博客的根目录</p><p>找到这个文件：source/link/index.md</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 链接</span><br><span class="line">date: 2018-06-07 22:17:49</span><br><span class="line">type: &quot;link&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h3 id="链接的添加配置"><a href="#链接的添加配置" class="headerlink" title="链接的添加配置"></a>链接的添加配置</h3><p>在Hexo博客目录中的（如果没有 _data 文件夹，请自行创建），在source下创建一个_data文件夹，在此文件夹下创建一个link.yml文件，对文件进行配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- class_name: 友情链接</span><br><span class="line">  class_desc: 那些人，那些事  #页面标题</span><br><span class="line">  link_list:</span><br><span class="line">    - name: Hexo</span><br><span class="line">      link: https://hexo.io/zh-tw/</span><br><span class="line">      avatar: https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg</span><br><span class="line">      descr: 快速、简单强大</span><br><span class="line"></span><br><span class="line">- class_name: 油管</span><br><span class="line">  class_desc: 值得推荐</span><br><span class="line">  link_list:</span><br><span class="line">    - name: Youtube</span><br><span class="line">      link: https://www.youtube.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png</span><br><span class="line">      descr: 视频网站</span><br><span class="line">    - name: Weibo</span><br><span class="line">      link: https://www.weibo.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png</span><br><span class="line">      descr: 最大社交分享平台</span><br><span class="line">    - name: Twitter</span><br><span class="line">      link: https://twitter.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png</span><br><span class="line">      descr: 社交分享平台</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> butterfly的基本配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客标签外挂</title>
      <link href="/archives/62117.html"/>
      <url>/archives/62117.html</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>默认 提示块标签</p></div><p><code>&#123;% note simple %&#125;默认 提示块标签&#123;% endnote %&#125;</code></p><div class="note default simple"><p>default 提示块标签</p></div><p><code>&#123;% note default simple %&#125;default 提示块标签&#123;% endnote %&#125;</code></p><div class="note primary simple"><p>primary 提示块标签</p></div><p><code>&#123;% note primary simple %&#125;primary 提示块标签&#123;% endnote %&#125;</code></p><div class="note success simple"><p>success 提示块标签</p></div><p><code>&#123;% note success simple %&#125;success 提示块标签&#123;% endnote %&#125;</code></p><div class="note info simple"><p>info 提示块标签</p></div><p><code>&#123;% note info simple %&#125;info 提示块标签&#123;% endnote %&#125;</code></p><div class="note warning simple"><p>warning 提示块标签</p></div><p><code>&#123;% note warning simple %&#125;warning 提示块标签&#123;% endnote %&#125;</code></p><div class="note danger simple"><p>danger 提示块标签</p></div><p><code>&#123;% note danger simple %&#125;danger 提示块标签&#123;% endnote %&#125;</code></p><div class="note modern"><p>默认 提示块标签</p></div><p><code>&#123;% note modern %&#125;默认 提示块标签&#123;% endnote %&#125;</code></p><div class="note default modern"><p>default 提示块标签</p></div><p><code>&#123;% note default modern %&#125;default 提示块标签&#123;% endnote %&#125;</code></p><div class="note primary modern"><p>primary 提示块标签</p></div><p><code>&#123;% note primary modern %&#125;primary 提示块标签&#123;% endnote %&#125;</code></p><div class="note success modern"><p>success 提示块标签</p></div><p><code>&#123;% note success modern %&#125;success 提示块标签&#123;% endnote %&#125;</code></p><div class="note info modern"><p>info 提示块标签</p></div><p><code>&#123;% note info modern %&#125;info 提示块标签&#123;% endnote %&#125;</code></p><div class="note warning modern"><p>warning 提示块标签</p></div><p><code>&#123;% note warning modern %&#125;warning 提示块标签&#123;% endnote %&#125;</code></p><div class="note danger modern"><p>danger 提示块标签</p></div><p><code>&#123;% note danger modern %&#125;danger 提示块标签&#123;% endnote %&#125;</code></p><div class="note flat"><p>默认 提示块标签</p></div><p><code>&#123;% note flat %&#125;默认 提示块标签&#123;% endnote %&#125;</code></p><div class="note default flat"><p>default 提示块标签</p></div><p><code>&#123;% note default flat %&#125;default 提示块标签&#123;% endnote %&#125;</code></p><div class="note primary flat"><p>primary 提示块标签</p></div><p><code>&#123;% note primary flat %&#125;primary 提示块标签&#123;% endnote %&#125;</code></p><div class="note success flat"><p>success 提示块标签</p></div><p><code>&#123;% note success flat %&#125;success 提示块标签&#123;% endnote %&#125;</code></p><div class="note info flat"><p>info 提示块标签</p></div><p><code>&#123;% note info flat %&#125;info 提示块标签&#123;% endnote %&#125;</code></p><div class="note warning flat"><p>warning 提示块标签</p></div><p><code>&#123;% note warning flat %&#125;warning 提示块标签&#123;% endnote %&#125;</code></p><div class="note danger flat"><p>danger 提示块标签</p></div><p><code>&#123;% note danger flat %&#125;danger 提示块标签&#123;% endnote %&#125;</code></p><div class="note disabled"><p>默认 提示块标签</p></div><p><code>&#123;% note disabled %&#125;默认 提示块标签&#123;% endnote %&#125;</code></p><div class="note default disabled"><p>default 提示块标签</p></div><p><code>&#123;% note default disabled %&#125;default 提示块标签&#123;% endnote %&#125;</code></p><div class="note primary disabled"><p>primary 提示块标签</p></div><p><code>&#123;% note primary disabled %&#125;primary 提示块标签&#123;% endnote %&#125;</code></p><div class="note success disabled"><p>success 提示块标签</p></div><p><code>&#123;% note success disabled %&#125;success 提示块标签&#123;% endnote %&#125;</code></p><div class="note info disabled"><p>info 提示块标签</p></div><p><code>&#123;% note info disabled %&#125;info 提示块标签&#123;% endnote %&#125;</code></p><div class="note warning disabled"><p>warning 提示块标签</p></div><p><code>&#123;% note warning disabled %&#125;warning 提示块标签&#123;% endnote %&#125;</code></p><div class="note danger disabled"><p>danger 提示块标签</p></div><p><code>&#123;% note danger disabled %&#125;danger 提示块标签&#123;% endnote %&#125;</code></p><div class="note no-icon flat"><p>默认 提示块标签</p></div><p><code>&#123;% note no-icon %&#125;默认 提示块标签&#123;% endnote %&#125;</code></p><div class="note default no-icon flat"><p>default 提示块标签</p></div><p><code>&#123;% note default no-icon %&#125;default 提示块标签&#123;% endnote %&#125;</code></p><div class="note primary no-icon flat"><p>primary 提示块标签</p></div><p><code>&#123;% note primary no-icon %&#125;primary 提示块标签&#123;% endnote %&#125;</code></p><div class="note success no-icon flat"><p>success 提示块标签</p></div><p><code>&#123;% note success no-icon %&#125;success 提示块标签&#123;% endnote %&#125;</code></p><div class="note info no-icon flat"><p>info 提示块标签</p></div><p><code>&#123;% note info no-icon %&#125;info 提示块标签&#123;% endnote %&#125;</code></p><div class="note warning no-icon flat"><p>warning 提示块标签</p></div><p><code>&#123;% note warning no-icon %&#125;warning 提示块标签&#123;% endnote %&#125;</code></p><div class="note danger no-icon flat"><p>danger 提示块标签</p></div><p><code>&#123;% note danger no-icon %&#125;danger 提示块标签&#123;% endnote %&#125;</code></p><a class="btn-beautify button--animated larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated blue larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated pink larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated red larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated purple larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated orange larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><a class="btn-beautify button--animated green larger" href="https://butterfly.js.org/"   title="Butterfly"><i class="far fa-hand-point-right"></i><span>Butterfly</span></a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,blue larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,pink larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,red larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,purple larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,orange larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://butterfly.js.org/&#x27;,Butterfly,far fa-hand-point-right,green larger %&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 标签外挂 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于我跨专业自学前端这件事</title>
      <link href="/archives/7630.html"/>
      <url>/archives/7630.html</url>
      
        <content type="html"><![CDATA[<h2 id="因为热爱-x1f606"><a href="#因为热爱-x1f606" class="headerlink" title="因为热爱 &#x1f606;"></a>因为热爱 <span class="github-emoji" alias="satisfied" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8">&#x1f606;</span></h2><p>我是一名普通到不能再普通的大学生，没有显赫的家世，没有青梅竹马的小妹，也没有老一辈人定的娃娃亲，生活虽然平凡却不想平庸。人生的前19年纯真是主旋律，随着高考的结束，我离开生活了19年的家，独自一人来到陌生的城市求学。时光飞逝，经历了军训，参加了各种喜欢的社团，感觉一切又回归了平凡。没有了刚上大学的那种兴奋时，孤独和迷茫 占据了我的绝大部分时间。为了消除这种迷茫，我开始不断的尝试新鲜的事物。一年时间的跌跌撞撞，被C语言劝退，被python毒打……真的是始于好奇终于懒惰。but在一个月黑风高的夜晚，和往常一样逛B站时，“一不留神”点进了一个新世界的大门，黑马程序员开启了我的前端之旅。</p><p>从小白到入门的这段时间，我过得很充实，踩了很多的坑，也有了很多的收获。一直想找时间对前一段时间的学习做一个总结，但由于各种各样的由于，一直拖到现在 才开始写。</p><p>大一才摸电脑我，不只是技术小白还是个计算机大白，面对五花八门的编程语言真的是不知所措，看着网上对各种编程语言的介绍，我的内心相当的纠结，感觉每种语言都很好，都有各自的特点。贪心的我想要都学一遍。在百度之后，决定从简单一点的Python开始，于是开始在哔哩哔哩 (゜-゜)つロ 干杯~-bilibil 寻找相关的课程开始了自学。开始的时候Python确实让我为之着迷，不仅仅看慕课，还专门跑到图书馆借阅相关书籍。但我还是高估了自己，学了差不多一个月的时间，我开始变的浮躁，经常性的摆烂摸鱼，当课程进行到算法的章节时，冗长的算法彻底逼退了我，就算是压死骆驼的最后一根稻草。于是乎我的Python之旅在经历了两个多月的高潮后彻底进入了低谷，从入门到放弃也就两个月，大一上半学期就这样浑浑噩噩的过去了。</p><p>临近寒假的时候，学校布置的一项假期实践作业。具体细节已经记不太清了，大致内容是叫我们结合生活经历完成一个电子小制作，那是我第一次接触单片机这种东西，满怀期待的去网上查阅有关单片机的相关内容，查完之后我感觉我又行了。</p><p>再于是乎，根据up主的推荐我入手了一套入门级的arduino开发板，买了各种配件，经过一个寒假的学习，也算是入门了。大一第二学期虽然课程很多, 但只要有空闲时间我还是会拿arduino去学去做一些好玩的东西，经历了一个学期的沉淀和积累，在学期末的时候顺利进阶ICT，做了不少物联网相关的东西，虽然没有拿什么大奖，但也的确收获颇丰成就感拉满。</p><p>还是原来的配方，还是原来的味道。寒假的时候又买了一套ESP8266的开发板，斥巨资买了各种辅助芯片和功能模块，当然缺不了五花八门的测试工具，虽然几乎花光了我攒了一个学期的钱，都是一点也不觉的心疼，因为我觉得值。之后又陆陆续续参加了不少比赛,做了不少东西。</p><p>大二的时候我们开了一门C语言程序设计的课，这应该是每个理工科专业的必修课吧[偷笑]，但由于疫情的原因，这门课改成了网课。这门课虽然以“扫盲”为主，but还是无情的将我劝退了。虽然吧指针的那部分真的真的很难学，但也的确让我体验到了C语言它独有的魅力，尽管我至今都没搞懂指针的使用，期间我也接触了Java，但都没有深入的学习。</p><p>大学时光真的过得很快，一年半的时间就这样过去了。假期的时候在某宝上买了《智能家居项目开发》，这本书虽然内容不咋地，但是它是真正的开阔了我的眼见，书中单片机、微信小程序、web、app的组合联动让我沦陷，也正是这本书让我知道原来ICT还可以这么玩，也正是这本书让入坑了前端。</p><p>大二第二学期刚开学不久，就在B站上找到了微信小程序的教程，视频很全但也很长，不过这抵挡不住我的热情，一个月没日没夜的肝终于学完了相关的课程，也做出了我人生的第一款小程序，此次小程序的开发也让我看到了自己知识储备的不足，没有一个完善而系统的一个知识体系。于是乎，我花了两天时间，找了好多up主咨询，也问了一下度娘，给自己制定了一条入坑前端的学习之路</p><h2 id="学习计划🧑‍💻"><a href="#学习计划🧑‍💻" class="headerlink" title="学习计划🧑‍💻"></a>学习计划🧑‍💻</h2><h3 id="第一阶段：HTML5-amp-CSS3前端入门😶‍🌫️"><a href="#第一阶段：HTML5-amp-CSS3前端入门😶‍🌫️" class="headerlink" title="第一阶段：HTML5&amp;CSS3前端入门😶‍🌫️"></a>第一阶段：HTML5&amp;CSS3前端入门😶‍🌫️</h3><ol><li> html5+css3前端入门</li><li> less&amp;sass</li><li> 制作一些简单的静态页面</li></ol><h3 id="第二阶段：JS-TS语法🤦‍♂️"><a href="#第二阶段：JS-TS语法🤦‍♂️" class="headerlink" title="第二阶段：JS+TS语法🤦‍♂️"></a>第二阶段：JS+TS语法🤦‍♂️</h3><ol><li>JavaScript基础语法</li><li>WebAPI/Dom Bom</li><li>JQuery（可选）</li><li>axios</li><li>ES6语法</li><li>JavaScript高级</li><li>TypeScript（必备技能）</li></ol><h3 id="第三阶段：大后端必备🫡"><a href="#第三阶段：大后端必备🫡" class="headerlink" title="第三阶段：大后端必备🫡"></a>第三阶段：大后端必备🫡</h3><ol><li>nodejs基础</li><li>webpack</li><li>nodejs高级</li><li>express</li><li>MySQL数据库</li><li>Git</li></ol><h3 id="第四阶段：Vue框架的学习😉"><a href="#第四阶段：Vue框架的学习😉" class="headerlink" title="第四阶段：Vue框架的学习😉"></a>第四阶段：Vue框架的学习😉</h3><ol><li>Vue基础（可以先从Vue2开始学之后过度到Vue3）</li><li>Vue实战项目（挑选一些开源的实战项目，最好有视频教程，跟着视频熟悉一下整个开发流程）</li><li>Vue源码解析（不仅知其然还要知其所以然）</li></ol><h3 id="第五阶段：小程序😏"><a href="#第五阶段：小程序😏" class="headerlink" title="第五阶段：小程序😏"></a>第五阶段：小程序😏</h3><ol><li>微信小程序基础</li><li>云开发</li><li>小程序实战项目</li></ol><h3 id="第六阶段：能力提升😂"><a href="#第六阶段：能力提升😂" class="headerlink" title="第六阶段：能力提升😂"></a>第六阶段：能力提升😂</h3><ol><li>JavaEE（如果以前没有学过其他语言，可以尝试学习一下Java基础，其中很多对基础法，数据结构的介绍都可以映射到JavaScript上，其中有很多优秀的设计模式都是值得学习和借鉴的，如果想向后端大数据区块链方向发展的可以接着学完整套的Java课程）</li><li>服务器的运维</li><li>Nginx（可以进行项目在服务器端的部署）</li></ol><blockquote><p>以上都是小编亲测，已经完成了以上所有阶段的学习</p></blockquote><h2 id="未来可期😁😁"><a href="#未来可期😁😁" class="headerlink" title="未来可期😁😁"></a>未来可期😁😁</h2><p>最后总结一下，兴趣永远是你最好的启蒙老师，大学真的是一个很好的舞台，你可以在这个舞台是肆意挥洒你的青春，尽情展现你的才华。在这期间你可以迷茫，可以不作为，但一定要找到一两件自己真正喜欢的东西，一定要找一件为之可以不顾一切的事情。还有学习工具不要追求物美价廉一定要买贵的，买你能力范围内最贵的，贵到你不用就会心疼，贵到为了买它你会放弃很多东西，这样才能让你克服懒惰，激发你的学习兴趣。你一定要学会做减法，世界上没有白吃的午餐，无非是舍弃哪个，换取哪个，你要懂得权重懂得断舍离，要明白适合自己的才是最好的，不要囫囵吞枣什么都学，到最后你会发现其实你一事无成。</p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
